import{u as fe}from"./characters-d40a8468.js";import{as as x,y as Z}from"./index-8d422ee2.js";const ge=x("searchSettings",{state:()=>({minEHP:3e4,minHP:3e4,minHPBuddy:0,minEvasion:0,minDuo:0,minReferenceDamage:0,minReferenceAdvantageDamage:0,minReferenceVsHiDamage:0,minReferenceVsMizuDamage:0,minReferenceVsKiDamage:0,maxResult:10,attackNum:10,sortOptions:[{prop:"HP",order:"降順"}],allowSameCharacter:!0}),actions:{updateSearchSettings(a){Object.assign(this,a)}}}),de=x("searchResult",{state:()=>({totalResults:0,nowResults:0,results:[],isSearching:!1,errorMessage:""})}),ve=ge(),{minEHP:pe,minHP:De,minHPBuddy:ke,minEvasion:He,minDuo:ye,minReferenceDamage:Pe,minReferenceAdvantageDamage:he,minReferenceVsHiDamage:Re,minReferenceVsKiDamage:Ae,minReferenceVsMizuDamage:be,maxResult:G,sortOptions:we,allowSameCharacter:Se,attackNum:U}=Z(ve),Ke=fe(),{characters:J}=Z(Ke),Be=de(),{totalResults:L,nowResults:Q,results:y,isSearching:X,errorMessage:j}=Z(Be);function Oe(a){(a.key==="e"||a.key==="+")&&a.preventDefault()}function Me(a){return[a("commonts.HP"),a("commonts.effectiveHP"),a("commonts.HPBuddy"),a("commonts.noHPBuddy"),a("commonts.buddy"),a("commonts.evasion"),a("commonts.duo"),a("commonts.neutralDamage"),a("commonts.advantageDamage"),a("commonts.damageAgainstFire"),a("commonts.damageAgainstWater"),a("commonts.damageAgainstFlora")]}const Te=["hp","ehp","hpBuudy","noHpBuddy","buddy","evasion","duo","referenceDamage","referenceAdvantageDamage","referenceVsHiDamage","referenceVsMizuDamage","referenceVsKiDamage"],E={"HPUP(小)":{hp:.2,atk:0,heal:0,conHeal:0},"HP&ATKUP(小)":{hp:.2,atk:.2,heal:0,conHeal:0},"HPUP(中)":{hp:.3,atk:0,heal:0,conHeal:0},"HP&ATKUP(中)":{hp:.3,atk:.35,heal:0,conHeal:0},"ATKUP(小)":{hp:0,atk:.2,heal:0,conHeal:0},"ATKUP(中)":{hp:0,atk:.35,heal:0,conHeal:0},"回復(小)":{hp:0,atk:0,heal:1.1,conHeal:0},"回復&継続回復(小)":{hp:0,atk:0,heal:1.1,conHeal:.15*3},"回復(中)":{hp:0,atk:0,heal:1.7,conHeal:0},"回復&継続回復(中)":{hp:0,atk:0,heal:1.7,conHeal:.25*3},"継続回復(小)":{hp:0,atk:0,heal:0,conHeal:.15*3},"継続回復(中)":{hp:0,atk:0,heal:0,conHeal:.25*3}};function F(a){var n;return((n=E[a])==null?void 0:n.hp)||0}function N(a){var n;return((n=E[a])==null?void 0:n.atk)||0}function _(a){var n;return((n=E[a])==null?void 0:n.heal)||0}function $(a){var n;return((n=E[a])==null?void 0:n.conHeal)||0}const Ue={"ATKUP(極小)":1.1,"ATKUP(小)":1.2,"ATKUP(中)":1.35,"ATKUP(大)":1.5,"ATKUP(極大)":1.8},Ve={"ダメUP(極小)":.025,"ダメUP(小)":.05,"ダメUP(中)":.0875,"ダメUP(大)":.125,"ダメUP(極大)":.1875,"属性ダメUP(極小)":.03,"属性ダメUP(小)":.06,"属性ダメUP(中)":.1005,"属性ダメUP(大)":.15,"属性ダメUP(極大)":.27},I={};function qe(a,n,l,c){const s=`${a},${n},${l},${c}`;if(s in I)return I[s];let k=n.includes("弱")?.75:1;k*=l==="無"?1.1:1,k+=Ve[a]||0;let p=1;n.includes("連撃")?p=1.8:n.includes("デュオ")&&(p=2.4);const A=c*k*p;return I[s]=A,A}function W(a,n,l,c,s){return c=(Ue[a]||1)*c+c*s,qe(a,n,l=="無"?"無":"無以外",c)}function V(a,n,l){const c=[a,n,l];return c.sort((s,k)=>k-s),[c[0],c[1]]}function Ce(a){const n=new Set;for(const e of a)n.add(e.chara);let l=0,c=0,s=0,k=0,p=0,A=0,P=0;const b=[],R=[],u=[],q=[],t=[];let o=0,i=0,g=0,d=0,v=0;const m={},f={},H={},T=[];if(a.sort((e,r)=>r.calcBaseATK-e.calcBaseATK),a.forEach((e,r)=>{m[r]=!1,f[r]=!1,H[r]=!1}),a.forEach((e,r)=>{T.push(e.imgUrl),l+=e.calcBaseHP;let C=!1,w=0;if(n.has(e.buddy1c)){p+=1;const D=F(e.buddy1s);w+=N(e.buddy1s),D!=0&&(k+=1,C=!0,l+=e.calcBaseHP*D)}if(n.has(e.buddy2c)){p+=1;const D=F(e.buddy2s);w+=N(e.buddy2s),D!=0&&(k+=1,C=!0,l+=e.calcBaseHP*D)}if(n.has(e.buddy3c)){p+=1;const D=F(e.buddy3s);w+=N(e.buddy3s),D!=0&&(k+=1,C=!0,l+=e.calcBaseHP*D)}c+=(_(e.magic1heal)+_(e.magic2heal)+(e.hasM3?_(e.magic3heal):0))*e.calcBaseATK,c+=($(e.magic1heal)+$(e.magic2heal)+(e.hasM3?$(e.magic3heal):0))*e.calcBaseHP,s+=e.evasion,C||(A+=1);let O=e.magic2pow;if(H[r])O="デュオ",P+=1;else{if(!H[r]){for(const[D,M]of a.entries())if(M.duo==e.chara&&e.duo==M.chara&&!H[r]&&!H[D]){H[r]=!0,H[D]=!0,m[r]=!0,m[D]=!0;break}if(!m[r]){for(const[D,M]of a.entries())if(e.duo==M.chara&&!H[r]&&!m[r]&&!f[D]){H[r]=!0,m[r]=!0,f[D]=!0;break}}if(!m[r]){for(const[D,M]of a.entries())if(e.duo==M.chara&&!H[r]&&!m[r]&&!m[D]){H[r]=!0,m[r]=!0,m[D]=!0;break}}}H[r]&&(O="デュオ",P+=1)}const S=W(e.magic1buf,e.magic1pow,e.magic1atr,e.calcBaseATK,w),K=W(e.magic2buf,O,e.magic2atr,e.calcBaseATK,w),B=e.hasM3?W(e.magic3buf,e.magic3pow,e.magic3atr,e.calcBaseATK,w):0,ee=e.magic1atr=="無"?S:S*1.5,ae=e.magic2atr=="無"?K:K*1.5,te=e.magic3atr=="無"?B:B*1.5,ne=h(e.magic1atr,"火",S),re=h(e.magic2atr,"火",K),se=h(e.magic3atr,"火",B),oe=h(e.magic1atr,"水",S),ie=h(e.magic2atr,"水",K),ce=h(e.magic3atr,"水",B),le=h(e.magic1atr,"木",S),ue=h(e.magic2atr,"木",K),me=h(e.magic3atr,"木",B);b.push(...V(S,K,B)),R.push(...V(ee,ae,te)),u.push(...V(ne,re,se)),q.push(...V(oe,ie,ce)),t.push(...V(le,ue,me))}),o=b.sort((e,r)=>r-e).slice(0,U.value).reduce((e,r)=>e+r,0),i=R.sort((e,r)=>r-e).slice(0,U.value).reduce((e,r)=>e+r,0),g=u.sort((e,r)=>r-e).slice(0,U.value).reduce((e,r)=>e+r,0),d=q.sort((e,r)=>r-e).slice(0,U.value).reduce((e,r)=>e+r,0),v=t.sort((e,r)=>r-e).slice(0,U.value).reduce((e,r)=>e+r,0),!(l<De.value)&&!(l+c<pe.value)&&!(k<ke.value)&&!(s<He.value)&&!(P<ye.value)&&!(o<Pe.value)&&!(i<he.value)&&!(g<Re.value)&&!(d<be.value)&&!(v<Ae.value))return o=Math.floor(o),i=Math.floor(i),g=Math.floor(g),d=Math.floor(d),v=Math.floor(v),[l,l+c,s,k,p,A,P,o,i,g,d,v,...T]}const Le={水:{火:1.5,木:.5},木:{水:1.5,火:.5},火:{木:1.5,水:.5}};function h(a,n,l){var s;const c=(s=Le[a])==null?void 0:s[n];return c?l*c:l}function Y(a){return function(n,l){for(let c=0;c<a.length;c++){const{key:s,order:k}=a[c];if(!Object.prototype.hasOwnProperty.call(n,s)||!Object.prototype.hasOwnProperty.call(l,s))continue;let p=0;if(n[s]<l[s]?p=-1:n[s]>l[s]&&(p=1),p!==0)return k==="降順"?p*-1:p}return 0}}function z(a){return a<=0?1:a*z(a-1)}async function je(a){for(const t of J.value)if(t.required&&t.level==0){j.value=a("error.requiredCharacter");return}const n=J.value.filter(t=>t.level>0),l=n.length;if(l<5){j.value=a("error.fewCharacter");return}Q.value=0;const c=Me(a),s=[];for(const t of we.value)for(let o=0;o<c.length;o++)if(c[o]==t.prop){let i="降順";switch(t.order){case"ASC":i="昇順";break;case"DESC":i="降順";break;case"昇順":case"降順":i=t.order;break;default:continue}s.push({key:Te[o],order:i})}const k=s[0].order==="昇順";async function p(){y.value.sort(Y(s));const t=y.value.slice(0,G.value);y.value=[...t],y.value.length>0&&(b=y.value[y.value.length-1][s[0].key]),await new Promise(requestAnimationFrame)}const A=new Set(["referenceDamage","referenceAdvantageDamage","referenceVsHiDamage","referenceVsMizuDamage","referenceVsKiDamage"]);s[0].key in A?n.sort((t,o)=>t.required&&!o.required?-1:!t.required&&o.required?1:o.atk-t.atk):n.sort((t,o)=>t.required&&!o.required?-1:!t.required&&o.required?1:o.hp-t.hp);const P=n.filter(t=>t.required).length;if(P>5){j.value="必須設定されたキャラが多すぎます";return}y.value=[],n.forEach(t=>{let o=110;t.rare=="SR"?o=90:t.rare=="R"&&(o=70);const i=t.level/o;t.calcBaseHP=(t.hp-t.base_hp)*i+t.base_hp,t.calcBaseATK=(t.atk-t.base_atk)*i+t.base_atk});let b=s[0].order==="昇順"?1/0:-1/0;const R=async(t,o,i,g,d)=>new Promise(v=>{const m=[n[t],n[o],n[i],n[g],n[d]],f=Ce(m);if(f){const H={hp:Math.round(f[0]),ehp:Math.round(f[1]),evasion:f[2],hpBuudy:f[3],buddy:f[4],noHpBuddy:f[5],duo:f[6],referenceDamage:f[7],referenceAdvantageDamage:f[8],referenceVsHiDamage:f[9],referenceVsMizuDamage:f[10],referenceVsKiDamage:f[11],chara1:f[12],chara2:f[13],chara3:f[14],chara4:f[15],chara5:f[16]},T=H[s[0].key];(k&&T<b||!k&&T>b)&&y.value.push(H)}Q.value+=1,v()}),u=new Array(5).fill(l);for(let t=0;t<P;t++)u[t]=t+1;if(Se.value){let t=Date.now();const o=u[0]*(u[1]-1)*(u[2]-2)*(u[3]-3);if(L.value=o*(u[4]-4)/z(5-P)+o*4/z(4-P),P==5){L.value=1,await R(0,1,2,3,4),await new Promise(requestAnimationFrame);return}for(let i=0;i<u[0];i++)for(let g=i+1;g<u[1];g++)for(let d=g+1;d<u[2];d++){if(!X.value)return;for(let v=d+1;v<u[3];v++){for(let m=v+1;m<u[4];m++)await R(i,g,d,v,m),Date.now()-t>2e3&&(t=Date.now(),await p());for(const m of[i,g,d,v])await R(i,g,d,v,m),Date.now()-t>2e3&&(t=Date.now(),await p())}}}else{const t=u[0]*(u[1]-1)*(u[2]-2)*(u[3]-3);if(L.value=t*(u[4]-4)/z(5-P),P==5){L.value=1,await R(0,1,2,3,4),await new Promise(requestAnimationFrame);return}let o=Date.now();for(let i=0;i<u[0];i++)for(let g=i+1;g<u[1];g++)for(let d=g+1;d<u[2];d++){if(!X.value)return;for(let v=d+1;v<u[3];v++)for(let m=v+1;m<u[4];m++)await R(i,g,d,v,m),Date.now()-o>2e3&&(o=Date.now(),await p())}}y.value.sort(Y(s));const q=y.value.slice(0,G.value);y.value=[...q],y.value.length>0&&(b=y.value[y.value.length-1][s[0].key])}export{de as a,je as b,Oe as c,Me as g,ge as u};

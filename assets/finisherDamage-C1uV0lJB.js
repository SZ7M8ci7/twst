import{b as la,l as he,h as oa}from"./common-DLahfTP9.js";import{useHandCollectionStore as ca}from"./handCollection-CFaOjp47.js";import{d as ra,i as ua,s as da,r as g,e as T,A as Se,aL as ma,q as Me,c as Z,w as r,j as h,g as o,a as s,C as fa,U as ke,G as va,t as C,u as Te,F as U,k as L,b1 as Le,l as x,E as oe,b as E,o as u,b2 as xe,v as q,_ as ga}from"./index-CULKxm2S.js";import{C as j}from"./CharacterIconWithType-BCs75T4T.js";import{r as ha}from"./calculations-qvwqQ9hv.js";import{c as J,V as Ee}from"./characters_info-C8RkqHGa.js";import{V as Pe,a as Ke}from"./VCard-KURSS1pb.js";import{V as Ve}from"./VCardText-Bjv1wJIC.js";import{V as ce}from"./VSpacer-ChzrSMJy.js";import{V as ka}from"./VContainer-B1WcbOlV.js";const Ca={key:0,class:"loading-container"},_a={class:"character-row"},ya={class:"damage-row"},ba=["onClick"],pa={class:"header-content"},wa=["src","alt"],Da={class:"sort-icon"},Ua={key:0,class:"sort-indicator"},Sa={key:1,class:"sort-hint"},Ma={class:"character-row all-characters-row"},Ta={class:"damage-row"},La={class:"damage-item all-characters-item"},xa=["onClick"],Ea={class:"damage-row"},Pa={class:"damage-item"},Ka=["onClick"],Va={class:"damage-item-content"},Aa={class:"card-info"},Ia={key:0,class:"buddy-cards"},ja={key:0,class:"buff-info"},$a={class:"buff-container"},Oa={key:0,class:"buff-source"},za={class:"damage-value"},Na={class:"pagination-controls"},Fa={class:"page-info"},Ha={class:"damage-item-content"},Ra={class:"card-info"},Ba={key:0,class:"buddy-cards"},Wa={key:0,class:"buff-info"},qa={class:"buff-container"},Ga={key:0,class:"buff-source"},Qa={class:"damage-value"},Xa={class:"pagination-controls"},Ya={class:"page-info"},Ae=50,Za=10,Ja=ra({__name:"finisherDamage",setup(ei){const{t:Ce}=ua(),Ie=la(),P=ca(),{characters:b}=da(Ie),_=g(!1),d=g(new Map),re=g({"--icon-size":`${Ae}px`,"--gap-size":`${Za}px`}),je={fire:"fire",water:"water",flora:"flora",cosmic:"cosmic"},ue=g(!0),K=T(()=>{const e={};for(const[a,i]of d.value.entries())e[a]=i.iconSrc||i.imgSrc||"";return e});Se(async()=>{try{const e=await he(b.value,"name"),a=await he(J,"name_en","icon/"),i={},n=new Map(J.map(t=>[t.name_ja,t.name_en]));b.value.forEach(t=>{const c=n.get(t.name);c&&a[c]&&(i[t.name]=a[c])});const l=await he(Object.values(je),t=>t,"icon/");d.value=oa(b.value,e,i,l);const m=new Set(d.value.keys());J.forEach(t=>{const c=a[t.name_en];c&&(t.name_ja&&!m.has(t.name_ja)&&d.value.set(t.name_ja,{type:"",wikiUrl:"",imgSrc:"",iconSrc:c}),t.name_en&&!m.has(t.name_en)&&d.value.set(t.name_en,{type:"",wikiUrl:"",imgSrc:"",iconSrc:c}))})}catch(e){console.error("Error in onMounted finisherDamage.vue:",e)}finally{ue.value=!1}});const $={},$e=["(極小)","(小)","(中)","(大)","(極大)"],Oe=["ATKUP","ダメージUP","無属性ダメージUP","火属性ダメージUP","水属性ダメージUP","木属性ダメージUP","被ダメージUP"],ze={"ATKUP(極小)":.1,"ATKUP(小)":.2,"ATKUP(中)":.35,"ATKUP(大)":.5,"ATKUP(極大)":.8},V={},O={},z={},N={},F={},G={},Q={},X={};function _e(){Object.keys($).forEach(e=>{$[e]=[]}),b.value.forEach(e=>{if(_.value&&!P.getHandCard(e.name).isOwned)return;const a=e.etc.split(",");$[e.chara]||($[e.chara]=[]),a.forEach(i=>{const n=i.trim();!n.includes("味方")&&!(n.includes("被ダメージUP")&&n.includes("相手"))||Oe.forEach(l=>{n.startsWith(l)&&$e.forEach(m=>{if(n.includes(m)){let t="";if(n.includes("(M1)")?t="M1":n.includes("(M2)")?t="M2":n.includes("(M3)")&&(t="M3"),t==="M3"){if(e.rare==="R"||e.rare==="SR")return;if(_.value){const c=P.getHandCard(e.name);if(c.isOwned&&!c.isM3)return}}$[e.chara].push({buff:l+m,name:e.name,buffSource:t})}})})})})}_e();function ye(){b.value.forEach(e=>{if(e.rare!="SSR")return;let a,i=!0;if(_.value){const k=P.getHandCard(e.name);if(k.isOwned){const v=Number(k.level),D=k.isLimitBreak;a=ha(e,v,D)}else i=!1,a=0}else a=Number(e.originalMaxATK)||Number(e.max_atk)||Number(e.atk)||0;if(!i)return;const n=de(e.buddy1s)+de(e.buddy2s)+de(e.buddy3s),l=Ne(e.etc),m=Fe(e.etc);let t=0,c=0,f=0,p=0;function w(k,v,D,le){const Ue=ze[v]||0,na=a+a*n+a*l+a*Ue;let y=0;const sa=k==="無"?1.1:1;if(v.includes(k+"属性ダメージUP")?(v.includes("(極小)")&&(y=.025),v.includes("(小)")&&(y=.06),v.includes("(中)")&&(y=.105),v.includes("(大)")&&(y=.15),v.includes("(極大)")&&(y=.27)):v.includes("ダメージUP")&&!v.includes("属性ダメージUP")&&(v.includes("(極小)")&&(y=.0225),v.includes("(小)")&&(y=.05),v.includes("(中)")&&(y=.0875),v.includes("(大)")&&(y=.125),v.includes("(極大)")&&(y=.225)),v!=""&&Ue==0&&y==0)return;const S=Math.floor(na*(sa+m+y)*2.4);F[e.name]||(F[e.name]=[],G[e.name]=[],Q[e.name]=[],X[e.name]=[]);const M={無:{fire:1,water:1,flora:1,cosmic:1},火:{fire:1,water:.5,flora:1.5,cosmic:1},水:{fire:1.5,water:1,flora:.5,cosmic:1},木:{fire:.5,water:1.5,flora:1,cosmic:1}}[k]||{fire:1,water:1,flora:1,cosmic:1};t=Math.max(S*M.fire,t),c=Math.max(S*M.water,c),f=Math.max(S*M.flora,f),p=Math.max(S*M.cosmic,p),F[e.name].push({damage:S*M.fire,name:D,buffSource:le}),G[e.name].push({damage:S*M.water,name:D,buffSource:le}),Q[e.name].push({damage:S*M.flora,name:D,buffSource:le}),X[e.name].push({damage:S*M.cosmic,name:D,buffSource:le})}w(e.magic2atr,"",Xe(e.duo),""),$[e.duo].forEach(k=>{if(k.buffSource==="M3"){const v=b.value.find(D=>D.name===k.name);if(v&&(v.rare==="R"||v.rare==="SR"))return;if(_.value){const D=P.getHandCard(k.name);if(D.isOwned&&!D.isM3)return}}w(e.magic2atr,k.buff,k.name,k.buffSource)}),V[e.chara]||(V[e.chara]=0,O[e.chara]=0,z[e.chara]=0,N[e.chara]=0),V[e.chara]=Math.max(V[e.chara],t),O[e.chara]=Math.max(O[e.chara],c),z[e.chara]=Math.max(z[e.chara],f),N[e.chara]=Math.max(N[e.chara],p)})}ye();function de(e){return e.includes("ATK")&&e.includes("小")?.2:e.includes("ATK")&&e.includes("中")?.35:0}function Ne(e){return e.includes("ATKUP(極小)(自/3T)")?.1:e.includes("ATKUP(小)(自/3T)")?.2:e.includes("ATKUP(中)(自/3T)")?.35:e.includes("ATKUP(大)(自/3T)")?.5:0}function Fe(e){return e.includes("ダメージUP(極小)(自/3T)")?.02:e.includes("ダメージUP(小)(自/3T)")?.05:e.includes("ダメージUP(中)(自/3T)")?.0875:e.includes("ダメージUP(大)(自/3T)")?.125:e.includes("被ダメージUP(中)(相手全体/2T)")?.0875:0}const ee={};b.value.forEach(e=>{e.rare=="SSR"&&(ee[e.chara]||(ee[e.chara]=[]),ee[e.chara].push(e.name))});const ae=g(!1),me=g([]),He=g(""),Re=g(""),A=g(1),ie=g(10),Be=T(()=>{const e=(A.value-1)*ie.value,a=e+ie.value;return Qe.value.slice(e,a)}),be=T(()=>Math.ceil(me.value.length/ie.value));function We(e,a){const i=fe(a),n=ee[e];if(!n||n.length===0)return;const l=n.flatMap(m=>(i[m]||[]).map(c=>({...c,cardName:m})));me.value=l,He.value=e,Re.value=a,A.value=1,ae.value=!0}function fe(e){return{fire:F,water:G,flora:Q,cosmic:X}[e]}const H=g(""),Y=g("desc");function qe(e){H.value===e?Y.value=Y.value==="asc"?"desc":"asc":(H.value=e,Y.value="desc")}const Ge=T(()=>{let e=[...J];return H.value?e.sort((a,i)=>{const n=te(a.name_ja,H.value),l=te(i.name_ja,H.value),m=typeof n=="number"?n:0,t=typeof l=="number"?l:0;return Y.value==="asc"?m-t:t-m}):e});function te(e,a){var l;if(e==="全キャラ"){const m=fe(a);let t=0;return b.value.filter(c=>c.rare==="SSR").forEach(c=>{if(_.value&&!P.getHandCard(c.name).isOwned)return;const f=m[c.name]||[],p=Math.max(...f.map(w=>w.damage),0);t=Math.max(t,p)}),Math.floor(t)}if(_.value&&!b.value.filter(t=>t.rare==="SSR"&&t.chara===e).some(t=>P.getHandCard(t.name).isOwned))return"-";const n=(l={fire:V,water:O,flora:z,cosmic:N}[a])==null?void 0:l[e];return n?Math.floor(n):"-"}const Qe=T(()=>[...me.value].sort((e,a)=>a.damage-e.damage));function Xe(e){const a=J.find(i=>i.name_ja===e);return(a==null?void 0:a.name_en)||""}function R(e){if(!e)return;const a=d.value.get(e);a&&a.wikiUrl&&window.open(a.wikiUrl,"_blank")}const ne=g(!1),ve=g([]),Ye=g("fire"),I=g(1),se=g(10),B=g(!1),W=g(!1);function ge(){const i=window.innerHeight*.95-60,l=Math.max(1,Math.floor(i/80));ie.value=l,se.value=l}Se(()=>{ge(),window.addEventListener("resize",ge)}),ma(()=>{window.removeEventListener("resize",ge)});const Ze=T(()=>{const e=(I.value-1)*se.value,a=e+se.value;return ea.value.slice(e,a)}),pe=T(()=>Math.ceil(ve.value.length/se.value));function Je(e){Ye.value=e;const a=fe(e);ve.value=b.value.filter(i=>i.rare==="SSR").flatMap(i=>(a[i.name]||[]).map(l=>({cardName:i.name,damage:l.damage,buffName:l.name||"",buffSource:l.buffSource||""}))),I.value=1,ne.value=!0}const ea=T(()=>[...ve.value].sort((e,a)=>a.damage-e.damage));function we(e){const a=b.value.find(n=>n.name===e);if(!a)return[];const i=[];return a.buddy1c&&a.buddy1s.includes("ATK")&&d.value.get(a.buddy1c)&&i.push(a.buddy1c),a.buddy2c&&a.buddy2s.includes("ATK")&&d.value.get(a.buddy2c)&&i.push(a.buddy2c),a.buddy3c&&a.buddy3s.includes("ATK")&&d.value.get(a.buddy3c)&&i.push(a.buddy3c),i}function aa(){_.value=!_.value}Me(()=>_.value,()=>{De()});function ia(){B.value=!B.value}function ta(){W.value=!W.value}Me(()=>P.handCollection,()=>{_.value&&De()},{deep:!0});function De(){ue.value||(Object.keys(V).forEach(e=>delete V[e]),Object.keys(O).forEach(e=>delete O[e]),Object.keys(z).forEach(e=>delete z[e]),Object.keys(N).forEach(e=>delete N[e]),Object.keys(F).forEach(e=>delete F[e]),Object.keys(G).forEach(e=>delete G[e]),Object.keys(Q).forEach(e=>delete Q[e]),Object.keys(X).forEach(e=>delete X[e]),_e(),ye())}return(e,a)=>(u(),Z(ka,{class:"finisher-container"},{default:r(()=>[ue.value?(u(),h("div",Ca,[o(fa,{indeterminate:"",color:"primary",size:64}),a[8]||(a[8]=s("p",{class:"loading-text"},"Loading...",-1))])):(u(),h(U,{key:1},[s("div",_a,[s("div",{class:"character-item",style:ke({...re.value})},[s("div",{class:va(["toggle-button",{active:_.value}]),onClick:aa},C(_.value?Te(Ce)("finisherDamage.handCollection"):Te(Ce)("finisherDamage.allCards")),3)],4),s("div",ya,[(u(),h(U,null,L(["Fire","Water","Flora","Cosmic"],i=>{var n;return s("div",{key:i,class:"damage-col"},[s("div",{class:"damage-item clickable-header",onClick:l=>qe(i.toLowerCase())},[s("div",pa,[a[9]||(a[9]=s("span",{class:"vs-text"},"VS",-1)),s("img",{src:((n=d.value.get(i.toLowerCase()))==null?void 0:n.imgSrc)||"",alt:i,class:"element-icon"},null,8,wa),s("span",Da,[H.value===i.toLowerCase()?(u(),h("span",Ua,C(Y.value==="asc"?"↑":"↓"),1)):(u(),h("span",Sa,"↕"))])])],8,ba)])}),64))])]),s("div",Ma,[s("div",{class:"character-item",style:ke({...re.value})},a[10]||(a[10]=[s("div",{class:"all-characters-label"},"ALL",-1)]),4),s("div",Ta,[(u(),h(U,null,L(["Fire","Water","Flora","Cosmic"],i=>s("div",{key:i,class:"damage-col"},[s("div",La,[s("span",{class:"clickable-damage",onClick:n=>Je(i.toLowerCase())},C(te("全キャラ",i.toLowerCase())),9,xa)])])),64))])]),(u(!0),h(U,null,L(Ge.value,i=>{var n;return u(),h("div",{key:i.name_en,class:"character-row"},[s("div",{class:"character-item",style:ke({...re.value})},[o(j,{iconKey:i.name_ja,iconDictionary:K.value,wikiUrl:((n=d.value.get(i.name_ja))==null?void 0:n.wikiUrl)||"",iconSize:Ae},null,8,["iconKey","iconDictionary","wikiUrl"])],4),s("div",Ea,[(u(),h(U,null,L(["Fire","Water","Flora","Cosmic"],l=>s("div",{key:l,class:"damage-col"},[s("div",Pa,[s("span",{class:"clickable-damage",onClick:m=>We(i.name_ja,l.toLowerCase())},C(te(i.name_ja,l.toLowerCase())),9,Ka)])])),64))])])}),128))],64)),o(Ee,{modelValue:ae.value,"onUpdate:modelValue":a[3]||(a[3]=i=>ae.value=i),"max-width":"450"},{default:r(()=>[o(Pe,null,{default:r(()=>[o(Ve,{class:"modal-content"},{default:r(()=>[o(Le,{class:"damage-list"},{default:r(()=>[(u(!0),h(U,null,L(Be.value,(i,n)=>(u(),Z(xe,{key:n,class:"damage-list-item"},{default:r(()=>{var l,m,t,c;return[s("div",Va,[s("div",Aa,[o(j,{iconKey:i.cardName||"",iconDictionary:K.value,wikiUrl:((l=d.value.get(i.cardName||""))==null?void 0:l.wikiUrl)||"",cardType:((m=d.value.get(i.cardName||""))==null?void 0:m.type)||"",iconSize:46,class:"card-icon clickable-icon",onClick:f=>R(i.cardName)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),i.cardName?(u(),h("div",Ia,[(u(!0),h(U,null,L(we(i.cardName),f=>{var p,w;return u(),Z(j,{key:f,iconKey:f,iconDictionary:K.value,wikiUrl:((p=d.value.get(f))==null?void 0:p.wikiUrl)||"",cardType:((w=d.value.get(f))==null?void 0:w.type)||"",iconSize:26,class:"buddy-icon clickable-icon",onClick:k=>R(f)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"])}),128))])):q("",!0)]),i.name?(u(),h("div",ja,[s("div",$a,[o(j,{iconKey:i.name,iconDictionary:K.value,wikiUrl:((t=d.value.get(i.name))==null?void 0:t.wikiUrl)||"",cardType:((c=d.value.get(i.name))==null?void 0:c.type)||"",iconSize:46,class:"buff-icon clickable-icon",onClick:f=>R(i.name)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),i.buffSource?(u(),h("span",Oa,C(i.buffSource),1)):q("",!0)])])):q("",!0),s("div",za,C(Math.floor(B.value?i.damage*1.25:i.damage).toLocaleString()),1)])]}),_:2},1024))),128))]),_:1})]),_:1}),o(Ke,null,{default:r(()=>[o(ce),s("div",Na,[o(x,{disabled:A.value===1,onClick:a[0]||(a[0]=i=>A.value--),variant:"text",size:"small",icon:""},{default:r(()=>[o(oe,null,{default:r(()=>a[11]||(a[11]=[E("mdi-chevron-left",-1)])),_:1,__:[11]})]),_:1},8,["disabled"]),s("span",Fa,C(A.value)+" / "+C(be.value),1),o(x,{disabled:A.value===be.value,onClick:a[1]||(a[1]=i=>A.value++),variant:"text",size:"small",icon:""},{default:r(()=>[o(oe,null,{default:r(()=>a[12]||(a[12]=[E("mdi-chevron-right",-1)])),_:1,__:[12]})]),_:1},8,["disabled"])]),o(ce),o(x,{color:B.value?"yellow":"green",variant:(B.value,"tonal"),class:"critical-btn",onClick:ia},{default:r(()=>[E(C(B.value?e.$t("finisherDamage.critical"):e.$t("finisherDamage.normal")),1)]),_:1},8,["color","variant"]),o(x,{color:"grey",variant:"outlined",class:"close-btn",onClick:a[2]||(a[2]=i=>ae.value=!1)},{default:r(()=>a[13]||(a[13]=[E("CLOSE",-1)])),_:1,__:[13]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(Ee,{modelValue:ne.value,"onUpdate:modelValue":a[7]||(a[7]=i=>ne.value=i),"max-width":"450"},{default:r(()=>[o(Pe,null,{default:r(()=>[o(Ve,{class:"modal-content"},{default:r(()=>[o(Le,{class:"damage-list"},{default:r(()=>[(u(!0),h(U,null,L(Ze.value,(i,n)=>(u(),Z(xe,{key:n,class:"damage-list-item"},{default:r(()=>{var l,m,t,c;return[s("div",Ha,[s("div",Ra,[o(j,{iconKey:i.cardName,iconDictionary:K.value,wikiUrl:((l=d.value.get(i.cardName))==null?void 0:l.wikiUrl)||"",cardType:((m=d.value.get(i.cardName))==null?void 0:m.type)||"",iconSize:46,class:"card-icon clickable-icon",onClick:f=>R(i.cardName)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),i.cardName?(u(),h("div",Ba,[(u(!0),h(U,null,L(we(i.cardName),f=>{var p,w;return u(),Z(j,{key:f,iconKey:f,iconDictionary:K.value,wikiUrl:((p=d.value.get(f))==null?void 0:p.wikiUrl)||"",cardType:((w=d.value.get(f))==null?void 0:w.type)||"",iconSize:26,class:"buddy-icon clickable-icon",onClick:k=>R(f)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"])}),128))])):q("",!0)]),i.buffName?(u(),h("div",Wa,[s("div",qa,[o(j,{iconKey:i.buffName,iconDictionary:K.value,wikiUrl:((t=d.value.get(i.buffName))==null?void 0:t.wikiUrl)||"",cardType:((c=d.value.get(i.buffName))==null?void 0:c.type)||"",iconSize:46,class:"buff-icon clickable-icon",onClick:f=>R(i.buffName)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),i.buffSource?(u(),h("span",Ga,C(i.buffSource),1)):q("",!0)])])):q("",!0),s("div",Qa,C(Math.floor(W.value?i.damage*1.25:i.damage).toLocaleString()),1)])]}),_:2},1024))),128))]),_:1})]),_:1}),o(Ke,null,{default:r(()=>[o(ce),s("div",Xa,[o(x,{disabled:I.value===1,onClick:a[4]||(a[4]=i=>I.value--),variant:"text",size:"small",icon:""},{default:r(()=>[o(oe,null,{default:r(()=>a[14]||(a[14]=[E("mdi-chevron-left",-1)])),_:1,__:[14]})]),_:1},8,["disabled"]),s("span",Ya,C(I.value)+" / "+C(pe.value),1),o(x,{disabled:I.value===pe.value,onClick:a[5]||(a[5]=i=>I.value++),variant:"text",size:"small",icon:""},{default:r(()=>[o(oe,null,{default:r(()=>a[15]||(a[15]=[E("mdi-chevron-right",-1)])),_:1,__:[15]})]),_:1},8,["disabled"])]),o(ce),o(x,{color:W.value?"yellow":"green",variant:(W.value,"tonal"),class:"critical-btn",onClick:ta},{default:r(()=>[E(C(W.value?e.$t("finisherDamage.critical"):e.$t("finisherDamage.normal")),1)]),_:1},8,["color","variant"]),o(x,{color:"grey",variant:"outlined",class:"close-btn",onClick:a[6]||(a[6]=i=>ne.value=!1)},{default:r(()=>a[16]||(a[16]=[E("CLOSE",-1)])),_:1,__:[16]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),mi=ga(Ja,[["__scopeId","data-v-b0072080"]]);export{mi as default};

import{u as C}from"./characters-2dba27d8.js";import{aB as L,y as B}from"./index-9f025244.js";const O=L("searchSettings",{state:()=>({minEHP:6e4,minHP:5e4,minHPBuddy:0,minEvasion:0,maxResult:10,sortOptions:[{prop:"実質HP",order:"降順"}],allowSameCharacter:!0}),actions:{updateSearchSettings(t){Object.assign(this,t)}}}),j=L("searchResult",{state:()=>({totalResults:0,nowResults:0,results:[],isSearching:!1,errorMessage:""})}),E=O(),{minEHP:F,minHP:M,minHPBuddy:U,minEvasion:x,maxResult:P,sortOptions:_,allowSameCharacter:K}=B(E),N=C(),{characters:q}=B(N),I=j(),{totalResults:w,nowResults:D,results:l,isSearching:T,errorMessage:H}=B(I);function Q(t){(t.key==="e"||t.key==="+")&&t.preventDefault()}const A=["実質HP","実HP","HPバディ数","HPバディが存在しないキャラ数","バディ数","回避数"],z=["ehp","hp","hpBuudy","noHpBuddy","buddy","evasion"];function R(t){return t=="HPUP(小)"||t=="HP&ATKUP(小)"?.2:t=="HPUP(中)"||t=="HP&ATKUP(中)"?.3:0}function S(t){return t=="回復(小)"||t=="回復&継続回復(小)"?1.1:t=="回復(中)"||t=="回復&継続回復(中)"?1.7:0}function b(t){return t=="継続回復(小)"||t=="回復&継続回復(小)"?.15*3:t=="継続回復(中)"||t=="回復&継続回復(中)"?.25*3:0}function Z(t){const m=new Set;for(const e of t)m.add(e.chara);let o=0,s=0,u=0,v=0,r=0,p=0;const a=[];for(const e of t){a.push(e.imgUrl);let c=110;e.rare=="SR"?c=90:e.rare=="R"&&(c=70);const h=e.level/c,i=(e.hp-e.base_hp)*h+e.base_hp,f=(e.atk-e.base_atk)*h+e.base_atk;o+=i;let d=!1;if(m.has(e.buddy1c)){r+=1;const n=R(e.buddy1s);n!=0&&(v+=1,d=!0,o+=i*n)}if(m.has(e.buddy2c)){r+=1;const n=R(e.buddy2s);n!=0&&(v+=1,d=!0,o+=i*n)}if(m.has(e.buddy3c)){r+=1;const n=R(e.buddy3s);n!=0&&(v+=1,d=!0,o+=i*n)}s+=S(e.magic1heal)*f,s+=S(e.magic2heal)*f,s+=S(e.magic3heal)*f,s+=b(e.magic1heal)*i,s+=b(e.magic2heal)*i,s+=b(e.magic3heal)*i,u+=e.evasion,d||(p+=1)}if(!(o<M.value)&&!(o+s<F.value)&&!(v<U.value)&&!(u<x.value))return a.sort(),[o,o+s,u,v,r,p,...a]}function g(t){return function(m,o){for(let s=0;s<t.length;s++){const{key:u,order:v}=t[s];if(!Object.prototype.hasOwnProperty.call(m,u)||!Object.prototype.hasOwnProperty.call(o,u))continue;let r=0;if(m[u]<o[u]?r=-1:m[u]>o[u]&&(r=1),r!==0)return v==="降順"?r*-1:r}return 0}}function k(t){return t<=0?1:t*k(t-1)}async function V(){for(const a of q.value)if(a.required&&a.level==0){H.value="必須キャラのレベルは1以上にして下さい";return}const t=q.value.filter(a=>a.level>0),m=t.length;if(m<5){H.value="レベル設定されたキャラが少なすぎます";return}D.value=0;const o=[];for(const a of _.value)for(let e=0;e<A.length;e++)A[e]==a.prop&&o.push({key:z[e],order:a.order});t.sort((a,e)=>a.required&&!e.required?-1:!a.required&&e.required?1:e.hp-a.hp);const s=t.filter(a=>a.required).length;if(s>5){H.value="必須設定されたキャラが多すぎます";return}l.value=[];let u=o[0].order==="昇順"?1/0:-1/0;const v=async(a,e,c,h,i)=>new Promise(f=>{const d=[t[a],t[e],t[c],t[h],t[i]],n=Z(d);if(n){const y={hp:Math.round(n[0]),ehp:Math.round(n[1]),evasion:n[2],hpBuudy:n[3],buddy:n[4],noHpBuddy:n[5],chara1:n[6],chara2:n[7],chara3:n[8],chara4:n[9],chara5:n[10]};(o[0].order==="昇順"&&y[o[0].key]<u||o[0].order==="降順"&&y[o[0].key]>u)&&l.value.push(y)}D.value+=1,f()}),r=new Array(5).fill(m);for(let a=0;a<s;a++)r[a]=a+1;if(K.value){let a=Date.now();const e=r[0]*(r[1]-1)*(r[2]-2)*(r[3]-3);if(w.value=e*(r[4]-4)/k(5-s)+e*4/k(4-s),s==5){w.value=1,await v(0,1,2,3,4),await new Promise(requestAnimationFrame);return}for(let c=0;c<r[0];c++)for(let h=c+1;h<r[1];h++)for(let i=h+1;i<r[2];i++)for(let f=i+1;f<r[3];f++){for(let d=f+1;d<r[4];d++){if(!T.value)return;if(await v(c,h,i,f,d),Date.now()-a>500){a=Date.now(),l.value.sort(g(o));const n=l.value.slice(0,P.value);l.value=[...n],l.value.length>0&&(u=l.value[l.value.length-1][o[0].key]),await new Promise(requestAnimationFrame)}}for(const d of[c,h,i,f])if(await v(c,h,i,f,d),Date.now()-a>500){a=Date.now(),l.value.sort(g(o));const n=l.value.slice(0,P.value);l.value=[...n],l.value.length>0&&(u=l.value[l.value.length-1][o[0].key]),await new Promise(requestAnimationFrame)}}}else{const a=r[0]*(r[1]-1)*(r[2]-2)*(r[3]-3);if(w.value=a*(r[4]-4)/k(5-s),s==5){w.value=1,await v(0,1,2,3,4),await new Promise(requestAnimationFrame);return}let e=Date.now();for(let c=0;c<r[0];c++)for(let h=c+1;h<r[1];h++)for(let i=h+1;i<r[2];i++)for(let f=i+1;f<r[3];f++)for(let d=f+1;d<r[4];d++){if(!T.value)return;if(await v(c,h,i,f,d),Date.now()-e>1e3){e=Date.now(),l.value.sort(g(o));const n=l.value.slice(0,P.value);l.value=[...n],l.value.length>0&&(u=l.value[l.value.length-1][o[0].key]),await new Promise(requestAnimationFrame)}}}l.value.sort(g(o));const p=l.value.slice(0,P.value);l.value=[...p],l.value.length>0&&(u=l.value[l.value.length-1][o[0].key])}export{A as a,j as b,Q as c,V as d,O as u};

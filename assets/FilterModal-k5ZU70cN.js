import{b as Re,j as Fe,l as We}from"./common-CmfxSjsL.js";import{I as Ee,r as d,d as Oe,i as Ve,s as me,e as b,A as Be,q as Ue,aO as $e,j as i,G as pe,a as h,g as S,l as F,w as W,b as E,t as B,u as g,F as O,k as V,o as c,U as he,_ as Te}from"./index-4Z_4EGii.js";import{c as X}from"./characters_info-C9WwiqQh.js";import Se from"./default-pkSoNB1x.js";import{V as H}from"./VCheckbox-C7pZwxUW.js";let I=null,j=!1,ee=null,le=!1;function Pe(){return j&&I?I:null}function ze(s){I=s,j=!0}function De(){return le&&ee?ee:null}function xe(s){ee=s,le=!0}const Ge=Ee("filterd",()=>{const s=Pe(),C=De(),n=d((s==null?void 0:s.selectedCharacters)||[]),U=d((s==null?void 0:s.selectedRare)||[]),$=d((s==null?void 0:s.selectedType)||[]),y=d((s==null?void 0:s.selectedAttr)||[]),k=d((s==null?void 0:s.selectedEffects)||[]),_=d(!s),M=d((C==null?void 0:C.sortBy)||"default"),A=d((C==null?void 0:C.sortOrder)||"asc");function w(){const r={selectedCharacters:n.value,selectedRare:U.value,selectedType:$.value,selectedAttr:y.value,selectedEffects:k.value};ze(r)}function z(){const r={sortBy:M.value,sortOrder:A.value};xe(r)}function u(){n.value=[],U.value=[],$.value=[],y.value=[],k.value=[],_.value=!0,I=null,j=!1}function v(){j=!0}function m(){le=!0}return{tempSelectedCharacters:n,tempSelectedRare:U,isFirst:_,tempSelectedType:$,tempSelectedAttr:y,tempSelectedEffects:k,sortBy:M,sortOrder:A,saveCurrentState:w,saveCurrentSortState:z,resetFilterState:u,markFilterAsModified:v,markSortAsModified:m}}),He={class:"feature-select-all-container"},Ie={class:"feature-items"},je={class:"display-block"},Le={class:"character-global-select-container"},Ke={class:"character-list-wrapper"},Ne={class:"character-select-all-container"},qe={class:"character-items"},Je=["onClick"],Qe=["src","alt"],Xe={class:"feature-select-all-container"},Ye={class:"feature-items"},Ze={key:0,class:"button-container"},el={key:1,class:"button-container embedded-buttons"},Y=50,Z=10,ll=Oe({__name:"FilterModal",props:{embedded:{type:Boolean,default:!1}},emits:["close","filter-applied"],setup(s,{emit:C}){const{t:n}=Ve(),U=Re(),{characters:$}=me(U),y=Ge(),{tempSelectedCharacters:k,tempSelectedRare:_,tempSelectedType:M,tempSelectedAttr:A,tempSelectedEffects:w,isFirst:z}=me(y),u=d([]),v=d([]),m=d([]),r=d([]),f=d([]),te=C,ae=d(0),se=d({}),ne=s;d({"--icon-size":`${Y}px`,"--gap-size":`${Z}px`});const ue=["SSR","SR","R"],oe=b(()=>[{name:n("filterModal.balance"),value:"バランス"},{name:n("filterModal.defence"),value:"ディフェンス"},{name:n("filterModal.attack"),value:"アタック"}]),re=b(()=>[{name:n("filterModal.fire"),value:"火"},{name:n("filterModal.water"),value:"水"},{name:n("filterModal.flora"),value:"木"},{name:n("filterModal.cosmic"),value:"無"}]),D=b(()=>Fe.map(e=>({name:n(`filterModal.${e.name}`),value:e.value}))),T=X.reduce((e,l)=>{const t=l.dorm;return e[t]||(e[t]=[]),e[t].push(l),e},{}),L=new Map;X.forEach(e=>{L.set(e.name_ja,e),L.set(e.name_en,e)});const ie=()=>{const e=document.querySelector(".display-block");e&&(ae.value=e.clientWidth)},ce=()=>{ie()};Be(async()=>{z.value?(u.value=x.value,v.value=["SSR"],m.value=["バランス","ディフェンス","アタック"],r.value=["火","水","木","無"],f.value=["ATKUP","ダメージUP","クリティカル","属性ダメージUP","被ダメージUP","ATKDOWN","ダメージDOWN","回避","属性ダメージDOWN","被ダメージDOWN","HP回復","HP継続回復","暗闇無効","呪い無効","凍結無効","デバフ解除","呪い"]):(k.value.length>0&&(u.value=[...k.value]),_.value.length>0&&(v.value=[..._.value]),M.value.length>0&&(m.value=[...M.value]),A.value.length>0&&(r.value=[...A.value]),w.value.length>0&&(f.value=[...w.value])),z.value=!1,ie(),window.addEventListener("resize",ce),se.value=await We(X,e=>e.name_en,"icon/"),ne.embedded&&Ue([u,v,m,r,f],()=>{k.value=[...u.value],_.value=[...v.value],M.value=[...m.value],A.value=[...r.value],w.value=[...f.value],y.markFilterAsModified(),y.saveCurrentState(),q()},{deep:!0})}),$e(()=>{window.removeEventListener("resize",ce)});function ye(){k.value=[...u.value],_.value=[...v.value],M.value=[...m.value],A.value=[...r.value],w.value=[...f.value],y.markFilterAsModified(),y.saveCurrentState(),q(),te("filter-applied"),ne.embedded||te("close")}function be(){u.value=x.value,v.value=["SSR"],m.value=["バランス","ディフェンス","アタック"],r.value=["火","水","木","無"],f.value=["ATKUP","ダメージUP","クリティカル","属性ダメージUP","被ダメージUP","ATKDOWN","ダメージDOWN","回避","属性ダメージDOWN","被ダメージDOWN","HP回復","HP継続回復","暗闇無効","呪い無効","凍結無効","デバフ解除","呪い"],k.value=[...u.value],_.value=[...v.value],M.value=[...m.value],A.value=[...r.value],w.value=[...f.value],y.resetFilterState(),q()}const R=b(()=>new Set(u.value)),K=b(()=>new Set(v.value)),N=b(()=>new Set(m.value)),P=b(()=>new Set(r.value)),de=b(()=>new Set(f.value)),x=b(()=>Object.values(T).flat().map(e=>e.name_en)),ge=e=>{const l=R.value.has(e);return{"--icon-size":`${Y}px`,"--gap-size":`${Z}px`,opacity:l?1:.5}};function q(){$.value.forEach(e=>{if(!K.value.has(e.rare)){e.visible=!1;return}const l=L.get(e.chara);if(!l||!R.value.has(l.name_en)){e.visible=!1;return}if(!N.value.has(e.attr)){e.visible=!1;return}if(!P.value.has(e.magic1atr)&&!P.value.has(e.magic2atr)&&!P.value.has(e.magic3atr)){e.visible=!1;return}if(f.value.length===17)e.visible=!0;else if(f.value.length===0){e.visible=!1;return}else if(f.value.some(o=>e.etc.includes(o)))e.visible=!0;else{e.visible=!1;return}})}function ke(e){const l=e.target;l.src=Se}function J(e){if(e==="statusEffects")D.value.every(t=>de.value.has(t.value))?f.value=[]:f.value=D.value.map(t=>t.value);else if(e==="cardAttributes"){const l=["SSR","SR","R"].every(a=>K.value.has(a)),t=["バランス","ディフェンス","アタック"].every(a=>N.value.has(a)),o=["火","水","木","無"].every(a=>P.value.has(a));l&&t&&o?(v.value=[],m.value=[],r.value=[]):(v.value=["SSR","SR","R"],m.value=["バランス","ディフェンス","アタック"],r.value=["火","水","木","無"])}else{const l=T[e]||[],t=R.value;l.every(a=>t.has(a.name_en))?u.value=u.value.filter(a=>!l.some(p=>p.name_en===a)):u.value=[...new Set([...u.value,...l.map(a=>a.name_en)])]}}function Q(e){return e==="cardAttributes"?ue.every(t=>K.value.has(t))&&oe.value.every(t=>N.value.has(t.value))&&re.value.every(t=>P.value.has(t.value)):e==="statusEffects"?D.value.every(t=>de.value.has(t.value)):T[e].every(t=>R.value.has(t.name_en))}function Ce(e){const l=R.value;u.value=l.has(e)?u.value.filter(t=>t!==e):[...u.value,e]}const _e=e=>64+(Y+10+Z)*e.length+10,Me=e=>({width:e===1?"100%":"50%"}),Ae=b(()=>{const e=[];let l=[],t=0;const o=ae.value,a=2;return Object.entries(T).forEach(([p,fe])=>{const G=_e(fe);G>=o/a?(l.length>0&&(e.push(l),l=[],t=0),e.push([p])):t+G<=o&&l.length<a?(l.push(p),t+=G):(e.push(l),l=[p],t=G)}),l.length>0&&e.push(l),e});function we(){ve()?u.value=[]:u.value=[...x.value]}function ve(){return x.value.every(e=>R.value.has(e))}return(e,l)=>(c(),i("div",{class:pe(["modal-background",{embedded:s.embedded}]),ref:"modalContainer"},[h("div",He,[S(F,{small:"",onClick:l[0]||(l[0]=t=>J("cardAttributes"))},{default:W(()=>[E(B(Q("cardAttributes")?g(n)("filterModal.release"):g(n)("filterModal.select")),1)]),_:1}),h("div",Ie,[(c(),i(O,null,V(ue,(t,o)=>h("div",{class:"feature-item",key:`rare-${o}`},[S(H,{modelValue:v.value,"onUpdate:modelValue":l[1]||(l[1]=a=>v.value=a),value:t,label:t,"hide-details":""},null,8,["modelValue","value","label"])])),64)),(c(!0),i(O,null,V(oe.value,(t,o)=>(c(),i("div",{class:"feature-item",key:`type-${o}`},[S(H,{modelValue:m.value,"onUpdate:modelValue":l[2]||(l[2]=a=>m.value=a),value:t.value,label:t.name,"hide-details":""},null,8,["modelValue","value","label"])]))),128)),(c(!0),i(O,null,V(re.value,(t,o)=>(c(),i("div",{class:"feature-item",key:`attr-${o}`},[S(H,{modelValue:r.value,"onUpdate:modelValue":l[3]||(l[3]=a=>r.value=a),value:t.value,label:t.name,"hide-details":""},null,8,["modelValue","value","label"])]))),128))])]),l[8]||(l[8]=h("hr",{class:"rare-divider"},null,-1)),h("div",je,[h("div",Le,[S(F,{small:"",onClick:we},{default:W(()=>[E(B(ve()?g(n)("filterModal.release"):g(n)("filterModal.select")),1)]),_:1})]),h("div",Ke,[(c(!0),i(O,null,V(Ae.value,(t,o)=>(c(),i("div",{key:o,class:"row"},[(c(!0),i(O,null,V(t,a=>(c(),i("div",{key:a,style:he(Me(t.length)),class:"character-list"},[h("div",Ne,[S(F,{small:"",onClick:p=>J(a)},{default:W(()=>[E(B(Q(a)?g(n)("filterModal.release"):g(n)("filterModal.select")),1)]),_:2},1032,["onClick"]),h("div",qe,[(c(!0),i(O,null,V(g(T)[a],p=>(c(),i("div",{key:p.name_en,class:pe(["character-item",{selected:R.value.has(p.name_en)}]),onClick:fe=>Ce(p.name_en),style:he(ge(p.name_en))},[h("img",{src:se.value[p.name_en]||g(Se),alt:p.name_en,class:"character-image",onError:ke},null,40,Qe)],14,Je))),128))])])],4))),128))]))),128))])]),l[9]||(l[9]=h("hr",{class:"rare-divider"},null,-1)),h("div",Xe,[S(F,{small:"",onClick:l[4]||(l[4]=t=>J("statusEffects"))},{default:W(()=>[E(B(Q("statusEffects")?g(n)("filterModal.release"):g(n)("filterModal.select")),1)]),_:1}),h("div",Ye,[(c(!0),i(O,null,V(D.value,t=>(c(),i("div",{key:t.name,class:"feature-item"},[S(H,{modelValue:f.value,"onUpdate:modelValue":l[5]||(l[5]=o=>f.value=o),value:t.value,label:t.name,"hide-details":""},null,8,["modelValue","value","label"])]))),128))])]),s.embedded?(c(),i("div",el,[S(F,{class:"button reset-button",onClick:be,variant:"outlined",size:"small"},{default:W(()=>[...l[7]||(l[7]=[E(" フィルターリセット ",-1)])]),_:1})])):(c(),i("div",Ze,[S(F,{class:"button",onClick:l[6]||(l[6]=t=>e.$emit("close"))},{default:W(()=>[E(B(e.$t("filterModal.cancel")),1)]),_:1}),S(F,{class:"button apply-button",disabled:u.value.length===0||v.value.length===0,onClick:ye},{default:W(()=>[E(B(e.$t("filterModal.submit")),1)]),_:1},8,["disabled"])]))],2))}}),ol=Te(ll,[["__scopeId","data-v-f51d2e3c"]]);export{ol as F,Ge as u};

import{u as ve}from"./characters-f9b0f420.js";import{as as ae,y as G}from"./index-0538e201.js";const pe=ae("searchSettings",{state:()=>({minEHP:3e4,minHP:3e4,minHPBuddy:0,minEvasion:0,minDuo:0,minBuff:0,minDebuff:0,minReferenceDamage:0,minReferenceAdvantageDamage:0,minReferenceVsHiDamage:0,minReferenceVsMizuDamage:0,minReferenceVsKiDamage:0,maxResult:10,attackNum:10,sortOptions:[{prop:"HP",order:"降順"}],allowSameCharacter:!0}),actions:{updateSearchSettings(t){Object.assign(this,t)}}}),De=ae("searchResult",{state:()=>({totalResults:0,nowResults:0,results:[],isSearching:!1,errorMessage:""})}),ke=pe(),{minEHP:He,minHP:ye,minDebuff:Pe,minBuff:Re,minHPBuddy:be,minEvasion:he,minDuo:Ae,minReferenceDamage:we,minReferenceAdvantageDamage:Be,minReferenceVsHiDamage:Se,minReferenceVsKiDamage:Ke,minReferenceVsMizuDamage:Me,maxResult:X,sortOptions:Te,allowSameCharacter:Ue,attackNum:V}=G(ke),Ve=ve(),{characters:Y}=G(Ve),Le=De(),{totalResults:z,nowResults:x,results:y,isSearching:ee,errorMessage:j}=G(Le);function $e(t){(t.key==="e"||t.key==="+")&&t.preventDefault()}function qe(t){return[t("comments.HP"),t("comments.effectiveHP"),t("comments.HPBuddy"),t("comments.noHPBuddy"),t("comments.buddy"),t("comments.evasion"),t("comments.duo"),t("comments.buff"),t("comments.debuff"),t("comments.neutralDamage"),t("comments.advantageDamage"),t("comments.damageAgainstFire"),t("comments.damageAgainstWater"),t("comments.damageAgainstFlora")]}const Ce=["hp","ehp","hpBuudy","noHpBuddy","buddy","evasion","duo","buff","debuff","referenceDamage","referenceAdvantageDamage","referenceVsHiDamage","referenceVsMizuDamage","referenceVsKiDamage"],O={"HPUP(小)":{hp:.2,atk:0,heal:0,conHeal:0},"HP&ATKUP(小)":{hp:.2,atk:.2,heal:0,conHeal:0},"HPUP(中)":{hp:.3,atk:0,heal:0,conHeal:0},"HP&ATKUP(中)":{hp:.3,atk:.35,heal:0,conHeal:0},"ATKUP(小)":{hp:0,atk:.2,heal:0,conHeal:0},"ATKUP(中)":{hp:0,atk:.35,heal:0,conHeal:0},"回復(小)":{hp:0,atk:0,heal:1.1,conHeal:0},"回復&継続回復(小)":{hp:0,atk:0,heal:1.1,conHeal:.15*3},"回復(中)":{hp:0,atk:0,heal:1.7,conHeal:0},"回復&継続回復(中)":{hp:0,atk:0,heal:1.7,conHeal:.25*3},"継続回復(小)":{hp:0,atk:0,heal:0,conHeal:.15*3},"継続回復(中)":{hp:0,atk:0,heal:0,conHeal:.25*3}};function F(t){var r;return((r=O[t])==null?void 0:r.hp)||0}function N(t){var r;return((r=O[t])==null?void 0:r.atk)||0}function $(t){var r;return((r=O[t])==null?void 0:r.heal)||0}function I(t){var r;return((r=O[t])==null?void 0:r.conHeal)||0}const ze={"ATKUP(極小)":1.1,"ATKUP(小)":1.2,"ATKUP(中)":1.35,"ATKUP(大)":1.5,"ATKUP(極大)":1.8},Ee={"ダメUP(極小)":.025,"ダメUP(小)":.05,"ダメUP(中)":.0875,"ダメUP(大)":.125,"ダメUP(極大)":.1875,"属性ダメUP(極小)":.03,"属性ダメUP(小)":.06,"属性ダメUP(中)":.1005,"属性ダメUP(大)":.15,"属性ダメUP(極大)":.27},W={};function Oe(t,r,u,c){const s=`${t},${r},${u},${c}`;if(s in W)return W[s];let k=r.includes("弱")?.75:1;k*=u==="無"?1.1:1,k+=Ee[t]||0;let v=1;r.includes("連撃")?v=1.8:r.includes("デュオ")&&(v=2.4);const w=c*k*v;return W[s]=w,w}function Z(t,r,u,c,s){return c=(ze[t]||1)*c+c*s,Oe(t,r,u=="無"?"無":"無以外",c)}function L(t,r,u){const c=[t,r,u];return c.sort((s,k)=>k-s),[c[0],c[1]]}function _e(t){const r=new Set;for(const e of t)r.add(e.chara);let u=0,c=0,s=0,k=0,v=0,w=0,R=0,A=0,b=0;const l=[],q=[],a=[],o=[],f=[];let m=0,g=0,d=0,D=0,i=0;const H={},B={},P={},J=[];let Q="";if(t.sort((e,n)=>n.calcBaseATK-e.calcBaseATK),t.forEach((e,n)=>{H[n]=!1,B[n]=!1,P[n]=!1}),t.forEach((e,n)=>{J.push(e.imgUrl),Q+="&name"+(n+1)+"="+e.name,u+=e.calcBaseHP,R+=e.buff_count,A+=e.debuff_count;let C=!1,S=0;if(r.has(e.buddy1c)){v+=1;const p=F(e.buddy1s);S+=N(e.buddy1s),p!=0&&(k+=1,C=!0,u+=e.calcBaseHP*p)}if(r.has(e.buddy2c)){v+=1;const p=F(e.buddy2s);S+=N(e.buddy2s),p!=0&&(k+=1,C=!0,u+=e.calcBaseHP*p)}if(r.has(e.buddy3c)){v+=1;const p=F(e.buddy3s);S+=N(e.buddy3s),p!=0&&(k+=1,C=!0,u+=e.calcBaseHP*p)}c+=($(e.magic1heal)+$(e.magic2heal)+(e.hasM3?$(e.magic3heal):0))*e.calcBaseATK,c+=(I(e.magic1heal)+I(e.magic2heal)+(e.hasM3?I(e.magic3heal):0))*e.calcBaseHP,s+=e.evasion,C||(w+=1);let _=e.magic2pow;if(P[n])_="デュオ",b+=1;else{if(!P[n]){for(const[p,U]of t.entries())if(U.duo==e.chara&&e.duo==U.chara&&!P[n]&&!P[p]){P[n]=!0,P[p]=!0,H[n]=!0,H[p]=!0;break}if(!H[n]){for(const[p,U]of t.entries())if(e.duo==U.chara&&!P[n]&&!H[n]&&!B[p]){P[n]=!0,H[n]=!0,B[p]=!0;break}}if(!H[n]){for(const[p,U]of t.entries())if(e.duo==U.chara&&!P[n]&&!H[n]&&!H[p]){P[n]=!0,H[n]=!0,H[p]=!0;break}}}P[n]&&(_="デュオ",b+=1)}const K=Z(e.magic1buf,e.magic1pow,e.magic1atr,e.calcBaseATK,S),M=Z(e.magic2buf,_,e.magic2atr,e.calcBaseATK,S),T=e.hasM3?Z(e.magic3buf,e.magic3pow,e.magic3atr,e.calcBaseATK,S):0,ne=e.magic1atr=="無"?K:K*1.5,re=e.magic2atr=="無"?M:M*1.5,se=e.magic3atr=="無"?T:T*1.5,oe=h(e.magic1atr,"火",K),ie=h(e.magic2atr,"火",M),ce=h(e.magic3atr,"火",T),ue=h(e.magic1atr,"水",K),le=h(e.magic2atr,"水",M),fe=h(e.magic3atr,"水",T),me=h(e.magic1atr,"木",K),ge=h(e.magic2atr,"木",M),de=h(e.magic3atr,"木",T);l.push(...L(K,M,T)),q.push(...L(ne,re,se)),a.push(...L(oe,ie,ce)),o.push(...L(ue,le,fe)),f.push(...L(me,ge,de))}),m=l.sort((e,n)=>n-e).slice(0,V.value).reduce((e,n)=>e+n,0),g=q.sort((e,n)=>n-e).slice(0,V.value).reduce((e,n)=>e+n,0),d=a.sort((e,n)=>n-e).slice(0,V.value).reduce((e,n)=>e+n,0),D=o.sort((e,n)=>n-e).slice(0,V.value).reduce((e,n)=>e+n,0),i=f.sort((e,n)=>n-e).slice(0,V.value).reduce((e,n)=>e+n,0),!(u<ye.value)&&!(u+c<He.value)&&!(k<be.value)&&!(s<he.value)&&!(b<Ae.value)&&!(R<Re.value)&&!(A<Pe.value)&&!(m<we.value)&&!(g<Be.value)&&!(d<Se.value)&&!(D<Me.value)&&!(i<Ke.value))return m=Math.floor(m),g=Math.floor(g),d=Math.floor(d),D=Math.floor(D),i=Math.floor(i),[u,u+c,s,k,v,w,b,R,A,m,g,d,D,i,...J,Q]}const je={水:{火:1.5,木:.5},木:{水:1.5,火:.5},火:{木:1.5,水:.5}};function h(t,r,u){var s;const c=(s=je[t])==null?void 0:s[r];return c?u*c:u}function te(t){return function(r,u){for(let c=0;c<t.length;c++){const{key:s,order:k}=t[c];if(!Object.prototype.hasOwnProperty.call(r,s)||!Object.prototype.hasOwnProperty.call(u,s))continue;let v=0;if(r[s]<u[s]?v=-1:r[s]>u[s]&&(v=1),v!==0)return k==="降順"?v*-1:v}return 0}}function E(t){return t<=0?1:t*E(t-1)}async function Ie(t){for(const a of Y.value)if(a.required&&a.level==0){j.value=t("error.requiredCharacter");return}const r=Y.value.filter(a=>a.level>0),u=r.length;if(u<5){j.value=t("error.fewCharacter");return}x.value=0;const c=qe(t),s=[];for(const a of Te.value)for(let o=0;o<c.length;o++)if(c[o]==a.prop){let f="降順";switch(a.order){case"ASC":f="昇順";break;case"DESC":f="降順";break;case"昇順":case"降順":f=a.order;break;default:continue}s.push({key:Ce[o],order:f})}const k=s[0].order==="昇順";async function v(){y.value.sort(te(s));const a=y.value.slice(0,X.value);y.value=[...a],y.value.length>0&&(A=y.value[y.value.length-1][s[0].key]),await new Promise(requestAnimationFrame)}const w=new Set(["referenceDamage","referenceAdvantageDamage","referenceVsHiDamage","referenceVsMizuDamage","referenceVsKiDamage"]);s[0].key in w?r.sort((a,o)=>a.required&&!o.required?-1:!a.required&&o.required?1:o.atk-a.atk):r.sort((a,o)=>a.required&&!o.required?-1:!a.required&&o.required?1:o.hp-a.hp);const R=r.filter(a=>a.required).length;if(R>5){j.value="必須設定されたキャラが多すぎます";return}y.value=[],r.forEach(a=>{let o=110;a.rare=="SR"?o=90:a.rare=="R"&&(o=70);const f=a.level/o;a.calcBaseHP=(a.hp-a.base_hp)*f+a.base_hp,a.calcBaseATK=(a.atk-a.base_atk)*f+a.base_atk});let A=s[0].order==="昇順"?1/0:-1/0;const b=async(a,o,f,m,g)=>new Promise(d=>{const D=[r[a],r[o],r[f],r[m],r[g]],i=_e(D);if(i){const H={hp:Math.round(i[0]),ehp:Math.round(i[1]),evasion:i[2],hpBuudy:i[3],buddy:i[4],noHpBuddy:i[5],duo:i[6],buff:i[7],debuff:i[8],referenceDamage:i[9],referenceAdvantageDamage:i[10],referenceVsHiDamage:i[11],referenceVsMizuDamage:i[12],referenceVsKiDamage:i[13],chara1:i[14],chara2:i[15],chara3:i[16],chara4:i[17],chara5:i[18],simuURL:i[19]},B=H[s[0].key];(k&&B<A||!k&&B>A)&&y.value.push(H)}x.value+=1,d()}),l=new Array(5).fill(u);for(let a=0;a<R;a++)l[a]=a+1;if(Ue.value){let a=Date.now();const o=l[0]*(l[1]-1)*(l[2]-2)*(l[3]-3);if(z.value=o*(l[4]-4)/E(5-R)+o*4/E(4-R),R==5){z.value=1,await b(0,1,2,3,4),await new Promise(requestAnimationFrame);return}for(let f=0;f<l[0];f++)for(let m=f+1;m<l[1];m++)for(let g=m+1;g<l[2];g++){if(!ee.value)return;for(let d=g+1;d<l[3];d++){for(let D=d+1;D<l[4];D++)await b(f,m,g,d,D),Date.now()-a>2e3&&(a=Date.now(),await v());for(const D of[f,m,g,d])await b(f,m,g,d,D),Date.now()-a>2e3&&(a=Date.now(),await v())}}}else{const a=l[0]*(l[1]-1)*(l[2]-2)*(l[3]-3);if(z.value=a*(l[4]-4)/E(5-R),R==5){z.value=1,await b(0,1,2,3,4),await new Promise(requestAnimationFrame);return}let o=Date.now();for(let f=0;f<l[0];f++)for(let m=f+1;m<l[1];m++)for(let g=m+1;g<l[2];g++){if(!ee.value)return;for(let d=g+1;d<l[3];d++)for(let D=d+1;D<l[4];D++)await b(f,m,g,d,D),Date.now()-o>2e3&&(o=Date.now(),await v())}}y.value.sort(te(s));const q=y.value.slice(0,X.value);y.value=[...q],y.value.length>0&&(A=y.value[y.value.length-1][s[0].key])}export{De as a,Ie as b,$e as c,qe as g,pe as u};

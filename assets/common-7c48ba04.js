import{u as ie}from"./characters-b12fca37.js";import{as as J,y as _}from"./index-f0df45ff.js";const le=J("searchSettings",{state:()=>({minEHP:3e4,minHP:3e4,minHPBuddy:0,minEvasion:0,minDuo:0,minReferenceDamage:0,minReferenceAdvantageDamage:0,minReferenceVsHiDamage:0,minReferenceVsMizuDamage:0,minReferenceVsKiDamage:0,maxResult:10,sortOptions:[{prop:"実質HP",order:"降順"}],allowSameCharacter:!0}),actions:{updateSearchSettings(a){Object.assign(this,a)}}}),ce=J("searchResult",{state:()=>({totalResults:0,nowResults:0,results:[],isSearching:!1,errorMessage:""})}),ue=le(),{minEHP:fe,minHP:me,minHPBuddy:ge,minEvasion:de,minDuo:ve,minReferenceDamage:pe,minReferenceAdvantageDamage:De,minReferenceVsHiDamage:He,minReferenceVsKiDamage:Pe,minReferenceVsMizuDamage:ke,maxResult:$,sortOptions:ye,allowSameCharacter:Re}=_(ue),he=ie(),{characters:F}=_(he),we=ce(),{totalResults:T,nowResults:N,results:D,isSearching:I,errorMessage:q}=_(we);function Ve(a){(a.key==="e"||a.key==="+")&&a.preventDefault()}const Z=["実質HP","実HP","HPバディ数","HPバディが存在しないキャラ数","バディ数","回避数","デュオ数","等倍与ダメージ","有利与ダメージ","対火与ダメージ","対水与ダメージ","対木与ダメージ"],Ae=["ehp","hp","hpBuudy","noHpBuddy","buddy","evasion","duo","referenceDamage","referenceAdvantageDamage","referenceVsHiDamage","referenceVsMizuDamage","referenceVsKiDamage"],M={"HPUP(小)":{hp:.2,atk:0,heal:0,conHeal:0},"HP&ATKUP(小)":{hp:.2,atk:.2,heal:0,conHeal:0},"HPUP(中)":{hp:.3,atk:0,heal:0,conHeal:0},"HP&ATKUP(中)":{hp:.3,atk:.35,heal:0,conHeal:0},"ATKUP(小)":{hp:0,atk:.2,heal:0,conHeal:0},"ATKUP(中)":{hp:0,atk:.35,heal:0,conHeal:0},"回復(小)":{hp:0,atk:0,heal:1.1,conHeal:0},"回復&継続回復(小)":{hp:0,atk:0,heal:1.1,conHeal:.15*3},"回復(中)":{hp:0,atk:0,heal:1.7,conHeal:0},"回復&継続回復(中)":{hp:0,atk:0,heal:1.7,conHeal:.25*3},"継続回復(小)":{hp:0,atk:0,heal:0,conHeal:.15*3},"継続回復(中)":{hp:0,atk:0,heal:0,conHeal:.25*3}};function C(a){var n;return((n=M[a])==null?void 0:n.hp)||0}function z(a){var n;return((n=M[a])==null?void 0:n.atk)||0}function E(a){var n;return((n=M[a])==null?void 0:n.heal)||0}function L(a){var n;return((n=M[a])==null?void 0:n.conHeal)||0}const be={"ATKUP(極小)":1.1,"ATKUP(小)":1.2,"ATKUP(中)":1.35,"ATKUP(大)":1.5,"ATKUP(極大)":2},Ke={"ダメUP(極小)":.025,"ダメUP(小)":.05,"ダメUP(中)":.0875,"ダメUP(大)":.125,"ダメUP(極大)":.25,"属性ダメUP(極小)":.03,"属性ダメUP(小)":.06,"属性ダメUP(中)":.1005,"属性ダメUP(大)":.15,"属性ダメUP(極大)":.3},O={};function Se(a,n,r,i){const u=`${a},${n},${r},${i}`;if(u in O)return O[u];let p=n.includes("弱")?.75:1;p*=r==="無"?1.1:1,p+=Ke[a]||0;let m=1;n.includes("連撃")?m=1.8:n.includes("デュオ")&&(m=2.4);const P=i*p*m;return O[u]=P,P}function j(a,n,r,i,u){return i=(be[a]||1)*i+i*u,Se(a,n,r=="無"?"無":"無以外",i)}function B(a,n,r){const i=[a,n,r];return i.sort((u,p)=>p-u),i[0]+i[1]}function Be(a){const n=new Set;for(const e of a)n.add(e.chara);let r=0,i=0,u=0,p=0,m=0,P=0,k=0,s=0,R=0,t=0,o=0,g=0;const f={},v={},l={},H=[];if(a.sort((e,c)=>c.calcBaseATK-e.calcBaseATK),a.forEach((e,c)=>{f[c]=!1,v[c]=!1,l[c]=!1}),a.forEach((e,c)=>{H.push(e.imgUrl),r+=e.calcBaseHP;let h=!1,w=0;if(n.has(e.buddy1c)){m+=1;const d=C(e.buddy1s);w+=z(e.buddy1s),d!=0&&(p+=1,h=!0,r+=e.calcBaseHP*d)}if(n.has(e.buddy2c)){m+=1;const d=C(e.buddy2s);w+=z(e.buddy2s),d!=0&&(p+=1,h=!0,r+=e.calcBaseHP*d)}if(n.has(e.buddy3c)){m+=1;const d=C(e.buddy3s);w+=z(e.buddy3s),d!=0&&(p+=1,h=!0,r+=e.calcBaseHP*d)}i+=(E(e.magic1heal)+E(e.magic2heal)+E(e.magic3heal))*e.calcBaseATK,i+=(L(e.magic1heal)+L(e.magic2heal)+L(e.magic3heal))*e.calcBaseHP,u+=e.evasion,h||(P+=1);let V=e.magic2pow;if(l[c])V="デュオ",k+=1;else{if(!l[c]){for(const[d,S]of a.entries())if(S.duo==e.chara&&e.duo==S.chara&&!l[c]&&!l[d]){l[c]=!0,l[d]=!0,f[c]=!0,f[d]=!0;break}if(!f[c]){for(const[d,S]of a.entries())if(e.duo==S.chara&&!l[c]&&!f[c]&&!v[d]){l[c]=!0,f[c]=!0,v[d]=!0;break}}if(!f[c]){for(const[d,S]of a.entries())if(e.duo==S.chara&&!l[c]&&!f[c]&&!f[d]){l[c]=!0,f[c]=!0,f[d]=!0;break}}}l[c]&&(V="デュオ",k+=1)}const A=j(e.magic1buf,e.magic1pow,e.magic1atr,e.calcBaseATK,w),b=j(e.magic2buf,V,e.magic2atr,e.calcBaseATK,w),K=j(e.magic3buf,e.magic3pow,e.magic3atr,e.calcBaseATK,w);s+=B(A,b,K);const Q=e.magic1atr=="無"?A:A*1.5,W=e.magic2atr=="無"?b:b*1.5,X=e.magic3atr=="無"?K:K*1.5;R+=B(Q,W,X);const Y=y(e.magic1atr,"火",A),x=y(e.magic2atr,"火",b),ee=y(e.magic3atr,"火",K);t+=B(Y,x,ee);const te=y(e.magic1atr,"水",A),ae=y(e.magic2atr,"水",b),ne=y(e.magic3atr,"水",K);o+=B(te,ae,ne);const re=y(e.magic1atr,"木",A),oe=y(e.magic2atr,"木",b),se=y(e.magic3atr,"木",K);g+=B(re,oe,se)}),!(r<me.value)&&!(r+i<fe.value)&&!(p<ge.value)&&!(u<de.value)&&!(k<ve.value)&&!(s<pe.value)&&!(R<De.value)&&!(t<He.value)&&!(o<ke.value)&&!(g<Pe.value))return s=Math.floor(s),R=Math.floor(R),t=Math.floor(t),o=Math.floor(o),g=Math.floor(g),[r,r+i,u,p,m,P,k,s,R,t,o,g,...H]}const Te={水:{火:1.5,木:.5},木:{水:1.5,火:.5},火:{木:1.5,水:.5}};function y(a,n,r){var u;const i=(u=Te[a])==null?void 0:u[n];return i?r*i:r}function G(a){return function(n,r){for(let i=0;i<a.length;i++){const{key:u,order:p}=a[i];if(!Object.prototype.hasOwnProperty.call(n,u)||!Object.prototype.hasOwnProperty.call(r,u))continue;let m=0;if(n[u]<r[u]?m=-1:n[u]>r[u]&&(m=1),m!==0)return p==="降順"?m*-1:m}return 0}}function U(a){return a<=0?1:a*U(a-1)}async function qe(){for(const t of F.value)if(t.required&&t.level==0){q.value="必須キャラのレベルは1以上にして下さい";return}const a=F.value.filter(t=>t.level>0),n=a.length;if(n<5){q.value="レベル設定されたキャラが少なすぎます";return}N.value=0;const r=[];for(const t of ye.value)for(let o=0;o<Z.length;o++)Z[o]==t.prop&&r.push({key:Ae[o],order:t.order});const i=r[0].order==="昇順";async function u(){D.value.sort(G(r));const t=D.value.slice(0,$.value);D.value=[...t],D.value.length>0&&(P=D.value[D.value.length-1][r[0].key]),await new Promise(requestAnimationFrame)}const p=new Set(["referenceDamage","referenceAdvantageDamage","referenceVsHiDamage","referenceVsMizuDamage","referenceVsKiDamage"]);r[0].key in p?a.sort((t,o)=>t.required&&!o.required?-1:!t.required&&o.required?1:o.atk-t.atk):a.sort((t,o)=>t.required&&!o.required?-1:!t.required&&o.required?1:o.hp-t.hp);const m=a.filter(t=>t.required).length;if(m>5){q.value="必須設定されたキャラが多すぎます";return}D.value=[],a.forEach(t=>{let o=110;t.rare=="SR"?o=90:t.rare=="R"&&(o=70);const g=t.level/o;t.calcBaseHP=(t.hp-t.base_hp)*g+t.base_hp,t.calcBaseATK=(t.atk-t.base_atk)*g+t.base_atk});let P=r[0].order==="昇順"?1/0:-1/0;const k=async(t,o,g,f,v)=>new Promise(l=>{const H=[a[t],a[o],a[g],a[f],a[v]],e=Be(H);if(e){const c={hp:Math.round(e[0]),ehp:Math.round(e[1]),evasion:e[2],hpBuudy:e[3],buddy:e[4],noHpBuddy:e[5],duo:e[6],referenceDamage:e[7],referenceAdvantageDamage:e[8],referenceVsHiDamage:e[9],referenceVsMizuDamage:e[10],referenceVsKiDamage:e[11],chara1:e[12],chara2:e[13],chara3:e[14],chara4:e[15],chara5:e[16]},h=c[r[0].key];(i&&h<P||!i&&h>P)&&D.value.push(c)}N.value+=1,l()}),s=new Array(5).fill(n);for(let t=0;t<m;t++)s[t]=t+1;if(Re.value){let t=Date.now();const o=s[0]*(s[1]-1)*(s[2]-2)*(s[3]-3);if(T.value=o*(s[4]-4)/U(5-m)+o*4/U(4-m),m==5){T.value=1,await k(0,1,2,3,4),await new Promise(requestAnimationFrame);return}for(let g=0;g<s[0];g++)for(let f=g+1;f<s[1];f++)for(let v=f+1;v<s[2];v++){if(!I.value)return;for(let l=v+1;l<s[3];l++){for(let H=l+1;H<s[4];H++)await k(g,f,v,l,H),Date.now()-t>2e3&&(t=Date.now(),await u());for(const H of[g,f,v,l])await k(g,f,v,l,H),Date.now()-t>2e3&&(t=Date.now(),await u())}}}else{const t=s[0]*(s[1]-1)*(s[2]-2)*(s[3]-3);if(T.value=t*(s[4]-4)/U(5-m),m==5){T.value=1,await k(0,1,2,3,4),await new Promise(requestAnimationFrame);return}let o=Date.now();for(let g=0;g<s[0];g++)for(let f=g+1;f<s[1];f++)for(let v=f+1;v<s[2];v++){if(!I.value)return;for(let l=v+1;l<s[3];l++)for(let H=l+1;H<s[4];H++)await k(g,f,v,l,H),Date.now()-o>2e3&&(o=Date.now(),await u())}}D.value.sort(G(r));const R=D.value.slice(0,$.value);D.value=[...R],D.value.length>0&&(P=D.value[D.value.length-1][r[0].key])}export{Z as a,ce as b,Ve as c,qe as d,le as u};

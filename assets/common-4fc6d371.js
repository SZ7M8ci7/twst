import{u as re}from"./characters-fe4896c3.js";import{as as ee,y as W}from"./index-e3bbeb6f.js";const le=ee("searchSettings",{state:()=>({minEHP:6e4,minHP:5e4,minHPBuddy:0,minEvasion:0,minDuo:0,minReferenceDamage:0,minReferenceAdvantageDamage:0,minReferenceVsHiDamage:0,minReferenceVsMizuDamage:0,minReferenceVsKiDamage:0,maxResult:10,sortOptions:[{prop:"実質HP",order:"降順"}],allowSameCharacter:!0}),actions:{updateSearchSettings(t){Object.assign(this,t)}}}),ne=ee("searchResult",{state:()=>({totalResults:0,nowResults:0,results:[],isSearching:!1,errorMessage:""})}),se=le(),{minEHP:oe,minHP:ue,minHPBuddy:fe,minEvasion:ce,minDuo:me,minReferenceDamage:ge,minReferenceAdvantageDamage:ve,minReferenceVsHiDamage:de,minReferenceVsKiDamage:De,minReferenceVsMizuDamage:Pe,maxResult:M,sortOptions:pe,allowSameCharacter:ye}=W(se),He=re(),{characters:X}=W(He),Re=ne(),{totalResults:V,nowResults:Y,results:o,isSearching:$,errorMessage:N}=W(Re);function Se(t){(t.key==="e"||t.key==="+")&&t.preventDefault()}const x=["実質HP","実HP","HPバディ数","HPバディが存在しないキャラ数","バディ数","回避数","デュオ数","等倍与ダメージ","有利与ダメージ","対火与ダメージ","対水与ダメージ","対木与ダメージ"],we=["ehp","hp","hpBuudy","noHpBuddy","buddy","evasion","duo","referenceDamage","referenceAdvantageDamage","referenceVsHiDamage","referenceVsMizuDamage","referenceVsKiDamage"];function I(t){return t=="HPUP(小)"||t=="HP&ATKUP(小)"?.2:t=="HPUP(中)"||t=="HP&ATKUP(中)"?.3:0}function Z(t){return t=="ATKUP(小)"||t=="HP&ATKUP(小)"?.2:t=="ATKUP(中)"||t=="HP&ATKUP(中)"?.35:0}function G(t){return t=="回復(小)"||t=="回復&継続回復(小)"?1.1:t=="回復(中)"||t=="回復&継続回復(中)"?1.7:0}function J(t){return t=="継続回復(小)"||t=="回復&継続回復(小)"?.15*3:t=="継続回復(中)"||t=="回復&継続回復(中)"?.25*3:0}function Q(t,P,l,i,s){t=="ATKUP(極小)"?i=i*1.1+i*s:t=="ATKUP(小)"?i=i*1.2+i*s:t=="ATKUP(中)"?i=i*1.35+i*s:t=="ATKUP(大)"?i=i*1.5+i*s:t=="ATKUP(極大)"?i=i*2+i*s:i=i+i*s;let n=1;P.includes("弱")&&(n=.75),l=="無"&&(n*=1.1),t=="ダメUP(極小)"?n+=.025:t=="ダメUP(小)"?n+=.05:t=="ダメUP(中)"?n+=.0875:t=="ダメUP(大)"?n+=.125:t=="ダメUP(極大)"&&(n+=.25),t=="属性ダメUP(極小)"?n+=.03:t=="属性ダメUP(小)"?n+=.06:t=="属性ダメUP(中)"?n+=.1005:t=="属性ダメUP(大)"?n+=.15:t=="属性ダメUP(極大)"&&(n+=.3);let g=1;return P.includes("連撃")?g=.9*2:P.includes("デュオ")&&(g=.8*3),i*n*g}function b(t,P,l){const i=[t,P,l];return i.sort((s,n)=>n-s),i[0]+i[1]}function Ae(t){const P=new Set;for(const e of t)P.add(e.chara);let l=0,i=0,s=0,n=0,g=0,f=0,S=0,a=0,u=0,v=0,d=0,D=0;const c={},p={},r={},K=[];if(t.forEach(e=>{let m=110;e.rare=="SR"?m=90:e.rare=="R"&&(m=70);const T=e.level/m;e.calcBaseHP=(e.hp-e.base_hp)*T+e.base_hp,e.calcBaseATK=(e.atk-e.base_atk)*T+e.base_atk}),t.sort((e,m)=>m.calcBaseATK-e.calcBaseATK),t.forEach((e,m)=>{c[m]=!1,p[m]=!1,r[m]=!1}),t.forEach((e,m)=>{K.push(e.imgUrl),l+=e.calcBaseHP;let T=!1,U=0;if(P.has(e.buddy1c)){g+=1;const y=I(e.buddy1s);U+=Z(e.buddy1s),y!=0&&(n+=1,T=!0,l+=e.calcBaseHP*y)}if(P.has(e.buddy2c)){g+=1;const y=I(e.buddy2s);U+=Z(e.buddy2s),y!=0&&(n+=1,T=!0,l+=e.calcBaseHP*y)}if(P.has(e.buddy3c)){g+=1;const y=I(e.buddy3s);U+=Z(e.buddy3s),y!=0&&(n+=1,T=!0,l+=e.calcBaseHP*y)}i+=G(e.magic1heal)*e.calcBaseATK,i+=G(e.magic2heal)*e.calcBaseATK,i+=G(e.magic3heal)*e.calcBaseATK,i+=J(e.magic1heal)*e.calcBaseHP,i+=J(e.magic2heal)*e.calcBaseHP,i+=J(e.magic3heal)*e.calcBaseHP,s+=e.evasion,T||(f+=1);let B=e.magic2pow;r[m]?(B="デュオ",S+=1):(t.forEach((y,A)=>{y.duo==e.chara&&e.duo==y.chara&&!r[m]&&!r[A]&&(r[m]=!0,r[A]=!0,c[m]=!0,c[A]=!0)}),t.forEach((y,A)=>{e.duo==y.chara&&!r[m]&&!c[m]&&!p[A]&&(r[m]=!0,c[m]=!0,p[A]=!0)}),t.forEach((y,A)=>{e.duo==y.chara&&!r[m]&&!c[m]&&!c[A]&&(r[m]=!0,c[m]=!0,c[A]=!0)}),r[m]&&(B="デュオ",S+=1));const H=Q(e.magic1buf,e.magic1pow,e.magic1atr,e.calcBaseATK,U),R=Q(e.magic2buf,B,e.magic2atr,e.calcBaseATK,U),w=Q(e.magic3buf,e.magic3pow,e.magic3atr,e.calcBaseATK,U);a+=b(H,R,w);const te=e.magic1atr=="無"?H:H*1.5,ie=e.magic2atr=="無"?R:R*1.5,ae=e.magic3atr=="無"?w:w*1.5;u+=b(te,ie,ae);let E=H;e.magic1atr=="水"?E=H*1.5:e.magic1atr=="木"&&(E=H/2);let z=R;e.magic2atr=="水"?z=R*1.5:e.magic2atr=="木"&&(z=R/2);let L=w;e.magic3atr=="水"?L=w*1.5:e.magic3atr=="木"&&(L=w/2),v+=b(E,z,L);let C=H;e.magic1atr=="木"?C=H*1.5:e.magic1atr=="火"&&(C=H/2);let h=R;e.magic2atr=="木"?h=R*1.5:e.magic2atr=="火"&&(h=R/2);let O=w;e.magic3atr=="木"?O=w*1.5:e.magic3atr=="火"&&(O=w/2),d+=b(C,h,O);let j=H;e.magic1atr=="火"?j=H*1.5:e.magic1atr=="水"&&(j=H/2);let F=R;e.magic2atr=="火"?F=R*1.5:e.magic2atr=="水"&&(F=R/2);let _=w;e.magic3atr=="火"?_=w*1.5:e.magic3atr=="水"&&(_=w/2),D+=b(j,F,_)}),!(l<ue.value)&&!(l+i<oe.value)&&!(n<fe.value)&&!(s<ce.value)&&!(S<me.value)&&!(a<ge.value)&&!(u<ve.value)&&!(v<de.value)&&!(d<Pe.value)&&!(D<De.value))return a=Math.floor(a),u=Math.floor(u),v=Math.floor(v),d=Math.floor(d),D=Math.floor(D),K.sort(),[l,l+i,s,n,g,f,S,a,u,v,d,D,...K]}function k(t){return function(P,l){for(let i=0;i<t.length;i++){const{key:s,order:n}=t[i];if(!Object.prototype.hasOwnProperty.call(P,s)||!Object.prototype.hasOwnProperty.call(l,s))continue;let g=0;if(P[s]<l[s]?g=-1:P[s]>l[s]&&(g=1),g!==0)return n==="降順"?g*-1:g}return 0}}function q(t){return t<=0?1:t*q(t-1)}async function Ue(){for(const a of X.value)if(a.required&&a.level==0){N.value="必須キャラのレベルは1以上にして下さい";return}const t=X.value.filter(a=>a.level>0),P=t.length;if(P<5){N.value="レベル設定されたキャラが少なすぎます";return}Y.value=0;const l=[];for(const a of pe.value)for(let u=0;u<x.length;u++)x[u]==a.prop&&l.push({key:we[u],order:a.order});const i=new Set(["referenceDamage","referenceAdvantageDamage","referenceVsHiDamage","referenceVsMizuDamage","referenceVsKiDamage"]);l[0].key in i?t.sort((a,u)=>a.required&&!u.required?-1:!a.required&&u.required?1:u.atk-a.atk):t.sort((a,u)=>a.required&&!u.required?-1:!a.required&&u.required?1:u.hp-a.hp);const s=t.filter(a=>a.required).length;if(s>5){N.value="必須設定されたキャラが多すぎます";return}o.value=[];let n=l[0].order==="昇順"?1/0:-1/0;const g=async(a,u,v,d,D)=>new Promise(c=>{const p=[t[a],t[u],t[v],t[d],t[D]],r=Ae(p);if(r){const K={hp:Math.round(r[0]),ehp:Math.round(r[1]),evasion:r[2],hpBuudy:r[3],buddy:r[4],noHpBuddy:r[5],duo:r[6],referenceDamage:r[7],referenceAdvantageDamage:r[8],referenceVsHiDamage:r[9],referenceVsMizuDamage:r[10],referenceVsKiDamage:r[11],chara1:r[12],chara2:r[13],chara3:r[14],chara4:r[15],chara5:r[16]};(l[0].order==="昇順"&&K[l[0].key]<n||l[0].order==="降順"&&K[l[0].key]>n)&&o.value.push(K)}Y.value+=1,c()}),f=new Array(5).fill(P);for(let a=0;a<s;a++)f[a]=a+1;if(ye.value){let a=Date.now();const u=f[0]*(f[1]-1)*(f[2]-2)*(f[3]-3);if(V.value=u*(f[4]-4)/q(5-s)+u*4/q(4-s),s==5){V.value=1,await g(0,1,2,3,4),await new Promise(requestAnimationFrame);return}for(let v=0;v<f[0];v++)for(let d=v+1;d<f[1];d++)for(let D=d+1;D<f[2];D++)for(let c=D+1;c<f[3];c++){for(let p=c+1;p<f[4];p++){if(!$.value)return;if(await g(v,d,D,c,p),Date.now()-a>500){a=Date.now(),o.value.sort(k(l));const r=o.value.slice(0,M.value);o.value=[...r],o.value.length>0&&(n=o.value[o.value.length-1][l[0].key]),await new Promise(requestAnimationFrame)}}for(const p of[v,d,D,c])if(await g(v,d,D,c,p),Date.now()-a>500){a=Date.now(),o.value.sort(k(l));const r=o.value.slice(0,M.value);o.value=[...r],o.value.length>0&&(n=o.value[o.value.length-1][l[0].key]),await new Promise(requestAnimationFrame)}}}else{const a=f[0]*(f[1]-1)*(f[2]-2)*(f[3]-3);if(V.value=a*(f[4]-4)/q(5-s),s==5){V.value=1,await g(0,1,2,3,4),await new Promise(requestAnimationFrame);return}let u=Date.now();for(let v=0;v<f[0];v++)for(let d=v+1;d<f[1];d++)for(let D=d+1;D<f[2];D++)for(let c=D+1;c<f[3];c++)for(let p=c+1;p<f[4];p++){if(!$.value)return;if(await g(v,d,D,c,p),Date.now()-u>1e3){u=Date.now(),o.value.sort(k(l));const r=o.value.slice(0,M.value);o.value=[...r],o.value.length>0&&(n=o.value[o.value.length-1][l[0].key]),await new Promise(requestAnimationFrame)}}}o.value.sort(k(l));const S=o.value.slice(0,M.value);o.value=[...S],o.value.length>0&&(n=o.value[o.value.length-1][l[0].key])}export{x as a,ne as b,Se as c,Ue as d,le as u};

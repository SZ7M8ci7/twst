import{b as ua,l as he,h as da,p as Le}from"./common-BL-Lw_gC.js";import{useHandCollectionStore as ma}from"./handCollection-GbSBCJ1O.js";import{d as fa,i as va,a1 as ga,a7 as Te,bc as Ca,a2 as Ee,c as Z,w as u,j as g,f as c,a9 as ka,a as l,ao as J,ab as ha,t as y,u as Ve,F as M,k as L,bv as Ke,l as T,aa as ce,b as E,r as C,g as V,o as d,bw as Ie,a3 as R,_ as ya}from"./index-D2Q5KTe2.js";import{C as A}from"./CharacterIconWithType-B2D3SH7l.js";import{r as ba}from"./calculations-gXkkWyKb.js";import{c as ee,V as Pe}from"./characters_info-C0ZW9y-m.js";import{V as Oe,a as Ae}from"./VCard-CuXcqA1l.js";import{V as je}from"./VCardText-D2ayAh7Q.js";import{V as re}from"./VSpacer-Cy7iOUVd.js";import{V as pa}from"./VContainer-Bx5D8auS.js";const _a={key:0,class:"loading-container"},wa={class:"character-row"},Da={class:"damage-row"},Sa=["onClick"],Ma={class:"header-content"},Ua=["src","alt"],xa={class:"sort-icon"},La={key:0,class:"sort-indicator"},Ta={key:1,class:"sort-hint"},Ea={class:"character-row all-characters-row"},Va={class:"damage-row"},Ka={class:"damage-item all-characters-item"},Ia=["onClick"],Pa={class:"damage-row"},Oa={class:"damage-item"},Aa=["onClick"],ja={class:"damage-item-content"},Fa={class:"card-info"},za={key:0,class:"buddy-cards"},Ha={key:0,class:"buff-info"},Na={class:"buff-container"},$a={key:0,class:"buff-source"},Ba={class:"damage-value"},Ra={class:"pagination-controls"},Wa={class:"page-info"},qa={class:"damage-item-content"},Ga={class:"card-info"},Qa={key:0,class:"buddy-cards"},Xa={key:0,class:"buff-info"},Ya={class:"buff-container"},Za={key:0,class:"buff-source"},Ja={class:"damage-value"},et={class:"pagination-controls"},at={class:"page-info"},Fe=50,tt=10,it=fa({__name:"finisherDamage",setup(nt){const{t:ue}=va(),ze=ua(),S=ma(),{characters:p}=ga(ze),h=C(!1),m=C(new Map),de=C({"--icon-size":`${Fe}px`,"--gap-size":`${tt}px`}),He={fire:"fire",water:"water",flora:"flora",cosmic:"cosmic"},me=C(!0),K=V(()=>{const e={};for(const[a,t]of m.value.entries())e[a]=t.iconSrc||t.imgSrc||"";return e});Te(async()=>{try{const e=await he(p.value,"name"),a=await he(ee,"name_en","icon/"),t={},n=new Map(ee.map(i=>[i.name_ja,i.name_en]));p.value.forEach(i=>{const r=n.get(i.name);r&&a[r]&&(t[i.name]=a[r])});const s=await he(Object.values(He),i=>i,"icon/");m.value=da(p.value,e,t,s);const o=new Set(m.value.keys());ee.forEach(i=>{const r=a[i.name_en];r&&(i.name_ja&&!o.has(i.name_ja)&&m.value.set(i.name_ja,{type:"",wikiUrl:"",imgSrc:"",iconSrc:r}),i.name_en&&!o.has(i.name_en)&&m.value.set(i.name_en,{type:"",wikiUrl:"",imgSrc:"",iconSrc:r}))})}catch(e){console.error("Error in onMounted finisherDamage.vue:",e)}finally{me.value=!1}});const j={},Ne=["(極小)","(小)","(中)","(大)","(極大)"],$e=["ATKUP","ダメージUP","無属性ダメージUP","火属性ダメージUP","水属性ダメージUP","木属性ダメージUP","被ダメージUP"],Be={"ATKUP(極小)":.1,"ATKUP(小)":.2,"ATKUP(中)":.35,"ATKUP(大)":.5,"ATKUP(極大)":.8},I={},F={},z={},H={},N={},W={},q={},G={};function ye(){Object.keys(j).forEach(e=>{j[e]=[]}),p.value.forEach(e=>{if(h.value&&!S.getHandCard(e.name).isOwned)return;const a=e.etc.split(",");j[e.chara]||(j[e.chara]=[]),a.forEach(t=>{const n=t.trim();!n.includes("味方")&&!(n.includes("被ダメージUP")&&n.includes("相手"))||$e.forEach(s=>{n.startsWith(s)&&Ne.forEach(o=>{if(n.includes(o)){let i="";if(n.includes("(M1)")?i="M1":n.includes("(M2)")?i="M2":n.includes("(M3)")&&(i="M3"),i==="M3"){if(e.rare==="R"||e.rare==="SR")return;if(h.value){const r=S.getHandCard(e.name);if(r.isOwned&&!r.isM3)return}}j[e.chara].push({buff:s+o,name:e.name,buffSource:i})}})})})})}ye();function be(){p.value.forEach(e=>{if(e.rare!="SSR")return;let a,t=!0;if(h.value){const k=S.getHandCard(e.name);if(k.isOwned){const v=Number(k.level),D=k.isLimitBreak;a=ba(e,v,D)}else t=!1,a=0}else a=Number(e.originalMaxATK)||Number(e.max_atk)||Number(e.atk)||0;if(!t)return;const n=fe(e.buddy1s)+fe(e.buddy2s)+fe(e.buddy3s),s=Re(e),o=We(e);let i=0,r=0,f=0,_=0;function w(k,v,D,le){const xe=Be[v]||0,ca=a+a*n+a*s+a*xe;let b=0;const ra=k==="無"?1.1:1;if(v.includes(k+"属性ダメージUP")?(v.includes("(極小)")&&(b=.025),v.includes("(小)")&&(b=.06),v.includes("(中)")&&(b=.105),v.includes("(大)")&&(b=.15),v.includes("(極大)")&&(b=.27)):v.includes("ダメージUP")&&!v.includes("属性ダメージUP")&&(v.includes("(極小)")&&(b=.0225),v.includes("(小)")&&(b=.05),v.includes("(中)")&&(b=.0875),v.includes("(大)")&&(b=.125),v.includes("(極大)")&&(b=.225)),v!=""&&xe==0&&b==0)return;const U=Math.floor(ca*(ra+o+b)*2.4);N[e.name]||(N[e.name]=[],W[e.name]=[],q[e.name]=[],G[e.name]=[]);const x={無:{fire:1,water:1,flora:1,cosmic:1},火:{fire:1,water:.5,flora:1.5,cosmic:1},水:{fire:1.5,water:1,flora:.5,cosmic:1},木:{fire:.5,water:1.5,flora:1,cosmic:1}}[k]||{fire:1,water:1,flora:1,cosmic:1};i=Math.max(U*x.fire,i),r=Math.max(U*x.water,r),f=Math.max(U*x.flora,f),_=Math.max(U*x.cosmic,_),N[e.name].push({damage:U*x.fire,name:D,buffSource:le}),W[e.name].push({damage:U*x.water,name:D,buffSource:le}),q[e.name].push({damage:U*x.flora,name:D,buffSource:le}),G[e.name].push({damage:U*x.cosmic,name:D,buffSource:le})}w(e.magic2atr,"",ea(e.duo),""),j[e.duo].forEach(k=>{if(k.buffSource==="M3"){const v=p.value.find(D=>D.name===k.name);if(v&&(v.rare==="R"||v.rare==="SR"))return;if(h.value){const D=S.getHandCard(k.name);if(D.isOwned&&!D.isM3)return}}w(e.magic2atr,k.buff,k.name,k.buffSource)}),I[e.chara]||(I[e.chara]=0,F[e.chara]=0,z[e.chara]=0,H[e.chara]=0),I[e.chara]=Math.max(I[e.chara],i),F[e.chara]=Math.max(F[e.chara],r),z[e.chara]=Math.max(z[e.chara],f),H[e.chara]=Math.max(H[e.chara],_)})}be();function fe(e){return e.includes("ATK")&&e.includes("小")?.2:e.includes("ATK")&&e.includes("中")?.35:0}function Re(e){let a=e.rare==="SSR";if(h.value){const o=S.getHandCard(e.name);o.isOwned&&(a=o.isM3)}const t=Le(e,{allowM3:a}),n={極小:.1,小:.2,中:.35,大:.5,極大:.8};let s=0;return t.forEach(o=>{o.buffOption==="ATKUP"&&o.isSelf&&(o.durationTurns??0)>=2&&(s+=n[o.powerOption]||0)}),s}function We(e){let a=e.rare==="SSR";if(h.value){const o=S.getHandCard(e.name);o.isOwned&&(a=o.isM3)}const t=Le(e,{allowM3:a}),n={極小:.02,小:.05,中:.0875,大:.125,極大:.1875};let s=0;return t.forEach(o=>{o.buffOption==="ダメージUP"&&o.isSelf&&(o.durationTurns??0)>=2&&(s+=n[o.powerOption]||0)}),(e.etc||"").includes("被ダメージUP(中)(相手全体/2T)")&&(s+=.0875),s}const ae={};p.value.forEach(e=>{e.rare=="SSR"&&(ae[e.chara]||(ae[e.chara]=[]),ae[e.chara].push(e.name))});const te=C(!1),ve=C([]),qe=C(""),Ge=C(""),P=C(1),ie=C(10),Qe=V(()=>{const e=(P.value-1)*ie.value,a=e+ie.value;return Je.value.slice(e,a)}),pe=V(()=>Math.ceil(ve.value.length/ie.value));function Xe(e,a){const t=ge(a),n=ae[e];if(!n||n.length===0)return;const s=n.flatMap(o=>(t[o]||[]).map(r=>({...r,cardName:o})));ve.value=s,qe.value=e,Ge.value=a,P.value=1,te.value=!0}function ge(e){return{fire:N,water:W,flora:q,cosmic:G}[e]}const $=C(""),Q=C("desc");function Ye(e){$.value===e?Q.value=Q.value==="asc"?"desc":"asc":($.value=e,Q.value="desc")}const Ze=V(()=>{let e=[...ee];return $.value?e.sort((a,t)=>{const n=ne(a.name_ja,$.value),s=ne(t.name_ja,$.value),o=typeof n=="number"?n:0,i=typeof s=="number"?s:0;return Q.value==="asc"?o-i:i-o}):e});function ne(e,a){var s;if(e==="全キャラ"){const o=ge(a);let i=0;return p.value.filter(r=>r.rare==="SSR").forEach(r=>{if(h.value&&!S.getHandCard(r.name).isOwned)return;const f=o[r.name]||[],_=Math.max(...f.map(w=>w.damage),0);i=Math.max(i,_)}),Math.floor(i)}if(h.value&&!p.value.filter(i=>i.rare==="SSR"&&i.chara===e).some(i=>S.getHandCard(i.name).isOwned))return"-";const n=(s={fire:I,water:F,flora:z,cosmic:H}[a])==null?void 0:s[e];return n?Math.floor(n):"-"}const Je=V(()=>[...ve.value].sort((e,a)=>a.damage-e.damage));function ea(e){const a=ee.find(t=>t.name_ja===e);return(a==null?void 0:a.name_en)||""}function B(e){if(!e)return;const a=m.value.get(e);a&&a.wikiUrl&&window.open(a.wikiUrl,"_blank")}const se=C(!1),Ce=C([]),aa=C("fire"),O=C(1),oe=C(10),X=C(0),Y=C(0),_e=[1,1.0833,1.1666,1.25];function ke(){const t=window.innerHeight*.95-60,s=Math.max(1,Math.floor(t/80));ie.value=s,oe.value=s}Te(()=>{ke(),window.addEventListener("resize",ke)}),Ca(()=>{window.removeEventListener("resize",ke)});const ta=V(()=>{const e=(O.value-1)*oe.value,a=e+oe.value;return na.value.slice(e,a)}),we=V(()=>Math.ceil(Ce.value.length/oe.value));function ia(e){aa.value=e;const a=ge(e);Ce.value=p.value.filter(t=>t.rare==="SSR").flatMap(t=>(a[t.name]||[]).map(s=>({cardName:t.name,damage:s.damage,buffName:s.name||"",buffSource:s.buffSource||""}))),O.value=1,se.value=!0}const na=V(()=>[...Ce.value].sort((e,a)=>a.damage-e.damage));function De(e){const a=p.value.find(n=>n.name===e);if(!a)return[];const t=[];return a.buddy1c&&a.buddy1s.includes("ATK")&&m.value.get(a.buddy1c)&&t.push(a.buddy1c),a.buddy2c&&a.buddy2s.includes("ATK")&&m.value.get(a.buddy2c)&&t.push(a.buddy2c),a.buddy3c&&a.buddy3s.includes("ATK")&&m.value.get(a.buddy3c)&&t.push(a.buddy3c),t}function sa(){h.value=!h.value}Ee(()=>h.value,()=>{Ue()});function oa(){X.value=(X.value+1)%4}function la(){Y.value=(Y.value+1)%4}function Se(e){return{"background-color":["rgba(255, 235, 59, 0.1)","rgba(255, 235, 59, 0.3)","rgba(255, 235, 59, 0.6)","rgba(255, 235, 59, 0.9)"][e],color:"#999999","border-color":"#e0e0e0"}}function Me(e){return ue(`finisherDamage.${["normal","critical1","critical2","critical3"][e]}`)}Ee(()=>S.handCollection,()=>{h.value&&Ue()},{deep:!0});function Ue(){me.value||(Object.keys(I).forEach(e=>delete I[e]),Object.keys(F).forEach(e=>delete F[e]),Object.keys(z).forEach(e=>delete z[e]),Object.keys(H).forEach(e=>delete H[e]),Object.keys(N).forEach(e=>delete N[e]),Object.keys(W).forEach(e=>delete W[e]),Object.keys(q).forEach(e=>delete q[e]),Object.keys(G).forEach(e=>delete G[e]),ye(),be())}return(e,a)=>(d(),Z(pa,{class:"finisher-container"},{default:u(()=>[me.value?(d(),g("div",_a,[c(ka,{indeterminate:"",color:"primary",size:64}),a[8]||(a[8]=l("p",{class:"loading-text"},"Loading...",-1))])):(d(),g(M,{key:1},[l("div",wa,[l("div",{class:"character-item",style:J({...de.value})},[l("div",{class:ha(["toggle-button",{active:h.value}]),onClick:sa},y(h.value?Ve(ue)("finisherDamage.handCollection"):Ve(ue)("finisherDamage.allCards")),3)],4),l("div",Da,[(d(),g(M,null,L(["Fire","Water","Flora","Cosmic"],t=>{var n;return l("div",{key:t,class:"damage-col"},[l("div",{class:"damage-item clickable-header",onClick:s=>Ye(t.toLowerCase())},[l("div",Ma,[a[9]||(a[9]=l("span",{class:"vs-text"},"VS",-1)),l("img",{src:((n=m.value.get(t.toLowerCase()))==null?void 0:n.imgSrc)||"",alt:t,class:"element-icon"},null,8,Ua),l("span",xa,[$.value===t.toLowerCase()?(d(),g("span",La,y(Q.value==="asc"?"↑":"↓"),1)):(d(),g("span",Ta,"↕"))])])],8,Sa)])}),64))])]),l("div",Ea,[l("div",{class:"character-item",style:J({...de.value})},[...a[10]||(a[10]=[l("div",{class:"all-characters-label"},"ALL",-1)])],4),l("div",Va,[(d(),g(M,null,L(["Fire","Water","Flora","Cosmic"],t=>l("div",{key:t,class:"damage-col"},[l("div",Ka,[l("span",{class:"clickable-damage",onClick:n=>ia(t.toLowerCase())},y(ne("全キャラ",t.toLowerCase())),9,Ia)])])),64))])]),(d(!0),g(M,null,L(Ze.value,t=>{var n;return d(),g("div",{key:t.name_en,class:"character-row"},[l("div",{class:"character-item",style:J({...de.value})},[c(A,{iconKey:t.name_ja,iconDictionary:K.value,wikiUrl:((n=m.value.get(t.name_ja))==null?void 0:n.wikiUrl)||"",iconSize:Fe},null,8,["iconKey","iconDictionary","wikiUrl"])],4),l("div",Pa,[(d(),g(M,null,L(["Fire","Water","Flora","Cosmic"],s=>l("div",{key:s,class:"damage-col"},[l("div",Oa,[l("span",{class:"clickable-damage",onClick:o=>Xe(t.name_ja,s.toLowerCase())},y(ne(t.name_ja,s.toLowerCase())),9,Aa)])])),64))])])}),128))],64)),c(Pe,{modelValue:te.value,"onUpdate:modelValue":a[3]||(a[3]=t=>te.value=t),"max-width":"450"},{default:u(()=>[c(Oe,null,{default:u(()=>[c(je,{class:"modal-content"},{default:u(()=>[c(Ke,{class:"damage-list"},{default:u(()=>[(d(!0),g(M,null,L(Qe.value,(t,n)=>(d(),Z(Ie,{key:n,class:"damage-list-item"},{default:u(()=>{var s,o,i,r;return[l("div",ja,[l("div",Fa,[c(A,{iconKey:t.cardName||"",iconDictionary:K.value,wikiUrl:((s=m.value.get(t.cardName||""))==null?void 0:s.wikiUrl)||"",cardType:((o=m.value.get(t.cardName||""))==null?void 0:o.type)||"",iconSize:46,class:"card-icon clickable-icon",onClick:f=>B(t.cardName)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),t.cardName?(d(),g("div",za,[(d(!0),g(M,null,L(De(t.cardName),f=>{var _,w;return d(),Z(A,{key:f,iconKey:f,iconDictionary:K.value,wikiUrl:((_=m.value.get(f))==null?void 0:_.wikiUrl)||"",cardType:((w=m.value.get(f))==null?void 0:w.type)||"",iconSize:26,class:"buddy-icon clickable-icon",onClick:k=>B(f)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"])}),128))])):R("",!0)]),t.name?(d(),g("div",Ha,[l("div",Na,[c(A,{iconKey:t.name,iconDictionary:K.value,wikiUrl:((i=m.value.get(t.name))==null?void 0:i.wikiUrl)||"",cardType:((r=m.value.get(t.name))==null?void 0:r.type)||"",iconSize:46,class:"buff-icon clickable-icon",onClick:f=>B(t.name)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),t.buffSource?(d(),g("span",$a,y(t.buffSource),1)):R("",!0)])])):R("",!0),l("div",Ba,y(Math.floor(t.damage*_e[X.value]).toLocaleString()),1)])]}),_:2},1024))),128))]),_:1})]),_:1}),c(Ae,null,{default:u(()=>[c(re),l("div",Ra,[c(T,{disabled:P.value===1,onClick:a[0]||(a[0]=t=>P.value--),variant:"text",size:"small",icon:""},{default:u(()=>[c(ce,null,{default:u(()=>[...a[11]||(a[11]=[E("mdi-chevron-left",-1)])]),_:1})]),_:1},8,["disabled"]),l("span",Wa,y(P.value)+" / "+y(pe.value),1),c(T,{disabled:P.value===pe.value,onClick:a[1]||(a[1]=t=>P.value++),variant:"text",size:"small",icon:""},{default:u(()=>[c(ce,null,{default:u(()=>[...a[12]||(a[12]=[E("mdi-chevron-right",-1)])]),_:1})]),_:1},8,["disabled"])]),c(re),c(T,{variant:"outlined",class:"critical-btn",style:J(Se(X.value)),onClick:oa},{default:u(()=>[E(y(Me(X.value)),1)]),_:1},8,["style"]),c(T,{color:"grey",variant:"outlined",class:"close-btn",onClick:a[2]||(a[2]=t=>te.value=!1)},{default:u(()=>[...a[13]||(a[13]=[E("CLOSE",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),c(Pe,{modelValue:se.value,"onUpdate:modelValue":a[7]||(a[7]=t=>se.value=t),"max-width":"450"},{default:u(()=>[c(Oe,null,{default:u(()=>[c(je,{class:"modal-content"},{default:u(()=>[c(Ke,{class:"damage-list"},{default:u(()=>[(d(!0),g(M,null,L(ta.value,(t,n)=>(d(),Z(Ie,{key:n,class:"damage-list-item"},{default:u(()=>{var s,o,i,r;return[l("div",qa,[l("div",Ga,[c(A,{iconKey:t.cardName,iconDictionary:K.value,wikiUrl:((s=m.value.get(t.cardName))==null?void 0:s.wikiUrl)||"",cardType:((o=m.value.get(t.cardName))==null?void 0:o.type)||"",iconSize:46,class:"card-icon clickable-icon",onClick:f=>B(t.cardName)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),t.cardName?(d(),g("div",Qa,[(d(!0),g(M,null,L(De(t.cardName),f=>{var _,w;return d(),Z(A,{key:f,iconKey:f,iconDictionary:K.value,wikiUrl:((_=m.value.get(f))==null?void 0:_.wikiUrl)||"",cardType:((w=m.value.get(f))==null?void 0:w.type)||"",iconSize:26,class:"buddy-icon clickable-icon",onClick:k=>B(f)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"])}),128))])):R("",!0)]),t.buffName?(d(),g("div",Xa,[l("div",Ya,[c(A,{iconKey:t.buffName,iconDictionary:K.value,wikiUrl:((i=m.value.get(t.buffName))==null?void 0:i.wikiUrl)||"",cardType:((r=m.value.get(t.buffName))==null?void 0:r.type)||"",iconSize:46,class:"buff-icon clickable-icon",onClick:f=>B(t.buffName)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),t.buffSource?(d(),g("span",Za,y(t.buffSource),1)):R("",!0)])])):R("",!0),l("div",Ja,y(Math.floor(t.damage*_e[Y.value]).toLocaleString()),1)])]}),_:2},1024))),128))]),_:1})]),_:1}),c(Ae,null,{default:u(()=>[c(re),l("div",et,[c(T,{disabled:O.value===1,onClick:a[4]||(a[4]=t=>O.value--),variant:"text",size:"small",icon:""},{default:u(()=>[c(ce,null,{default:u(()=>[...a[14]||(a[14]=[E("mdi-chevron-left",-1)])]),_:1})]),_:1},8,["disabled"]),l("span",at,y(O.value)+" / "+y(we.value),1),c(T,{disabled:O.value===we.value,onClick:a[5]||(a[5]=t=>O.value++),variant:"text",size:"small",icon:""},{default:u(()=>[c(ce,null,{default:u(()=>[...a[15]||(a[15]=[E("mdi-chevron-right",-1)])]),_:1})]),_:1},8,["disabled"])]),c(re),c(T,{variant:"outlined",class:"critical-btn",style:J(Se(Y.value)),onClick:la},{default:u(()=>[E(y(Me(Y.value)),1)]),_:1},8,["style"]),c(T,{color:"grey",variant:"outlined",class:"close-btn",onClick:a[6]||(a[6]=t=>se.value=!1)},{default:u(()=>[...a[16]||(a[16]=[E("CLOSE",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),Ct=ya(it,[["__scopeId","data-v-8f865026"]]);export{Ct as default};

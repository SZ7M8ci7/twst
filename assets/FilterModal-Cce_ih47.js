import{b as Re,j as Fe,l as We}from"./common-JjD4kMqF.js";import{I as Ee,r as d,d as Oe,i as Ve,s as me,e as S,A as Be,q as $e,aR as Te,j as i,G as pe,a as h,g as y,l as F,w as W,b as E,t as B,u as A,F as O,k as V,o as c,Y as he,_ as Ue}from"./index-_IwKmZvx.js";import{c as X}from"./characters_info-CKWdM8j8.js";import Pe from"./default-pkSoNB1x.js";import{V as j}from"./VCheckbox-BdTyUZzA.js";let H=null,I=!1,le=null,te=!1;function ze(){return I&&H?H:null}function De(s){H=s,I=!0}function xe(){return te&&le?le:null}function Ge(s){le=s,te=!0}const je=Ee("filterd",()=>{const s=ze(),k=xe(),u=d((s==null?void 0:s.selectedCharacters)||[]),$=d((s==null?void 0:s.selectedRare)||[]),T=d((s==null?void 0:s.selectedType)||[]),b=d((s==null?void 0:s.selectedAttr)||[]),g=d((s==null?void 0:s.selectedEffects)||[]),C=d(!s),_=d((k==null?void 0:k.sortBy)||"default"),M=d((k==null?void 0:k.sortOrder)||"asc");function w(){const o={selectedCharacters:u.value,selectedRare:$.value,selectedType:T.value,selectedAttr:b.value,selectedEffects:g.value};De(o)}function D(){const o={sortBy:_.value,sortOrder:M.value};Ge(o)}function n(){u.value=[],$.value=[],T.value=[],b.value=[],g.value=[],C.value=!0,H=null,I=!1}function v(){I=!0}function m(){te=!0}return{tempSelectedCharacters:u,tempSelectedRare:$,isFirst:C,tempSelectedType:T,tempSelectedAttr:b,tempSelectedEffects:g,sortBy:_,sortOrder:M,saveCurrentState:w,saveCurrentSortState:D,resetFilterState:n,markFilterAsModified:v,markSortAsModified:m}}),He={class:"feature-select-all-container"},Ie={class:"feature-items"},Le={class:"display-block"},Ke={class:"character-global-select-container"},Ne={class:"character-list-wrapper"},qe={class:"character-select-all-container"},Ye={class:"character-items"},Je=["onClick"],Qe=["src","alt"],Xe={class:"feature-select-all-container"},Ze={class:"feature-items"},el={key:0,class:"button-container"},ll={key:1,class:"button-container embedded-buttons"},Z=50,ee=10,tl=Oe({__name:"FilterModal",props:{embedded:{type:Boolean,default:!1}},emits:["close","filter-applied"],setup(s,{emit:k}){const{t:u}=Ve(),$=Re(),{characters:T}=me($),b=je(),{tempSelectedCharacters:g,tempSelectedRare:C,tempSelectedType:_,tempSelectedAttr:M,tempSelectedEffects:w,isFirst:D}=me(b),n=d([]),v=d([]),m=d([]),o=d([]),f=d([]),ae=k,se=d(0),L=d({}),ne=s;d({"--icon-size":`${Z}px`,"--gap-size":`${ee}px`});const ue=["SSR","SR","R"],re=S(()=>[{name:u("filterModal.balance"),value:"バランス"},{name:u("filterModal.defence"),value:"ディフェンス"},{name:u("filterModal.attack"),value:"アタック"}]),oe=S(()=>[{name:u("filterModal.fire"),value:"火"},{name:u("filterModal.water"),value:"水"},{name:u("filterModal.flora"),value:"木"},{name:u("filterModal.cosmic"),value:"無"}]),x=S(()=>Fe.map(e=>({name:u(`filterModal.${e.name}`),value:e.value}))),Se=X.reduce((e,l)=>{const t=l.dorm;return e[t]||(e[t]=[]),e[t].push(l),e},{}),U=S(()=>{const e={};return Object.entries(Se).forEach(([l,t])=>{e[l]=t.filter(r=>!!L.value[r.name_en])}),e}),K=new Map;X.forEach(e=>{K.set(e.name_ja,e),K.set(e.name_en,e)});const ie=()=>{const e=document.querySelector(".display-block");e&&(se.value=e.clientWidth)},ce=()=>{ie()};Be(async()=>{D.value?(n.value=z.value,v.value=["SSR"],m.value=["バランス","ディフェンス","アタック"],o.value=["火","水","木","無"],f.value=["ATKUP","ダメージUP","クリティカル","属性ダメージUP","被ダメージUP","ATKDOWN","ダメージDOWN","回避","属性ダメージDOWN","被ダメージDOWN","HP回復","HP継続回復","暗闇無効","呪い無効","凍結無効","デバフ解除","呪い"]):(g.value.length>0&&(n.value=[...g.value]),C.value.length>0&&(v.value=[...C.value]),_.value.length>0&&(m.value=[..._.value]),M.value.length>0&&(o.value=[...M.value]),w.value.length>0&&(f.value=[...w.value])),D.value=!1,ie(),window.addEventListener("resize",ce),L.value=await We(X,e=>e.name_en,"icon/"),n.value.length===0&&(n.value=z.value),ne.embedded&&$e([n,v,m,o,f],()=>{g.value=[...n.value],C.value=[...v.value],_.value=[...m.value],M.value=[...o.value],w.value=[...f.value],b.markFilterAsModified(),b.saveCurrentState(),Y()},{deep:!0})}),Te(()=>{window.removeEventListener("resize",ce)});function ye(){g.value=[...n.value],C.value=[...v.value],_.value=[...m.value],M.value=[...o.value],w.value=[...f.value],b.markFilterAsModified(),b.saveCurrentState(),Y(),ae("filter-applied"),ne.embedded||ae("close")}function be(){n.value=z.value,v.value=["SSR"],m.value=["バランス","ディフェンス","アタック"],o.value=["火","水","木","無"],f.value=["ATKUP","ダメージUP","クリティカル","属性ダメージUP","被ダメージUP","ATKDOWN","ダメージDOWN","回避","属性ダメージDOWN","被ダメージDOWN","HP回復","HP継続回復","暗闇無効","呪い無効","凍結無効","デバフ解除","呪い"],g.value=[...n.value],C.value=[...v.value],_.value=[...m.value],M.value=[...o.value],w.value=[...f.value],b.resetFilterState(),Y()}const R=S(()=>new Set(n.value)),N=S(()=>new Set(v.value)),q=S(()=>new Set(m.value)),P=S(()=>new Set(o.value)),de=S(()=>new Set(f.value)),z=S(()=>Object.values(U.value).flat().map(e=>e.name_en)),ge=e=>{const l=R.value.has(e);return{"--icon-size":`${Z}px`,"--gap-size":`${ee}px`,opacity:l?1:.5}};function Y(){T.value.forEach(e=>{if(!N.value.has(e.rare)){e.visible=!1;return}const l=K.get(e.chara);if(!l||!R.value.has(l.name_en)){e.visible=!1;return}if(!q.value.has(e.attr)){e.visible=!1;return}if(!P.value.has(e.magic1atr)&&!P.value.has(e.magic2atr)&&!P.value.has(e.magic3atr)){e.visible=!1;return}if(f.value.length===17)e.visible=!0;else if(f.value.length===0){e.visible=!1;return}else if(f.value.some(r=>e.etc.includes(r)))e.visible=!0;else{e.visible=!1;return}})}function ke(e){const l=e.target;l.src=Pe}function J(e){if(e==="statusEffects")x.value.every(t=>de.value.has(t.value))?f.value=[]:f.value=x.value.map(t=>t.value);else if(e==="cardAttributes"){const l=["SSR","SR","R"].every(a=>N.value.has(a)),t=["バランス","ディフェンス","アタック"].every(a=>q.value.has(a)),r=["火","水","木","無"].every(a=>P.value.has(a));l&&t&&r?(v.value=[],m.value=[],o.value=[]):(v.value=["SSR","SR","R"],m.value=["バランス","ディフェンス","アタック"],o.value=["火","水","木","無"])}else{const l=U.value[e]||[],t=R.value;l.every(a=>t.has(a.name_en))?n.value=n.value.filter(a=>!l.some(p=>p.name_en===a)):n.value=[...new Set([...n.value,...l.map(a=>a.name_en)])]}}function Q(e){return e==="cardAttributes"?ue.every(t=>N.value.has(t))&&re.value.every(t=>q.value.has(t.value))&&oe.value.every(t=>P.value.has(t.value)):e==="statusEffects"?x.value.every(t=>de.value.has(t.value)):(U.value[e]||[]).every(t=>R.value.has(t.name_en))}function Ce(e){const l=R.value;n.value=l.has(e)?n.value.filter(t=>t!==e):[...n.value,e]}const _e=e=>64+(Z+10+ee)*e.length+10,Me=e=>({width:e===1?"100%":"50%"}),Ae=S(()=>{const e=[];let l=[],t=0;const r=se.value,a=2;return Object.entries(U.value).forEach(([p,fe])=>{const G=_e(fe);G>=r/a?(l.length>0&&(e.push(l),l=[],t=0),e.push([p])):t+G<=r&&l.length<a?(l.push(p),t+=G):(e.push(l),l=[p],t=G)}),l.length>0&&e.push(l),e});function we(){ve()?n.value=[]:n.value=[...z.value]}function ve(){return z.value.every(e=>R.value.has(e))}return(e,l)=>(c(),i("div",{class:pe(["modal-background",{embedded:s.embedded}]),ref:"modalContainer"},[h("div",He,[y(F,{small:"",onClick:l[0]||(l[0]=t=>J("cardAttributes"))},{default:W(()=>[E(B(Q("cardAttributes")?A(u)("filterModal.release"):A(u)("filterModal.select")),1)]),_:1}),h("div",Ie,[(c(),i(O,null,V(ue,(t,r)=>h("div",{class:"feature-item",key:`rare-${r}`},[y(j,{modelValue:v.value,"onUpdate:modelValue":l[1]||(l[1]=a=>v.value=a),value:t,label:t,"hide-details":""},null,8,["modelValue","value","label"])])),64)),(c(!0),i(O,null,V(re.value,(t,r)=>(c(),i("div",{class:"feature-item",key:`type-${r}`},[y(j,{modelValue:m.value,"onUpdate:modelValue":l[2]||(l[2]=a=>m.value=a),value:t.value,label:t.name,"hide-details":""},null,8,["modelValue","value","label"])]))),128)),(c(!0),i(O,null,V(oe.value,(t,r)=>(c(),i("div",{class:"feature-item",key:`attr-${r}`},[y(j,{modelValue:o.value,"onUpdate:modelValue":l[3]||(l[3]=a=>o.value=a),value:t.value,label:t.name,"hide-details":""},null,8,["modelValue","value","label"])]))),128))])]),l[8]||(l[8]=h("hr",{class:"rare-divider"},null,-1)),h("div",Le,[h("div",Ke,[y(F,{small:"",onClick:we},{default:W(()=>[E(B(ve()?A(u)("filterModal.release"):A(u)("filterModal.select")),1)]),_:1})]),h("div",Ne,[(c(!0),i(O,null,V(Ae.value,(t,r)=>(c(),i("div",{key:r,class:"row"},[(c(!0),i(O,null,V(t,a=>(c(),i("div",{key:a,style:he(Me(t.length)),class:"character-list"},[h("div",qe,[y(F,{small:"",onClick:p=>J(a)},{default:W(()=>[E(B(Q(a)?A(u)("filterModal.release"):A(u)("filterModal.select")),1)]),_:2},1032,["onClick"]),h("div",Ye,[(c(!0),i(O,null,V(U.value[a],p=>(c(),i("div",{key:p.name_en,class:pe(["character-item",{selected:R.value.has(p.name_en)}]),onClick:fe=>Ce(p.name_en),style:he(ge(p.name_en))},[h("img",{src:L.value[p.name_en],alt:p.name_en,class:"character-image",onError:ke},null,40,Qe)],14,Je))),128))])])],4))),128))]))),128))])]),l[9]||(l[9]=h("hr",{class:"rare-divider"},null,-1)),h("div",Xe,[y(F,{small:"",onClick:l[4]||(l[4]=t=>J("statusEffects"))},{default:W(()=>[E(B(Q("statusEffects")?A(u)("filterModal.release"):A(u)("filterModal.select")),1)]),_:1}),h("div",Ze,[(c(!0),i(O,null,V(x.value,t=>(c(),i("div",{key:t.name,class:"feature-item"},[y(j,{modelValue:f.value,"onUpdate:modelValue":l[5]||(l[5]=r=>f.value=r),value:t.value,label:t.name,"hide-details":""},null,8,["modelValue","value","label"])]))),128))])]),s.embedded?(c(),i("div",ll,[y(F,{class:"button reset-button",onClick:be,variant:"outlined",size:"small"},{default:W(()=>[...l[7]||(l[7]=[E(" フィルターリセット ",-1)])]),_:1})])):(c(),i("div",el,[y(F,{class:"button",onClick:l[6]||(l[6]=t=>e.$emit("close"))},{default:W(()=>[E(B(e.$t("filterModal.cancel")),1)]),_:1}),y(F,{class:"button apply-button",disabled:n.value.length===0||v.value.length===0,onClick:ye},{default:W(()=>[E(B(e.$t("filterModal.submit")),1)]),_:1},8,["disabled"])]))],2))}}),ol=Ue(tl,[["__scopeId","data-v-00075d39"]]);export{ol as F,je as u};

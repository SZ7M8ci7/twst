import{b as Se,j as he,l as ke}from"./common-BF6wUovf.js";import{ar as _e,r as m,d as ge,i as Ce,ah as se,e as I,I as Me,H as Fe,a3 as Ae,j as v,af as ne,a as p,g as S,l as w,w as E,b as O,t as U,u as M,F as A,k as R,o as f,ax as ue,_ as Re}from"./index-CA1IBPti.js";import{c as L}from"./characters_info-CW1N-CN7.js";import ie from"./default-C4N0O_oT.js";import{V as D}from"./VCheckbox-BS5sl8F4.js";let z=null,x=!1,K=null,N=!1;function We(){return x&&z?z:null}function we(a){z=a,x=!0}function Ee(){return N&&K?K:null}function Oe(a){K=a,N=!0}const Ve=_e("filterd",()=>{const a=We(),k=Ee(),o=m((a==null?void 0:a.selectedCharacters)||[]),V=m((a==null?void 0:a.selectedRare)||[]),B=m((a==null?void 0:a.selectedType)||[]),y=m((a==null?void 0:a.selectedAttr)||[]),h=m((a==null?void 0:a.selectedEffects)||[]),_=m(!a),g=m((k==null?void 0:k.sortBy)||"default"),C=m((k==null?void 0:k.sortOrder)||"asc");function F(){const i={selectedCharacters:o.value,selectedRare:V.value,selectedType:B.value,selectedAttr:y.value,selectedEffects:h.value};we(i)}function T(){const i={sortBy:g.value,sortOrder:C.value};Oe(i)}function s(){o.value=[],V.value=[],B.value=[],y.value=[],h.value=[],_.value=!0,z=null,x=!1}function r(){x=!0}function d(){N=!0}return{tempSelectedCharacters:o,tempSelectedRare:V,isFirst:_,tempSelectedType:B,tempSelectedAttr:y,tempSelectedEffects:h,sortBy:g,sortOrder:C,saveCurrentState:F,saveCurrentSortState:T,resetFilterState:s,markFilterAsModified:r,markSortAsModified:d}}),Be={class:"feature-select-all-container"},Ue={class:"feature-items"},Te={class:"display-block"},$e={class:"character-list-wrapper"},Pe={class:"character-select-all-container"},De={class:"character-items"},ze=["onClick"],xe=["src","alt"],He={class:"feature-select-all-container"},je={class:"feature-items"},Ge={key:0,class:"button-container"},Ie={key:1,class:"button-container embedded-buttons"},oe=50,re=10,Le=ge({__name:"FilterModal",props:{embedded:{type:Boolean,default:!1}},emits:["close","filter-applied"],setup(a,{emit:k}){const{t:o}=Ce(),V=Se(),{characters:B}=se(V),y=Ve(),{tempSelectedCharacters:h,tempSelectedRare:_,tempSelectedType:g,tempSelectedAttr:C,tempSelectedEffects:F,isFirst:T}=se(y),s=m([]),r=m([]),d=m([]),i=m([]),c=m([]),q=k,J=m(0),Q=m({}),X=a,de=m({"--icon-size":`${oe}px`,"--gap-size":`${re}px`}),Y=["SSR","SR","R"],Z=I(()=>[{name:o("filterModal.balance"),value:"バランス"},{name:o("filterModal.defence"),value:"ディフェンス"},{name:o("filterModal.attack"),value:"アタック"}]),ee=I(()=>[{name:o("filterModal.fire"),value:"火"},{name:o("filterModal.water"),value:"水"},{name:o("filterModal.flora"),value:"木"},{name:o("filterModal.cosmic"),value:"無"}]),$=I(()=>he.map(e=>({name:o(`filterModal.${e.name}`),value:e.value}))),W=L.reduce((e,l)=>{const t=l.dorm;return e[t]||(e[t]=[]),e[t].push(l),e},{}),le=()=>{const e=document.querySelector(".display-block");e&&(J.value=e.clientWidth)},te=()=>{le()};Me(async()=>{T.value?(s.value=Object.values(W).flat().map(e=>e.name_en),r.value=["SSR"],d.value=["バランス","ディフェンス","アタック"],i.value=["火","水","木","無"],c.value=["ATKUP","ダメージUP","クリティカル","属性ダメージUP","被ダメージUP","ATKDOWN","ダメージDOWN","回避","属性ダメージDOWN","被ダメージDOWN","HP回復","HP継続回復","暗闇無効","呪い無効","凍結無効","デバフ解除","呪い"]):(h.value.length>0&&(s.value=[...h.value]),_.value.length>0&&(r.value=[..._.value]),g.value.length>0&&(d.value=[...g.value]),C.value.length>0&&(i.value=[...C.value]),F.value.length>0&&(c.value=[...F.value])),T.value=!1,le(),window.addEventListener("resize",te),Q.value=await ke(L,e=>e.name_en,"icon/"),X.embedded&&Fe([s,r,d,i,c],()=>{h.value=[...s.value],_.value=[...r.value],g.value=[...d.value],C.value=[...i.value],F.value=[...c.value],y.markFilterAsModified(),y.saveCurrentState(),H()},{deep:!0})}),Ae(()=>{window.removeEventListener("resize",te)});function ce(){h.value=[...s.value],_.value=[...r.value],g.value=[...d.value],C.value=[...i.value],F.value=[...c.value],y.markFilterAsModified(),y.saveCurrentState(),H(),q("filter-applied"),X.embedded||q("close")}function ve(){s.value=Object.values(W).flat().map(e=>e.name_en),r.value=["SSR"],d.value=["バランス","ディフェンス","アタック"],i.value=["火","水","木","無"],c.value=["ATKUP","ダメージUP","クリティカル","属性ダメージUP","被ダメージUP","ATKDOWN","ダメージDOWN","回避","属性ダメージDOWN","被ダメージDOWN","HP回復","HP継続回復","暗闇無効","呪い無効","凍結無効","デバフ解除","呪い"],h.value=[...s.value],_.value=[...r.value],g.value=[...d.value],C.value=[...i.value],F.value=[...c.value],y.resetFilterState(),H()}function H(){B.value.forEach(e=>{if(!r.value.includes(e.rare)){e.visible=!1;return}const l=L.find(t=>t.name_ja===e.chara||t.name_en===e.chara);if(!l||!s.value.includes(l.name_en)){e.visible=!1;return}if(!d.value.includes(e.attr)){e.visible=!1;return}if(!i.value.includes(e.magic1atr)&&!i.value.includes(e.magic2atr)&&!i.value.includes(e.magic3atr)){e.visible=!1;return}if(c.value.length===17)e.visible=!0;else if(c.value.length===0){e.visible=!1;return}else if(c.value.some(n=>e.etc.includes(n)))e.visible=!0;else{e.visible=!1;return}})}function fe(e){const l=e.target;l.src=ie}function j(e){if(e==="statusEffects")$.value.every(t=>c.value.includes(t.value))?c.value=[]:c.value=$.value.map(t=>t.value);else if(e==="cardAttributes"){const l=["SSR","SR","R"].every(u=>r.value.includes(u)),t=["バランス","ディフェンス","アタック"].every(u=>d.value.includes(u)),n=["火","水","木","無"].every(u=>i.value.includes(u));l&&t&&n?(r.value=[],d.value=[],i.value=[]):(r.value=["SSR","SR","R"],d.value=["バランス","ディフェンス","アタック"],i.value=["火","水","木","無"])}else{const l=W[e]||[];l.every(n=>s.value.includes(n.name_en))?s.value=s.value.filter(n=>!l.some(u=>u.name_en===n)):s.value=[...new Set([...s.value,...l.map(n=>n.name_en)])]}}function G(e){return e==="cardAttributes"?Y.every(t=>r.value.includes(t))&&Z.value.every(t=>d.value.includes(t.value))&&ee.value.every(t=>i.value.includes(t.value)):e==="statusEffects"?$.value.every(t=>c.value.includes(t.value)):W[e].every(t=>s.value.includes(t.name_en))}function me(e){s.value=s.value.includes(e)?s.value.filter(l=>l!==e):[...s.value,e]}const pe=e=>64+(oe+10+re)*e.length+10,be=e=>({width:e===1?"100%":"50%"}),ye=()=>{const e=[];let l=[],t=0;const n=J.value,u=2;return Object.entries(W).forEach(([b,ae])=>{const P=pe(ae);P>=n/u?(l.length>0&&(e.push(l),l=[],t=0),e.push([b])):t+P<=n&&l.length<u?(l.push(b),t+=P):(e.push(l),l=[b],t=P)}),l.length>0&&e.push(l),e};return(e,l)=>(f(),v("div",{class:ne(["modal-background",{embedded:a.embedded}]),ref:"modalContainer"},[p("div",Be,[S(w,{small:"",onClick:l[0]||(l[0]=t=>j("cardAttributes"))},{default:E(()=>[O(U(G("cardAttributes")?M(o)("filterModal.release"):M(o)("filterModal.select")),1)]),_:1}),p("div",Ue,[(f(),v(A,null,R(Y,(t,n)=>p("div",{class:"feature-item",key:`rare-${n}`},[S(D,{modelValue:r.value,"onUpdate:modelValue":l[1]||(l[1]=u=>r.value=u),value:t,label:t,"hide-details":""},null,8,["modelValue","value","label"])])),64)),(f(!0),v(A,null,R(Z.value,(t,n)=>(f(),v("div",{class:"feature-item",key:`type-${n}`},[S(D,{modelValue:d.value,"onUpdate:modelValue":l[2]||(l[2]=u=>d.value=u),value:t.value,label:t.name,"hide-details":""},null,8,["modelValue","value","label"])]))),128)),(f(!0),v(A,null,R(ee.value,(t,n)=>(f(),v("div",{class:"feature-item",key:`attr-${n}`},[S(D,{modelValue:i.value,"onUpdate:modelValue":l[3]||(l[3]=u=>i.value=u),value:t.value,label:t.name,"hide-details":""},null,8,["modelValue","value","label"])]))),128))])]),l[8]||(l[8]=p("hr",{class:"rare-divider"},null,-1)),p("div",Te,[p("div",$e,[(f(!0),v(A,null,R(ye(),(t,n)=>(f(),v("div",{key:n,class:"row"},[(f(!0),v(A,null,R(t,u=>(f(),v("div",{key:u,style:ue(be(t.length)),class:"character-list"},[p("div",Pe,[S(w,{small:"",onClick:b=>j(u)},{default:E(()=>[O(U(G(u)?M(o)("filterModal.release"):M(o)("filterModal.select")),1)]),_:2},1032,["onClick"]),p("div",De,[(f(!0),v(A,null,R(M(W)[u],b=>(f(),v("div",{key:b.name_en,class:ne(["character-item",{selected:s.value.includes(b.name_en)}]),onClick:ae=>me(b.name_en),style:ue({...de.value,opacity:s.value.includes(b.name_en)?1:.5})},[p("img",{src:Q.value[b.name_en]||M(ie),alt:b.name_en,class:"character-image",onError:fe},null,40,xe)],14,ze))),128))])])],4))),128))]))),128))])]),l[9]||(l[9]=p("hr",{class:"rare-divider"},null,-1)),p("div",He,[S(w,{small:"",onClick:l[4]||(l[4]=t=>j("statusEffects"))},{default:E(()=>[O(U(G("statusEffects")?M(o)("filterModal.release"):M(o)("filterModal.select")),1)]),_:1}),p("div",je,[(f(!0),v(A,null,R($.value,t=>(f(),v("div",{key:t.name,class:"feature-item"},[S(D,{modelValue:c.value,"onUpdate:modelValue":l[5]||(l[5]=n=>c.value=n),value:t.value,label:t.name,"hide-details":""},null,8,["modelValue","value","label"])]))),128))])]),a.embedded?(f(),v("div",Ie,[S(w,{class:"button reset-button",onClick:ve,variant:"outlined",size:"small"},{default:E(()=>l[7]||(l[7]=[O(" フィルターリセット ")])),_:1,__:[7]})])):(f(),v("div",Ge,[S(w,{class:"button",onClick:l[6]||(l[6]=t=>e.$emit("close"))},{default:E(()=>[O(U(e.$t("filterModal.cancel")),1)]),_:1}),S(w,{class:"button apply-button",disabled:s.value.length===0||r.value.length===0,onClick:ce},{default:E(()=>[O(U(e.$t("filterModal.submit")),1)]),_:1},8,["disabled"])]))],2))}}),Xe=Re(Le,[["__scopeId","data-v-60fee550"]]);export{Xe as F,Ve as u};

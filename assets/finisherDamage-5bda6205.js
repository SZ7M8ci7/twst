import{b as qe,l as ue,h as Qe}from"./common-5abb3ea4.js";import{d as Xe,v as Ye,r as _,e as U,R as ke,a3 as Ze,o as r,c as $,w as f,j as g,h as l,ai as Je,a as t,aV as de,F as b,k as S,b8 as pe,l as K,aj as J,b as E,t as p,b9 as ye,y as A,p as ea,n as aa,_ as ia}from"./index-c8a98b62.js";import{C as L}from"./CharacterIconWithType-b41eeb45.js";import{c as P,V as be}from"./VDialog-da592426.js";import{V as we,a as Ce}from"./VCard-4dfe1dce.js";import{V as De}from"./VCardText-5f2b0372.js";import{V as ee}from"./VSpacer-ffeda924.js";import{V as sa}from"./VContainer-d706e28f.js";const me=N=>(ea("data-v-97ff20e1"),N=N(),aa(),N),ta={key:0,class:"loading-container"},oa=me(()=>t("p",{class:"loading-text"},"Loading...",-1)),na={class:"character-row"},la={class:"damage-row"},ca=["onClick"],ra={class:"header-content"},ua=me(()=>t("span",{class:"vs-text"},"VS",-1)),da=["src","alt"],ma={class:"sort-icon"},fa={key:0,class:"sort-indicator"},va={key:1,class:"sort-hint"},ga={class:"character-row all-characters-row"},_a=me(()=>t("div",{class:"all-characters-label"},"ALL",-1)),ha=[_a],ka={class:"damage-row"},pa={class:"damage-item all-characters-item"},ya=["onClick"],ba={class:"damage-row"},wa={class:"damage-item"},Ca=["onClick"],Da={class:"damage-item-content"},Ua={class:"card-info"},Sa={key:0,class:"buddy-cards"},Ta={key:0,class:"buff-info"},Ma={class:"buff-container"},xa={key:0,class:"buff-source"},La={class:"damage-value"},Pa={class:"pagination-controls"},Ia={class:"page-info"},Va={class:"damage-item-content"},Ka={class:"card-info"},Ea={key:0,class:"buddy-cards"},Aa={key:0,class:"buff-info"},za={class:"buff-container"},Fa={key:0,class:"buff-source"},$a={class:"damage-value"},Na={class:"pagination-controls"},ja={class:"page-info"},Ue=50,Ba=10,Wa=80,Ha=Xe({__name:"finisherDamage",setup(N){const Se=qe(),{characters:y}=Ye(Se),u=_(new Map),ae=_({"--icon-size":`${Ue}px`,"--gap-size":`${Ba}px`}),Te={fire:"fire",water:"water",flora:"flora",cosmic:"cosmic"},fe=_(!0),T=U(()=>{const e={};for(const[i,a]of u.value.entries())e[i]=a.iconSrc||a.imgSrc||"";return e});ke(async()=>{try{const e=await ue(y.value,"name"),i=await ue(P,"name_en","icon/"),a={},s=new Map(P.map(o=>[o.name_ja,o.name_en]));y.value.forEach(o=>{const d=s.get(o.name);d&&i[d]&&(a[o.name]=i[d])});const n=await ue(Object.values(Te),o=>o,"icon/");u.value=Qe(y.value,e,a,n);const c=new Set(u.value.keys());P.forEach(o=>{const d=i[o.name_en];d&&(o.name_ja&&!c.has(o.name_ja)&&u.value.set(o.name_ja,{type:"",wikiUrl:"",imgSrc:"",iconSrc:d}),o.name_en&&!c.has(o.name_en)&&u.value.set(o.name_en,{type:"",wikiUrl:"",imgSrc:"",iconSrc:d}))})}catch(e){console.error("Error in onMounted finisherDamage.vue:",e)}finally{fe.value=!1}});const j={},Me=["(極小)","(小)","(中)","(大)","(極大)"],xe=["ATKUP","ダメージUP","無属性ダメージUP","火属性ダメージUP","水属性ダメージUP","木属性ダメージUP","被ダメージUP"],Le={"ATKUP(極小)":.1,"ATKUP(小)":.2,"ATKUP(中)":.35,"ATKUP(大)":.5,"ATKUP(極大)":.8},z={},B={},W={},H={},R={},ie={},se={},te={};y.value.forEach(e=>{const i=e.etc.split(",");j[e.chara]||(j[e.chara]=[]),i.forEach(a=>{const s=a.trim();!s.includes("味方")&&!(s.includes("被ダメージUP")&&s.includes("相手"))||xe.forEach(n=>{s.startsWith(n)&&Me.forEach(c=>{if(s.includes(c)){let o="";s.includes("(M1)")?o="M1":s.includes("(M2)")?o="M2":s.includes("(M3)")&&(o="M3"),j[e.chara].push({buff:n+c,name:e.name,buffSource:o})}})})})}),y.value.forEach(e=>{if(e.rare!="SSR")return;const i=oe(e.buddy1s)+oe(e.buddy2s)+oe(e.buddy3s),a=Pe(e.etc),s=Ie(e.etc);let n=0,c=0,o=0,d=0;function v(h,m,w,Z){const he=Le[m]||0,Oe=e.atk+e.atk*i+e.atk*a+e.atk*he;let k=0;const Ge=h==="無"?1.1:1;if(m.includes(h+"属性ダメージUP")?(m.includes("(極小)")&&(k=.025),m.includes("(小)")&&(k=.06),m.includes("(中)")&&(k=.105),m.includes("(大)")&&(k=.15),m.includes("(極大)")&&(k=.27)):m.includes("ダメージUP")&&!m.includes("属性ダメージUP")&&(m.includes("(極小)")&&(k=.0225),m.includes("(小)")&&(k=.05),m.includes("(中)")&&(k=.0875),m.includes("(大)")&&(k=.125),m.includes("(極大)")&&(k=.225)),m!=""&&he==0&&k==0)return;const C=Math.floor(Oe*(Ge+s+k)*2.4);R[e.name]||(R[e.name]=[],ie[e.name]=[],se[e.name]=[],te[e.name]=[]);const D={無:{fire:1,water:1,flora:1,cosmic:1},火:{fire:1,water:.5,flora:1.5,cosmic:1},水:{fire:1.5,water:1,flora:.5,cosmic:1},木:{fire:.5,water:1.5,flora:1,cosmic:1}}[h]||{fire:1,water:1,flora:1,cosmic:1};n=Math.max(C*D.fire,n),c=Math.max(C*D.water,c),o=Math.max(C*D.flora,o),d=Math.max(C*D.cosmic,d),R[e.name].push({damage:C*D.fire,name:w,buffSource:Z}),ie[e.name].push({damage:C*D.water,name:w,buffSource:Z}),se[e.name].push({damage:C*D.flora,name:w,buffSource:Z}),te[e.name].push({damage:C*D.cosmic,name:w,buffSource:Z})}v(e.magic2atr,"",je(e.duo),""),j[e.duo].forEach(h=>{v(e.magic2atr,h.buff,h.name,h.buffSource)}),z[e.chara]||(z[e.chara]=0,B[e.chara]=0,W[e.chara]=0,H[e.chara]=0),z[e.chara]=Math.max(z[e.chara],n),B[e.chara]=Math.max(B[e.chara],c),W[e.chara]=Math.max(W[e.chara],o),H[e.chara]=Math.max(H[e.chara],d)});function oe(e){return e.includes("ATK")&&e.includes("小")?.2:e.includes("ATK")&&e.includes("中")?.35:0}function Pe(e){return e.includes("ATKUP(極小)(自/3T)")?.1:e.includes("ATKUP(小)(自/3T)")?.2:e.includes("ATKUP(中)(自/3T)")?.35:e.includes("ATKUP(大)(自/3T)")?.5:0}function Ie(e){return e.includes("ダメージUP(極小)(自/3T)")?.02:e.includes("ダメージUP(小)(自/3T)")?.05:e.includes("ダメージUP(中)(自/3T)")?.0875:e.includes("ダメージUP(大)(自/3T)")?.125:e.includes("被ダメージUP(中)(相手全体/2T)")?.0875:0}const O={};y.value.forEach(e=>{e.rare=="SSR"&&(O[e.chara]||(O[e.chara]=[]),O[e.chara].push(e.name))});const Ve=_({});P.forEach(e=>{Ve.value[e.name_en]={fire:[],water:[],flora:[],cosmic:[]}});const G=_(!1),ne=_([]),Ke=_(""),Ee=_(""),M=_(1),q=_(10),Ae=U(()=>{const e=(M.value-1)*q.value,i=e+q.value;return Ne.value.slice(e,i)}),ve=U(()=>Math.ceil(ne.value.length/q.value));function ze(e,i){const a=le(i),s=O[e];if(!s||s.length===0)return;const n=s.flatMap(c=>(a[c]||[]).map(d=>({...d,cardName:c})));ne.value=n,Ke.value=e,Ee.value=i,M.value=1,G.value=!0}function le(e){return{fire:R,water:ie,flora:se,cosmic:te}[e]}const I=_(""),F=_("desc");function Fe(e){I.value===e?F.value=F.value==="asc"?"desc":"asc":(I.value=e,F.value="desc")}const $e=U(()=>I.value?[...P].sort((e,i)=>{const a=Q(e.name_ja,I.value),s=Q(i.name_ja,I.value),n=typeof a=="number"?a:0,c=typeof s=="number"?s:0;return F.value==="asc"?n-c:c-n}):P);function Q(e,i){var n;if(e==="全キャラ"){const c=le(i),o=y.value.filter(d=>d.rare==="SSR").reduce((d,v)=>{const h=c[v.name]||[],m=Math.max(...h.map(w=>w.damage),0);return Math.max(d,m)},0);return Math.floor(o)}const s=(n={fire:z,water:B,flora:W,cosmic:H}[i])==null?void 0:n[e];return s?Math.floor(s):"-"}const Ne=U(()=>[...ne.value].sort((e,i)=>i.damage-e.damage));function je(e){const i=P.find(a=>a.name_ja===e);return(i==null?void 0:i.name_en)||""}function V(e){if(!e)return;const i=u.value.get(e);i&&i.wikiUrl&&window.open(i.wikiUrl,"_blank")}const X=_(!1),ce=_([]),Be=_("fire"),x=_(1),Y=_(10);function re(){const a=window.innerHeight*.95-60,s=Math.max(1,Math.floor(a/Wa));q.value=s,Y.value=s}ke(()=>{re(),window.addEventListener("resize",re)}),Ze(()=>{window.removeEventListener("resize",re)});const We=U(()=>{const e=(x.value-1)*Y.value,i=e+Y.value;return Re.value.slice(e,i)}),ge=U(()=>Math.ceil(ce.value.length/Y.value));function He(e){Be.value=e;const i=le(e);ce.value=y.value.filter(a=>a.rare==="SSR").flatMap(a=>(i[a.name]||[]).map(n=>({cardName:a.name,damage:n.damage,buffName:n.name||"",buffSource:n.buffSource||""}))),x.value=1,X.value=!0}const Re=U(()=>[...ce.value].sort((e,i)=>i.damage-e.damage));function _e(e){const i=y.value.find(s=>s.name===e);if(!i)return[];const a=[];return i.buddy1c&&i.buddy1s.includes("ATK")&&u.value.get(i.buddy1c)&&a.push(i.buddy1c),i.buddy2c&&i.buddy2s.includes("ATK")&&u.value.get(i.buddy2c)&&a.push(i.buddy2c),i.buddy3c&&i.buddy3s.includes("ATK")&&u.value.get(i.buddy3c)&&a.push(i.buddy3c),a}return(e,i)=>(r(),$(sa,{class:"finisher-container"},{default:f(()=>[fe.value?(r(),g("div",ta,[l(Je,{indeterminate:"",color:"primary",size:64}),oa])):(r(),g(b,{key:1},[t("div",na,[t("div",{class:"character-item",style:de({...ae.value})},null,4),t("div",la,[(r(),g(b,null,S(["Fire","Water","Flora","Cosmic"],a=>{var s;return t("div",{key:a,class:"damage-col"},[t("div",{class:"damage-item clickable-header",onClick:n=>Fe(a.toLowerCase())},[t("div",ra,[ua,t("img",{src:((s=u.value.get(a.toLowerCase()))==null?void 0:s.imgSrc)||"",alt:a,class:"element-icon"},null,8,da),t("span",ma,[I.value===a.toLowerCase()?(r(),g("span",fa,p(F.value==="asc"?"↑":"↓"),1)):(r(),g("span",va,"↕"))])])],8,ca)])}),64))])]),t("div",ga,[t("div",{class:"character-item",style:de({...ae.value})},ha,4),t("div",ka,[(r(),g(b,null,S(["Fire","Water","Flora","Cosmic"],a=>t("div",{key:a,class:"damage-col"},[t("div",pa,[t("span",{class:"clickable-damage",onClick:s=>He(a.toLowerCase())},p(Q("全キャラ",a.toLowerCase())),9,ya)])])),64))])]),(r(!0),g(b,null,S($e.value,a=>{var s;return r(),g("div",{key:a.name_en,class:"character-row"},[t("div",{class:"character-item",style:de({...ae.value})},[l(L,{iconKey:a.name_ja,iconDictionary:T.value,wikiUrl:((s=u.value.get(a.name_ja))==null?void 0:s.wikiUrl)||"",iconSize:Ue},null,8,["iconKey","iconDictionary","wikiUrl"])],4),t("div",ba,[(r(),g(b,null,S(["Fire","Water","Flora","Cosmic"],n=>t("div",{key:n,class:"damage-col"},[t("div",wa,[t("span",{class:"clickable-damage",onClick:c=>ze(a.name_ja,n.toLowerCase())},p(Q(a.name_ja,n.toLowerCase())),9,Ca)])])),64))])])}),128))],64)),l(be,{modelValue:G.value,"onUpdate:modelValue":i[3]||(i[3]=a=>G.value=a),"max-width":"450"},{default:f(()=>[l(we,null,{default:f(()=>[l(De,{class:"modal-content"},{default:f(()=>[l(pe,{class:"damage-list"},{default:f(()=>[(r(!0),g(b,null,S(Ae.value,(a,s)=>(r(),$(ye,{key:s,class:"damage-list-item"},{default:f(()=>{var n,c,o,d;return[t("div",Da,[t("div",Ua,[l(L,{iconKey:a.cardName||"",iconDictionary:T.value,wikiUrl:((n=u.value.get(a.cardName||""))==null?void 0:n.wikiUrl)||"",cardType:((c=u.value.get(a.cardName||""))==null?void 0:c.type)||"",iconSize:46,class:"card-icon clickable-icon",onClick:v=>V(a.cardName)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),a.cardName?(r(),g("div",Sa,[(r(!0),g(b,null,S(_e(a.cardName),v=>{var h,m;return r(),$(L,{key:v,iconKey:v,iconDictionary:T.value,wikiUrl:((h=u.value.get(v))==null?void 0:h.wikiUrl)||"",cardType:((m=u.value.get(v))==null?void 0:m.type)||"",iconSize:26,class:"buddy-icon clickable-icon",onClick:w=>V(v)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"])}),128))])):A("",!0)]),a.name?(r(),g("div",Ta,[t("div",Ma,[l(L,{iconKey:a.name,iconDictionary:T.value,wikiUrl:((o=u.value.get(a.name))==null?void 0:o.wikiUrl)||"",cardType:((d=u.value.get(a.name))==null?void 0:d.type)||"",iconSize:46,class:"buff-icon clickable-icon",onClick:v=>V(a.name)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),a.buffSource?(r(),g("span",xa,p(a.buffSource),1)):A("",!0)])])):A("",!0),t("div",La,p(Math.floor(a.damage).toLocaleString()),1)])]}),_:2},1024))),128))]),_:1})]),_:1}),l(Ce,null,{default:f(()=>[l(ee),t("div",Pa,[l(K,{disabled:M.value===1,onClick:i[0]||(i[0]=a=>M.value--),variant:"text",size:"small",icon:""},{default:f(()=>[l(J,null,{default:f(()=>[E("mdi-chevron-left")]),_:1})]),_:1},8,["disabled"]),t("span",Ia,p(M.value)+" / "+p(ve.value),1),l(K,{disabled:M.value===ve.value,onClick:i[1]||(i[1]=a=>M.value++),variant:"text",size:"small",icon:""},{default:f(()=>[l(J,null,{default:f(()=>[E("mdi-chevron-right")]),_:1})]),_:1},8,["disabled"])]),l(ee),l(K,{color:"grey",variant:"outlined",class:"close-btn",onClick:i[2]||(i[2]=a=>G.value=!1)},{default:f(()=>[E("CLOSE")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(be,{modelValue:X.value,"onUpdate:modelValue":i[7]||(i[7]=a=>X.value=a),"max-width":"450"},{default:f(()=>[l(we,null,{default:f(()=>[l(De,{class:"modal-content"},{default:f(()=>[l(pe,{class:"damage-list"},{default:f(()=>[(r(!0),g(b,null,S(We.value,(a,s)=>(r(),$(ye,{key:s,class:"damage-list-item"},{default:f(()=>{var n,c,o,d;return[t("div",Va,[t("div",Ka,[l(L,{iconKey:a.cardName,iconDictionary:T.value,wikiUrl:((n=u.value.get(a.cardName))==null?void 0:n.wikiUrl)||"",cardType:((c=u.value.get(a.cardName))==null?void 0:c.type)||"",iconSize:46,class:"card-icon clickable-icon",onClick:v=>V(a.cardName)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),a.cardName?(r(),g("div",Ea,[(r(!0),g(b,null,S(_e(a.cardName),v=>{var h,m;return r(),$(L,{key:v,iconKey:v,iconDictionary:T.value,wikiUrl:((h=u.value.get(v))==null?void 0:h.wikiUrl)||"",cardType:((m=u.value.get(v))==null?void 0:m.type)||"",iconSize:26,class:"buddy-icon clickable-icon",onClick:w=>V(v)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"])}),128))])):A("",!0)]),a.buffName?(r(),g("div",Aa,[t("div",za,[l(L,{iconKey:a.buffName,iconDictionary:T.value,wikiUrl:((o=u.value.get(a.buffName))==null?void 0:o.wikiUrl)||"",cardType:((d=u.value.get(a.buffName))==null?void 0:d.type)||"",iconSize:46,class:"buff-icon clickable-icon",onClick:v=>V(a.buffName)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),a.buffSource?(r(),g("span",Fa,p(a.buffSource),1)):A("",!0)])])):A("",!0),t("div",$a,p(Math.floor(a.damage).toLocaleString()),1)])]}),_:2},1024))),128))]),_:1})]),_:1}),l(Ce,null,{default:f(()=>[l(ee),t("div",Na,[l(K,{disabled:x.value===1,onClick:i[4]||(i[4]=a=>x.value--),variant:"text",size:"small",icon:""},{default:f(()=>[l(J,null,{default:f(()=>[E("mdi-chevron-left")]),_:1})]),_:1},8,["disabled"]),t("span",ja,p(x.value)+" / "+p(ge.value),1),l(K,{disabled:x.value===ge.value,onClick:i[5]||(i[5]=a=>x.value++),variant:"text",size:"small",icon:""},{default:f(()=>[l(J,null,{default:f(()=>[E("mdi-chevron-right")]),_:1})]),_:1},8,["disabled"])]),l(ee),l(K,{color:"grey",variant:"outlined",class:"close-btn",onClick:i[6]||(i[6]=a=>X.value=!1)},{default:f(()=>[E("CLOSE")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});const ei=ia(Ha,[["__scopeId","data-v-97ff20e1"]]);export{ei as default};

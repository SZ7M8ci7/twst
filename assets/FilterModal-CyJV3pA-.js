import{b as be,j as ye,l as Se}from"./common-br9WzDBc.js";import{ar as he,r as m,d as ke,i as _e,ah as te,e as H,I as ge,H as Ce,a3 as Me,j as d,af as ae,a as p,g as S,l as A,w,b as E,t as T,u as k,F,k as R,o as c,ax as se,_ as Fe}from"./index-ZRFNbwzj.js";import{c as I}from"./characters_info-BUca79Mn.js";import ne from"./default-C4N0O_oT.js";import{V as P}from"./VCheckbox-DZMtESH9.js";let D=null,z=!1;function Re(){return z&&D?D:null}function We(s){D=s,z=!0}const Ae=he("filterd",()=>{const s=Re(),V=m((s==null?void 0:s.selectedCharacters)||[]),i=m((s==null?void 0:s.selectedRare)||[]),U=m((s==null?void 0:s.selectedType)||[]),O=m((s==null?void 0:s.selectedAttr)||[]),y=m((s==null?void 0:s.selectedEffects)||[]),h=m(!s);function _(){const M={selectedCharacters:V.value,selectedRare:i.value,selectedType:U.value,selectedAttr:O.value,selectedEffects:y.value};We(M)}function g(){V.value=[],i.value=[],U.value=[],O.value=[],y.value=[],h.value=!0,D=null,z=!1}function C(){z=!0}return{tempSelectedCharacters:V,tempSelectedRare:i,isFirst:h,tempSelectedType:U,tempSelectedAttr:O,tempSelectedEffects:y,saveCurrentState:_,resetFilterState:g,markFilterAsModified:C}}),we={class:"feature-select-all-container"},Ee={class:"feature-items"},Ve={class:"display-block"},Ue={class:"character-list-wrapper"},Oe={class:"character-select-all-container"},Te={class:"character-items"},$e=["onClick"],Be=["src","alt"],Pe={class:"feature-select-all-container"},De={class:"feature-items"},ze={key:0,class:"button-container"},xe={key:1,class:"button-container embedded-buttons"},ue=50,ie=10,je=ke({__name:"FilterModal",props:{embedded:{type:Boolean,default:!1}},emits:["close","filter-applied"],setup(s,{emit:V}){const{t:i}=_e(),U=be(),{characters:O}=te(U),y=Ae(),{tempSelectedCharacters:h,tempSelectedRare:_,tempSelectedType:g,tempSelectedAttr:C,tempSelectedEffects:M,isFirst:L}=te(y),u=m([]),v=m([]),f=m([]),o=m([]),r=m([]),K=V,N=m(0),q=m({}),J=s,oe=m({"--icon-size":`${ue}px`,"--gap-size":`${ie}px`}),Q=["SSR","SR","R"],X=H(()=>[{name:i("filterModal.balance"),value:"バランス"},{name:i("filterModal.defence"),value:"ディフェンス"},{name:i("filterModal.attack"),value:"アタック"}]),Y=H(()=>[{name:i("filterModal.fire"),value:"火"},{name:i("filterModal.water"),value:"水"},{name:i("filterModal.flora"),value:"木"},{name:i("filterModal.cosmic"),value:"無"}]),$=H(()=>ye.map(e=>({name:i(`filterModal.${e.name}`),value:e.value}))),W=I.reduce((e,l)=>{const t=l.dorm;return e[t]||(e[t]=[]),e[t].push(l),e},{}),Z=()=>{const e=document.querySelector(".display-block");e&&(N.value=e.clientWidth)},ee=()=>{Z()};ge(async()=>{L.value?(u.value=Object.values(W).flat().map(e=>e.name_en),v.value=["SSR"],f.value=["バランス","ディフェンス","アタック"],o.value=["火","水","木","無"],r.value=["ATKUP","ダメージUP","クリティカル","属性ダメージUP","被ダメージUP","ATKDOWN","ダメージDOWN","回避","属性ダメージDOWN","被ダメージDOWN","HP回復","HP継続回復","暗闇無効","呪い無効","凍結無効","デバフ解除","呪い"]):(h.value.length>0&&(u.value=[...h.value]),_.value.length>0&&(v.value=[..._.value]),g.value.length>0&&(f.value=[...g.value]),C.value.length>0&&(o.value=[...C.value]),M.value.length>0&&(r.value=[...M.value])),L.value=!1,Z(),window.addEventListener("resize",ee),q.value=await Se(I,e=>e.name_en,"icon/"),J.embedded&&Ce([u,v,f,o,r],()=>{h.value=[...u.value],_.value=[...v.value],g.value=[...f.value],C.value=[...o.value],M.value=[...r.value],y.markFilterAsModified(),y.saveCurrentState(),x()},{deep:!0})}),Me(()=>{window.removeEventListener("resize",ee)});function re(){h.value=[...u.value],_.value=[...v.value],g.value=[...f.value],C.value=[...o.value],M.value=[...r.value],y.markFilterAsModified(),y.saveCurrentState(),x(),K("filter-applied"),J.embedded||K("close")}function de(){u.value=Object.values(W).flat().map(e=>e.name_en),v.value=["SSR"],f.value=["バランス","ディフェンス","アタック"],o.value=["火","水","木","無"],r.value=["ATKUP","ダメージUP","クリティカル","属性ダメージUP","被ダメージUP","ATKDOWN","ダメージDOWN","回避","属性ダメージDOWN","被ダメージDOWN","HP回復","HP継続回復","暗闇無効","呪い無効","凍結無効","デバフ解除","呪い"],h.value=[...u.value],_.value=[...v.value],g.value=[...f.value],C.value=[...o.value],M.value=[...r.value],y.resetFilterState(),x()}function x(){O.value.forEach(e=>{if(!v.value.includes(e.rare)){e.visible=!1;return}const l=I.find(t=>t.name_ja===e.chara||t.name_en===e.chara);if(!l||!u.value.includes(l.name_en)){e.visible=!1;return}if(!f.value.includes(e.attr)){e.visible=!1;return}if(!o.value.includes(e.magic1atr)&&!o.value.includes(e.magic2atr)&&!o.value.includes(e.magic3atr)){e.visible=!1;return}if(r.value.length===17)e.visible=!0;else if(r.value.length===0){e.visible=!1;return}else if(r.value.some(a=>e.etc.includes(a)))e.visible=!0;else{e.visible=!1;return}})}function ce(e){const l=e.target;l.src=ne}function j(e){if(e==="statusEffects")$.value.every(t=>r.value.includes(t.value))?r.value=[]:r.value=$.value.map(t=>t.value);else if(e==="cardAttributes"){const l=["SSR","SR","R"].every(n=>v.value.includes(n)),t=["バランス","ディフェンス","アタック"].every(n=>f.value.includes(n)),a=["火","水","木","無"].every(n=>o.value.includes(n));l&&t&&a?(v.value=[],f.value=[],o.value=[]):(v.value=["SSR","SR","R"],f.value=["バランス","ディフェンス","アタック"],o.value=["火","水","木","無"])}else{const l=W[e]||[];l.every(a=>u.value.includes(a.name_en))?u.value=u.value.filter(a=>!l.some(n=>n.name_en===a)):u.value=[...new Set([...u.value,...l.map(a=>a.name_en)])]}}function G(e){return e==="cardAttributes"?Q.every(t=>v.value.includes(t))&&X.value.every(t=>f.value.includes(t.value))&&Y.value.every(t=>o.value.includes(t.value)):e==="statusEffects"?$.value.every(t=>r.value.includes(t.value)):W[e].every(t=>u.value.includes(t.name_en))}function ve(e){u.value=u.value.includes(e)?u.value.filter(l=>l!==e):[...u.value,e]}const fe=e=>64+(ue+10+ie)*e.length+10,me=e=>({width:e===1?"100%":"50%"}),pe=()=>{const e=[];let l=[],t=0;const a=N.value,n=2;return Object.entries(W).forEach(([b,le])=>{const B=fe(le);B>=a/n?(l.length>0&&(e.push(l),l=[],t=0),e.push([b])):t+B<=a&&l.length<n?(l.push(b),t+=B):(e.push(l),l=[b],t=B)}),l.length>0&&e.push(l),e};return(e,l)=>(c(),d("div",{class:ae(["modal-background",{embedded:s.embedded}]),ref:"modalContainer"},[p("div",we,[S(A,{small:"",onClick:l[0]||(l[0]=t=>j("cardAttributes"))},{default:w(()=>[E(T(G("cardAttributes")?k(i)("filterModal.release"):k(i)("filterModal.select")),1)]),_:1}),p("div",Ee,[(c(),d(F,null,R(Q,(t,a)=>p("div",{class:"feature-item",key:`rare-${a}`},[S(P,{modelValue:v.value,"onUpdate:modelValue":l[1]||(l[1]=n=>v.value=n),value:t,label:t,"hide-details":""},null,8,["modelValue","value","label"])])),64)),(c(!0),d(F,null,R(X.value,(t,a)=>(c(),d("div",{class:"feature-item",key:`type-${a}`},[S(P,{modelValue:f.value,"onUpdate:modelValue":l[2]||(l[2]=n=>f.value=n),value:t.value,label:t.name,"hide-details":""},null,8,["modelValue","value","label"])]))),128)),(c(!0),d(F,null,R(Y.value,(t,a)=>(c(),d("div",{class:"feature-item",key:`attr-${a}`},[S(P,{modelValue:o.value,"onUpdate:modelValue":l[3]||(l[3]=n=>o.value=n),value:t.value,label:t.name,"hide-details":""},null,8,["modelValue","value","label"])]))),128))])]),l[8]||(l[8]=p("hr",{class:"rare-divider"},null,-1)),p("div",Ve,[p("div",Ue,[(c(!0),d(F,null,R(pe(),(t,a)=>(c(),d("div",{key:a,class:"row"},[(c(!0),d(F,null,R(t,n=>(c(),d("div",{key:n,style:se(me(t.length)),class:"character-list"},[p("div",Oe,[S(A,{small:"",onClick:b=>j(n)},{default:w(()=>[E(T(G(n)?k(i)("filterModal.release"):k(i)("filterModal.select")),1)]),_:2},1032,["onClick"]),p("div",Te,[(c(!0),d(F,null,R(k(W)[n],b=>(c(),d("div",{key:b.name_en,class:ae(["character-item",{selected:u.value.includes(b.name_en)}]),onClick:le=>ve(b.name_en),style:se({...oe.value,opacity:u.value.includes(b.name_en)?1:.5})},[p("img",{src:q.value[b.name_en]||k(ne),alt:b.name_en,class:"character-image",onError:ce},null,40,Be)],14,$e))),128))])])],4))),128))]))),128))])]),l[9]||(l[9]=p("hr",{class:"rare-divider"},null,-1)),p("div",Pe,[S(A,{small:"",onClick:l[4]||(l[4]=t=>j("statusEffects"))},{default:w(()=>[E(T(G("statusEffects")?k(i)("filterModal.release"):k(i)("filterModal.select")),1)]),_:1}),p("div",De,[(c(!0),d(F,null,R($.value,t=>(c(),d("div",{key:t.name,class:"feature-item"},[S(P,{modelValue:r.value,"onUpdate:modelValue":l[5]||(l[5]=a=>r.value=a),value:t.value,label:t.name,"hide-details":""},null,8,["modelValue","value","label"])]))),128))])]),s.embedded?(c(),d("div",xe,[S(A,{class:"button reset-button",onClick:de,variant:"outlined",size:"small"},{default:w(()=>l[7]||(l[7]=[E(" フィルターリセット ")])),_:1,__:[7]})])):(c(),d("div",ze,[S(A,{class:"button",onClick:l[6]||(l[6]=t=>e.$emit("close"))},{default:w(()=>[E(T(e.$t("filterModal.cancel")),1)]),_:1}),S(A,{class:"button apply-button",disabled:u.value.length===0||v.value.length===0,onClick:re},{default:w(()=>[E(T(e.$t("filterModal.submit")),1)]),_:1},8,["disabled"])]))],2))}}),Ne=Fe(je,[["__scopeId","data-v-60fee550"]]);export{Ne as F,Ae as u};

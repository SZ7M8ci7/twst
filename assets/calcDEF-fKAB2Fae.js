import{C as L,r as Q,u as X,V as Y,D as Z}from"./simulatorStore-BPPBayNj.js";import{d as ee,i as ae,r as m,e as d,a6 as le,q as te,c as se,o as oe,w as s,g as a,a as o,t as c,m as ne,V as b,b as R,b9 as ue,_ as de}from"./index-D7UyBjma.js";import{V as n,a as v}from"./VRow-DHsgmN3K.js";import{V as ce}from"./VContainer-DROx7nM8.js";import"./calculations-qvwqQ9hv.js";import"./handCollection-C-8volAY.js";const ie={class:"field-label"},re={class:"field-label"},fe={class:"field-label"},me={class:"field-label"},ve={class:"field-label"},pe={class:"field-label"},ge={class:"mdi mdi-help-circle-outline"},be={class:"field-label"},De={class:"table-wrapper"},Ve={class:"pa-0"},_e={class:"pa-0"},Ce={class:"text-nowrap wide-cell pa-0"},he={class:"pa-0"},ye={class:"pa-0"},Fe=ee({__name:"calcDEF",props:{selectedAttribute:{}},setup(B){L.register(...Q);const{t:D}=ae(),i=X(),$=B,k=m(!1),r=m(5),p=[.8,.85,.9,.95,1],C=m(0),A=m(0),h=m(0),y=m(0),F=m(0),f=m(1.5),I=[{text:"Easy",value:.8},{text:"Normal",value:1},{text:"Hard",value:1.2},{text:"Extra",value:1.5}],_=m({advantageDamaged:0,disadvantageDamaged:0}),N=d(()=>A.value*.1275),T=d(()=>Number(C.value)*.0625),H=d(()=>Number(h.value*.05)),w=d(()=>_.value.advantageDamaged*2*.05208),x=d(()=>-_.value.disadvantageDamaged/1.5*.05208),P=d(()=>y.value*600),O=d(()=>F.value*300),q=d(()=>N.value+T.value+H.value+w.value+x.value+P.value+O.value),z=d(()=>(q.value*f.value*p[r.value-1]).toFixed()),V=["#FAD9C8","#FAF2C8","#E9FAC8","#D0FAC8","#C8FAD9","#C8FAF2","#C8E9FA","#C8D0FA","#D9C8FA","#F2C8FA"],S=d(()=>[{label:D("deffence.remainHP"),value:Math.floor(N.value*f.value*p[r.value-1]),color:V[0]},{label:D("deffence.totalHP"),value:Math.floor(T.value*f.value*p[r.value-1]),color:V[1]},{label:D("deffence.damage"),value:Math.floor(H.value*f.value*p[r.value-1]),color:V[2]},{label:D("deffence.advantageDamageTaken"),value:Math.floor(w.value*f.value*p[r.value-1]),color:V[3]},{label:D("deffence.disadvantageDamageTaken"),value:Math.floor(x.value*f.value*p[r.value-1]),color:V[4]},{label:D("deffence.evasion"),value:Math.floor(P.value*f.value*p[r.value-1]),color:V[5]},{label:D("deffence.debuff"),value:Math.floor(O.value*f.value*p[r.value-1]),color:V[6]}].sort((t,e)=>e.value-t.value)),G=d(()=>({labels:S.value.map(t=>t.label),datasets:[{data:S.value.map(t=>t.value),backgroundColor:S.value.map(t=>t.color)}]}));le(async()=>{await i.waitForDeckStats(),k.value=!0,te(()=>[i.deckCharacters,$.selectedAttribute,i.isDeckStatsReady],()=>{k.value&&i.isDeckStatsReady&&K()},{deep:!0,immediate:!0})});async function K(){if(k.value)try{const t=$.selectedAttribute||"対全",e=await i.waitForDeckStats(),l=((e==null?void 0:e.totalHP)||0)+((e==null?void 0:e.totalBuddyHP)||0)+((e==null?void 0:e.totalHeal)||0);C.value=Math.round(l);const g=await i.getSafeDeckDamage(t);h.value=Math.floor(g);const E=j();y.value=E;const M=J();F.value=M}catch{C.value=0,h.value=0,y.value=0,F.value=0}}function j(){let t=0;return(i.deckCharacters||[]).forEach(e=>{if(!(!e||!e.name||e.name===""||e.name==="なし"))for(let l=1;l<=3;l++)e[`isM${l}Selected`]&&i.isMagicValidForRarity(e,l)&&(e.etc||"").split("<br>").map(u=>u.trim()).filter(u=>u.includes(`(M${l})`)).some(u=>u.includes("回避"))&&t++}),t}function J(){let t=0;const e=["ATKDOWN","火属性ダメージDOWN","水属性ダメージDOWN","木属性ダメージDOWN","無属性ダメージDOWN","ダメージDOWN","被ダメージDOWN"];return(i.deckCharacters||[]).forEach(l=>{if(!(!l||!l.name||l.name===""||l.name==="なし")){for(let g=1;g<=3;g++)if(l[`isM${g}Selected`]&&i.isMagicValidForRarity(l,g)){const U=(l.etc||"").split(",").map(u=>u.trim()).filter(u=>u.includes(`(M${g})`));for(const u of U)for(const W of e)if(u.includes(W)){if(W==="被ダメージDOWN"){if(u.includes("自")||u.includes("味方")){t++;break}}else if(u.includes("相手")){t++;break}}}}}),t}return(t,e)=>(oe(),se(ce,{class:"pa-2"},{default:s(()=>[a(v,{class:"ma-0"},{default:s(()=>[a(n,{cols:"12",class:"pa-0"},{default:s(()=>[a(v,{align:"center",class:"ma-0"},{default:s(()=>[a(n,{cols:"4",sm:"3",class:"pa-0 pr-1 text-right"},{default:s(()=>[o("span",ie,c(t.$t("deffence.difficulty")),1)]),_:1}),a(n,{cols:"8",sm:"9",class:"pa-0"},{default:s(()=>[a(ne,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=l=>f.value=l),items:I,"item-title":"text","item-value":"value","hide-details":"",dense:"",solo:""},null,8,["modelValue"])]),_:1})]),_:1}),a(v,{align:"center",class:"ma-0"},{default:s(()=>[a(n,{cols:"4",sm:"3",class:"pa-0 pr-1 text-right"},{default:s(()=>[o("span",re,c(t.$t("deffence.finishTurn")),1)]),_:1}),a(n,{cols:"8",sm:"9",class:"pa-0"},{default:s(()=>[a(b,{type:"number",modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=l=>r.value=l),class:"mt-0 pt-0","hide-details":"auto",dense:"",solo:"",min:1,max:5},null,8,["modelValue"])]),_:1})]),_:1}),a(v,{align:"center",class:"ma-0"},{default:s(()=>[a(n,{cols:"4",sm:"3",class:"pa-0 pr-1 text-right"},{default:s(()=>[o("span",fe,c(t.$t("deffence.totalAllyHP")),1)]),_:1}),a(n,{cols:"8",sm:"9",class:"pa-0"},{default:s(()=>[a(b,{type:"number",modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=l=>C.value=l),class:"mt-0 pt-0","hide-details":"auto",dense:"",solo:"",min:0},null,8,["modelValue"])]),_:1})]),_:1}),a(v,{align:"center",class:"ma-0"},{default:s(()=>[a(n,{cols:"4",sm:"3",class:"pa-0 pr-1 text-right"},{default:s(()=>[o("span",me,c(t.$t("deffence.remainAllyHP")),1)]),_:1}),a(n,{cols:"8",sm:"9",class:"pa-0"},{default:s(()=>[a(b,{type:"number",modelValue:A.value,"onUpdate:modelValue":e[3]||(e[3]=l=>A.value=l),class:"mt-0 pt-0","hide-details":"auto",dense:"",solo:"",min:0},null,8,["modelValue"])]),_:1})]),_:1}),a(v,{align:"center",class:"ma-0"},{default:s(()=>[a(n,{cols:"4",sm:"3",class:"pa-0 pr-1 text-right"},{default:s(()=>[o("span",ve,c(t.$t("deffence.totalDamageDealt")),1)]),_:1}),a(n,{cols:"8",sm:"9",class:"pa-0"},{default:s(()=>[a(b,{type:"number",modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=l=>h.value=l),class:"mt-0 pt-0","hide-details":"auto",dense:"",solo:"",min:0},null,8,["modelValue"])]),_:1})]),_:1}),a(v,{align:"center",class:"ma-0"},{default:s(()=>[a(n,{cols:"4",sm:"3",class:"pa-0 pr-1 text-right"},{default:s(()=>[o("span",pe,[R(c(t.$t("deffence.numberOfEvasion"))+" ",1),o("span",ge,[a(Y,{activator:"parent","open-on-click":""},{default:s(()=>[R(c(t.$t("deffence.countIf")),1)]),_:1})])])]),_:1}),a(n,{cols:"8",sm:"9",class:"pa-0"},{default:s(()=>[a(b,{type:"number",modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=l=>y.value=l),class:"mt-0 pt-0","hide-details":"auto",dense:"",solo:"",min:0},null,8,["modelValue"])]),_:1})]),_:1}),a(v,{align:"center",class:"ma-0"},{default:s(()=>[a(n,{cols:"4",sm:"3",class:"pa-0 pr-1 text-right"},{default:s(()=>[o("span",be,c(t.$t("deffence.numberOfDebuff")),1)]),_:1}),a(n,{cols:"8",sm:"9",class:"pa-0"},{default:s(()=>[a(b,{type:"number",modelValue:F.value,"onUpdate:modelValue":e[6]||(e[6]=l=>F.value=l),class:"mt-0 pt-0","hide-details":"auto",dense:"",solo:"",min:0},null,8,["modelValue"])]),_:1})]),_:1}),a(v,{class:"ma-0"},{default:s(()=>[a(n,{class:"pa-0"},{default:s(()=>[o("div",De,[a(ue,null,{default:s(()=>[o("thead",null,[o("tr",null,[e[9]||(e[9]=o("th",null,null,-1)),o("th",Ve,c(t.$t("deffence.advantageDamageTaken")),1),o("th",_e,c(t.$t("deffence.disadvantageDamageTaken")),1)])]),o("tbody",null,[o("tr",null,[o("th",Ce,c(t.$t("deffence.damageTaken")),1),o("td",he,[a(b,{type:"number",modelValue:_.value.advantageDamaged,"onUpdate:modelValue":e[7]||(e[7]=l=>_.value.advantageDamaged=l),"hide-details":"",dense:"",solo:""},null,8,["modelValue"])]),o("td",ye,[a(b,{type:"number",modelValue:_.value.disadvantageDamaged,"onUpdate:modelValue":e[8]||(e[8]=l=>_.value.disadvantageDamaged=l),"hide-details":"",dense:"",solo:""},null,8,["modelValue"])])])])]),_:1})])]),_:1})]),_:1}),a(Z,{data:G.value,scores:S.value,score:z.value},null,8,["data","scores","score"])]),_:1})]),_:1})]),_:1}))}}),Ne=de(Fe,[["__scopeId","data-v-46c2d0f0"]]);export{Ne as default};

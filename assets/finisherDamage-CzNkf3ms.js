import{b as ua,l as he,h as da,p as Le}from"./common-BFZPho2f.js";import{useHandCollectionStore as ma}from"./handCollection-BxRKC80Y.js";import{d as fa,i as va,s as ga,r as g,e as L,A as Ee,aR as Ca,q as Te,c as Z,w as u,j as C,g as c,a as l,C as ka,Y as J,G as ha,t as y,u as Ve,F as M,k as E,b8 as Ke,l as T,E as ce,b as V,o as d,b9 as Ie,v as B,_ as ya}from"./index-DbeK0aND.js";import{C as O}from"./CharacterIconWithType-wACO0Lus.js";import{r as ba}from"./calculations-gXkkWyKb.js";import{c as ee,V as Pe}from"./characters_info-BQcidtrm.js";import{V as Ae,a as Oe}from"./VCard-Cx0tD9hR.js";import{V as je}from"./VCardText-DJ_REu_0.js";import{V as re}from"./VSpacer-DAtp6ls_.js";import{V as pa}from"./VContainer-DsVf4WQp.js";const _a={key:0,class:"loading-container"},wa={class:"character-row"},Da={class:"damage-row"},Sa=["onClick"],Ma={class:"header-content"},Ua=["src","alt"],xa={class:"sort-icon"},La={key:0,class:"sort-indicator"},Ea={key:1,class:"sort-hint"},Ta={class:"character-row all-characters-row"},Va={class:"damage-row"},Ka={class:"damage-item all-characters-item"},Ia=["onClick"],Pa={class:"damage-row"},Aa={class:"damage-item"},Oa=["onClick"],ja={class:"damage-item-content"},Fa={class:"card-info"},za={key:0,class:"buddy-cards"},Ha={key:0,class:"buff-info"},Na={class:"buff-container"},$a={key:0,class:"buff-source"},Ra={class:"damage-value"},Ba={class:"pagination-controls"},Wa={class:"page-info"},qa={class:"damage-item-content"},Ga={class:"card-info"},Ya={key:0,class:"buddy-cards"},Qa={key:0,class:"buff-info"},Xa={class:"buff-container"},Za={key:0,class:"buff-source"},Ja={class:"damage-value"},et={class:"pagination-controls"},at={class:"page-info"},Fe=50,tt=10,it=fa({__name:"finisherDamage",setup(st){const{t:ue}=va(),ze=ua(),S=ma(),{characters:p}=ga(ze),h=g(!1),m=g(new Map),de=g({"--icon-size":`${Fe}px`,"--gap-size":`${tt}px`}),He={fire:"fire",water:"water",flora:"flora",cosmic:"cosmic"},me=g(!0),K=L(()=>{const e={};for(const[a,t]of m.value.entries())e[a]=t.iconSrc||t.imgSrc||"";return e});Ee(async()=>{try{const e=await he(p.value,"name"),a=await he(ee,"name_en","icon/"),t={},s=new Map(ee.map(i=>[i.name_ja,i.name_en]));p.value.forEach(i=>{const r=s.get(i.name);r&&a[r]&&(t[i.name]=a[r])});const n=await he(Object.values(He),i=>i,"icon/");m.value=da(p.value,e,t,n);const o=new Set(m.value.keys());ee.forEach(i=>{const r=a[i.name_en];r&&(i.name_ja&&!o.has(i.name_ja)&&m.value.set(i.name_ja,{type:"",wikiUrl:"",imgSrc:"",iconSrc:r}),i.name_en&&!o.has(i.name_en)&&m.value.set(i.name_en,{type:"",wikiUrl:"",imgSrc:"",iconSrc:r}))})}catch(e){console.error("Error in onMounted finisherDamage.vue:",e)}finally{me.value=!1}});const j={},Ne=["(極小)","(小)","(中)","(大)","(極大)"],$e=["ATKUP","ダメージUP","無属性ダメージUP","火属性ダメージUP","水属性ダメージUP","木属性ダメージUP","被ダメージUP"],Re={"ATKUP(極小)":.1,"ATKUP(小)":.2,"ATKUP(中)":.35,"ATKUP(大)":.5,"ATKUP(極大)":.8},I={},F={},z={},H={},N={},W={},q={},G={};function ye(){Object.keys(j).forEach(e=>{j[e]=[]}),p.value.forEach(e=>{if(h.value&&!S.getHandCard(e.name).isOwned)return;const a=e.etc.split(",");j[e.chara]||(j[e.chara]=[]),a.forEach(t=>{const s=t.trim();!s.includes("味方")&&!(s.includes("被ダメージUP")&&s.includes("相手"))||$e.forEach(n=>{s.startsWith(n)&&Ne.forEach(o=>{if(s.includes(o)){let i="";if(s.includes("(M1)")?i="M1":s.includes("(M2)")?i="M2":s.includes("(M3)")&&(i="M3"),i==="M3"){if(e.rare==="R"||e.rare==="SR")return;if(h.value){const r=S.getHandCard(e.name);if(r.isOwned&&!r.isM3)return}}j[e.chara].push({buff:n+o,name:e.name,buffSource:i})}})})})})}ye();function be(){p.value.forEach(e=>{if(e.rare!="SSR")return;let a,t=!0;if(h.value){const k=S.getHandCard(e.name);if(k.isOwned){const v=Number(k.level),D=k.isLimitBreak;a=ba(e,v,D)}else t=!1,a=0}else a=Number(e.originalMaxATK)||Number(e.max_atk)||Number(e.atk)||0;if(!t)return;const s=fe(e.buddy1s)+fe(e.buddy2s)+fe(e.buddy3s),n=Be(e),o=We(e);let i=0,r=0,f=0,_=0;function w(k,v,D,le){const xe=Re[v]||0,ca=a+a*s+a*n+a*xe;let b=0;const ra=k==="無"?1.1:1;if(v.includes(k+"属性ダメージUP")?(v.includes("(極小)")&&(b=.025),v.includes("(小)")&&(b=.06),v.includes("(中)")&&(b=.105),v.includes("(大)")&&(b=.15),v.includes("(極大)")&&(b=.27)):v.includes("ダメージUP")&&!v.includes("属性ダメージUP")&&(v.includes("(極小)")&&(b=.0225),v.includes("(小)")&&(b=.05),v.includes("(中)")&&(b=.0875),v.includes("(大)")&&(b=.125),v.includes("(極大)")&&(b=.225)),v!=""&&xe==0&&b==0)return;const U=Math.floor(ca*(ra+o+b)*2.4);N[e.name]||(N[e.name]=[],W[e.name]=[],q[e.name]=[],G[e.name]=[]);const x={無:{fire:1,water:1,flora:1,cosmic:1},火:{fire:1,water:.5,flora:1.5,cosmic:1},水:{fire:1.5,water:1,flora:.5,cosmic:1},木:{fire:.5,water:1.5,flora:1,cosmic:1}}[k]||{fire:1,water:1,flora:1,cosmic:1};i=Math.max(U*x.fire,i),r=Math.max(U*x.water,r),f=Math.max(U*x.flora,f),_=Math.max(U*x.cosmic,_),N[e.name].push({damage:U*x.fire,name:D,buffSource:le}),W[e.name].push({damage:U*x.water,name:D,buffSource:le}),q[e.name].push({damage:U*x.flora,name:D,buffSource:le}),G[e.name].push({damage:U*x.cosmic,name:D,buffSource:le})}w(e.magic2atr,"",ea(e.duo),""),j[e.duo].forEach(k=>{if(k.buffSource==="M3"){const v=p.value.find(D=>D.name===k.name);if(v&&(v.rare==="R"||v.rare==="SR"))return;if(h.value){const D=S.getHandCard(k.name);if(D.isOwned&&!D.isM3)return}}w(e.magic2atr,k.buff,k.name,k.buffSource)}),I[e.chara]||(I[e.chara]=0,F[e.chara]=0,z[e.chara]=0,H[e.chara]=0),I[e.chara]=Math.max(I[e.chara],i),F[e.chara]=Math.max(F[e.chara],r),z[e.chara]=Math.max(z[e.chara],f),H[e.chara]=Math.max(H[e.chara],_)})}be();function fe(e){return e.includes("ATK")&&e.includes("小")?.2:e.includes("ATK")&&e.includes("中")?.35:0}function Be(e){let a=e.rare==="SSR";if(h.value){const o=S.getHandCard(e.name);o.isOwned&&(a=o.isM3)}const t=Le(e,{allowM3:a}),s={極小:.1,小:.2,中:.35,大:.5,極大:.8};let n=0;return t.forEach(o=>{o.buffOption==="ATKUP"&&o.isSelf&&(o.durationTurns??0)>=2&&(n+=s[o.powerOption]||0)}),n}function We(e){let a=e.rare==="SSR";if(h.value){const o=S.getHandCard(e.name);o.isOwned&&(a=o.isM3)}const t=Le(e,{allowM3:a}),s={極小:.02,小:.05,中:.0875,大:.125,極大:.1875};let n=0;return t.forEach(o=>{o.buffOption==="ダメージUP"&&o.isSelf&&(o.durationTurns??0)>=2&&(n+=s[o.powerOption]||0)}),(e.etc||"").includes("被ダメージUP(中)(相手全体/2T)")&&(n+=.0875),n}const ae={};p.value.forEach(e=>{e.rare=="SSR"&&(ae[e.chara]||(ae[e.chara]=[]),ae[e.chara].push(e.name))});const te=g(!1),ve=g([]),qe=g(""),Ge=g(""),P=g(1),ie=g(10),Ye=L(()=>{const e=(P.value-1)*ie.value,a=e+ie.value;return Je.value.slice(e,a)}),pe=L(()=>Math.ceil(ve.value.length/ie.value));function Qe(e,a){const t=ge(a),s=ae[e];if(!s||s.length===0)return;const n=s.flatMap(o=>(t[o]||[]).map(r=>({...r,cardName:o})));ve.value=n,qe.value=e,Ge.value=a,P.value=1,te.value=!0}function ge(e){return{fire:N,water:W,flora:q,cosmic:G}[e]}const $=g(""),Y=g("desc");function Xe(e){$.value===e?Y.value=Y.value==="asc"?"desc":"asc":($.value=e,Y.value="desc")}const Ze=L(()=>{let e=[...ee];return $.value?e.sort((a,t)=>{const s=se(a.name_ja,$.value),n=se(t.name_ja,$.value),o=typeof s=="number"?s:0,i=typeof n=="number"?n:0;return Y.value==="asc"?o-i:i-o}):e});function se(e,a){var n;if(e==="全キャラ"){const o=ge(a);let i=0;return p.value.filter(r=>r.rare==="SSR").forEach(r=>{if(h.value&&!S.getHandCard(r.name).isOwned)return;const f=o[r.name]||[],_=Math.max(...f.map(w=>w.damage),0);i=Math.max(i,_)}),Math.floor(i)}if(h.value&&!p.value.filter(i=>i.rare==="SSR"&&i.chara===e).some(i=>S.getHandCard(i.name).isOwned))return"-";const s=(n={fire:I,water:F,flora:z,cosmic:H}[a])==null?void 0:n[e];return s?Math.floor(s):"-"}const Je=L(()=>[...ve.value].sort((e,a)=>a.damage-e.damage));function ea(e){const a=ee.find(t=>t.name_ja===e);return(a==null?void 0:a.name_en)||""}function R(e){if(!e)return;const a=m.value.get(e);a&&a.wikiUrl&&window.open(a.wikiUrl,"_blank")}const ne=g(!1),Ce=g([]),aa=g("fire"),A=g(1),oe=g(10),Q=g(0),X=g(0),_e=[1,1.0833,1.1666,1.25];function ke(){const t=window.innerHeight*.95-60,n=Math.max(1,Math.floor(t/80));ie.value=n,oe.value=n}Ee(()=>{ke(),window.addEventListener("resize",ke)}),Ca(()=>{window.removeEventListener("resize",ke)});const ta=L(()=>{const e=(A.value-1)*oe.value,a=e+oe.value;return sa.value.slice(e,a)}),we=L(()=>Math.ceil(Ce.value.length/oe.value));function ia(e){aa.value=e;const a=ge(e);Ce.value=p.value.filter(t=>t.rare==="SSR").flatMap(t=>(a[t.name]||[]).map(n=>({cardName:t.name,damage:n.damage,buffName:n.name||"",buffSource:n.buffSource||""}))),A.value=1,ne.value=!0}const sa=L(()=>[...Ce.value].sort((e,a)=>a.damage-e.damage));function De(e){const a=p.value.find(s=>s.name===e);if(!a)return[];const t=[];return a.buddy1c&&a.buddy1s.includes("ATK")&&m.value.get(a.buddy1c)&&t.push(a.buddy1c),a.buddy2c&&a.buddy2s.includes("ATK")&&m.value.get(a.buddy2c)&&t.push(a.buddy2c),a.buddy3c&&a.buddy3s.includes("ATK")&&m.value.get(a.buddy3c)&&t.push(a.buddy3c),t}function na(){h.value=!h.value}Te(()=>h.value,()=>{Ue()});function oa(){Q.value=(Q.value+1)%4}function la(){X.value=(X.value+1)%4}function Se(e){return{"background-color":["rgba(255, 235, 59, 0.1)","rgba(255, 235, 59, 0.3)","rgba(255, 235, 59, 0.6)","rgba(255, 235, 59, 0.9)"][e],color:"#999999","border-color":"#e0e0e0"}}function Me(e){return ue(`finisherDamage.${["normal","critical1","critical2","critical3"][e]}`)}Te(()=>S.handCollection,()=>{h.value&&Ue()},{deep:!0});function Ue(){me.value||(Object.keys(I).forEach(e=>delete I[e]),Object.keys(F).forEach(e=>delete F[e]),Object.keys(z).forEach(e=>delete z[e]),Object.keys(H).forEach(e=>delete H[e]),Object.keys(N).forEach(e=>delete N[e]),Object.keys(W).forEach(e=>delete W[e]),Object.keys(q).forEach(e=>delete q[e]),Object.keys(G).forEach(e=>delete G[e]),ye(),be())}return(e,a)=>(d(),Z(pa,{class:"finisher-container"},{default:u(()=>[me.value?(d(),C("div",_a,[c(ka,{indeterminate:"",color:"primary",size:64}),a[8]||(a[8]=l("p",{class:"loading-text"},"Loading...",-1))])):(d(),C(M,{key:1},[l("div",wa,[l("div",{class:"character-item",style:J({...de.value})},[l("div",{class:ha(["toggle-button",{active:h.value}]),onClick:na},y(h.value?Ve(ue)("finisherDamage.handCollection"):Ve(ue)("finisherDamage.allCards")),3)],4),l("div",Da,[(d(),C(M,null,E(["Fire","Water","Flora","Cosmic"],t=>{var s;return l("div",{key:t,class:"damage-col"},[l("div",{class:"damage-item clickable-header",onClick:n=>Xe(t.toLowerCase())},[l("div",Ma,[a[9]||(a[9]=l("span",{class:"vs-text"},"VS",-1)),l("img",{src:((s=m.value.get(t.toLowerCase()))==null?void 0:s.imgSrc)||"",alt:t,class:"element-icon"},null,8,Ua),l("span",xa,[$.value===t.toLowerCase()?(d(),C("span",La,y(Y.value==="asc"?"↑":"↓"),1)):(d(),C("span",Ea,"↕"))])])],8,Sa)])}),64))])]),l("div",Ta,[l("div",{class:"character-item",style:J({...de.value})},[...a[10]||(a[10]=[l("div",{class:"all-characters-label"},"ALL",-1)])],4),l("div",Va,[(d(),C(M,null,E(["Fire","Water","Flora","Cosmic"],t=>l("div",{key:t,class:"damage-col"},[l("div",Ka,[l("span",{class:"clickable-damage",onClick:s=>ia(t.toLowerCase())},y(se("全キャラ",t.toLowerCase())),9,Ia)])])),64))])]),(d(!0),C(M,null,E(Ze.value,t=>{var s;return d(),C("div",{key:t.name_en,class:"character-row"},[l("div",{class:"character-item",style:J({...de.value})},[c(O,{iconKey:t.name_ja,iconDictionary:K.value,wikiUrl:((s=m.value.get(t.name_ja))==null?void 0:s.wikiUrl)||"",iconSize:Fe},null,8,["iconKey","iconDictionary","wikiUrl"])],4),l("div",Pa,[(d(),C(M,null,E(["Fire","Water","Flora","Cosmic"],n=>l("div",{key:n,class:"damage-col"},[l("div",Aa,[l("span",{class:"clickable-damage",onClick:o=>Qe(t.name_ja,n.toLowerCase())},y(se(t.name_ja,n.toLowerCase())),9,Oa)])])),64))])])}),128))],64)),c(Pe,{modelValue:te.value,"onUpdate:modelValue":a[3]||(a[3]=t=>te.value=t),"max-width":"450"},{default:u(()=>[c(Ae,null,{default:u(()=>[c(je,{class:"modal-content"},{default:u(()=>[c(Ke,{class:"damage-list"},{default:u(()=>[(d(!0),C(M,null,E(Ye.value,(t,s)=>(d(),Z(Ie,{key:s,class:"damage-list-item"},{default:u(()=>{var n,o,i,r;return[l("div",ja,[l("div",Fa,[c(O,{iconKey:t.cardName||"",iconDictionary:K.value,wikiUrl:((n=m.value.get(t.cardName||""))==null?void 0:n.wikiUrl)||"",cardType:((o=m.value.get(t.cardName||""))==null?void 0:o.type)||"",iconSize:46,class:"card-icon clickable-icon",onClick:f=>R(t.cardName)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),t.cardName?(d(),C("div",za,[(d(!0),C(M,null,E(De(t.cardName),f=>{var _,w;return d(),Z(O,{key:f,iconKey:f,iconDictionary:K.value,wikiUrl:((_=m.value.get(f))==null?void 0:_.wikiUrl)||"",cardType:((w=m.value.get(f))==null?void 0:w.type)||"",iconSize:26,class:"buddy-icon clickable-icon",onClick:k=>R(f)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"])}),128))])):B("",!0)]),t.name?(d(),C("div",Ha,[l("div",Na,[c(O,{iconKey:t.name,iconDictionary:K.value,wikiUrl:((i=m.value.get(t.name))==null?void 0:i.wikiUrl)||"",cardType:((r=m.value.get(t.name))==null?void 0:r.type)||"",iconSize:46,class:"buff-icon clickable-icon",onClick:f=>R(t.name)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),t.buffSource?(d(),C("span",$a,y(t.buffSource),1)):B("",!0)])])):B("",!0),l("div",Ra,y(Math.floor(t.damage*_e[Q.value]).toLocaleString()),1)])]}),_:2},1024))),128))]),_:1})]),_:1}),c(Oe,null,{default:u(()=>[c(re),l("div",Ba,[c(T,{disabled:P.value===1,onClick:a[0]||(a[0]=t=>P.value--),variant:"text",size:"small",icon:""},{default:u(()=>[c(ce,null,{default:u(()=>[...a[11]||(a[11]=[V("mdi-chevron-left",-1)])]),_:1})]),_:1},8,["disabled"]),l("span",Wa,y(P.value)+" / "+y(pe.value),1),c(T,{disabled:P.value===pe.value,onClick:a[1]||(a[1]=t=>P.value++),variant:"text",size:"small",icon:""},{default:u(()=>[c(ce,null,{default:u(()=>[...a[12]||(a[12]=[V("mdi-chevron-right",-1)])]),_:1})]),_:1},8,["disabled"])]),c(re),c(T,{variant:"outlined",class:"critical-btn",style:J(Se(Q.value)),onClick:oa},{default:u(()=>[V(y(Me(Q.value)),1)]),_:1},8,["style"]),c(T,{color:"grey",variant:"outlined",class:"close-btn",onClick:a[2]||(a[2]=t=>te.value=!1)},{default:u(()=>[...a[13]||(a[13]=[V("CLOSE",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),c(Pe,{modelValue:ne.value,"onUpdate:modelValue":a[7]||(a[7]=t=>ne.value=t),"max-width":"450"},{default:u(()=>[c(Ae,null,{default:u(()=>[c(je,{class:"modal-content"},{default:u(()=>[c(Ke,{class:"damage-list"},{default:u(()=>[(d(!0),C(M,null,E(ta.value,(t,s)=>(d(),Z(Ie,{key:s,class:"damage-list-item"},{default:u(()=>{var n,o,i,r;return[l("div",qa,[l("div",Ga,[c(O,{iconKey:t.cardName,iconDictionary:K.value,wikiUrl:((n=m.value.get(t.cardName))==null?void 0:n.wikiUrl)||"",cardType:((o=m.value.get(t.cardName))==null?void 0:o.type)||"",iconSize:46,class:"card-icon clickable-icon",onClick:f=>R(t.cardName)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),t.cardName?(d(),C("div",Ya,[(d(!0),C(M,null,E(De(t.cardName),f=>{var _,w;return d(),Z(O,{key:f,iconKey:f,iconDictionary:K.value,wikiUrl:((_=m.value.get(f))==null?void 0:_.wikiUrl)||"",cardType:((w=m.value.get(f))==null?void 0:w.type)||"",iconSize:26,class:"buddy-icon clickable-icon",onClick:k=>R(f)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"])}),128))])):B("",!0)]),t.buffName?(d(),C("div",Qa,[l("div",Xa,[c(O,{iconKey:t.buffName,iconDictionary:K.value,wikiUrl:((i=m.value.get(t.buffName))==null?void 0:i.wikiUrl)||"",cardType:((r=m.value.get(t.buffName))==null?void 0:r.type)||"",iconSize:46,class:"buff-icon clickable-icon",onClick:f=>R(t.buffName)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),t.buffSource?(d(),C("span",Za,y(t.buffSource),1)):B("",!0)])])):B("",!0),l("div",Ja,y(Math.floor(t.damage*_e[X.value]).toLocaleString()),1)])]}),_:2},1024))),128))]),_:1})]),_:1}),c(Oe,null,{default:u(()=>[c(re),l("div",et,[c(T,{disabled:A.value===1,onClick:a[4]||(a[4]=t=>A.value--),variant:"text",size:"small",icon:""},{default:u(()=>[c(ce,null,{default:u(()=>[...a[14]||(a[14]=[V("mdi-chevron-left",-1)])]),_:1})]),_:1},8,["disabled"]),l("span",at,y(A.value)+" / "+y(we.value),1),c(T,{disabled:A.value===we.value,onClick:a[5]||(a[5]=t=>A.value++),variant:"text",size:"small",icon:""},{default:u(()=>[c(ce,null,{default:u(()=>[...a[15]||(a[15]=[V("mdi-chevron-right",-1)])]),_:1})]),_:1},8,["disabled"])]),c(re),c(T,{variant:"outlined",class:"critical-btn",style:J(Se(X.value)),onClick:la},{default:u(()=>[V(y(Me(X.value)),1)]),_:1},8,["style"]),c(T,{color:"grey",variant:"outlined",class:"close-btn",onClick:a[6]||(a[6]=t=>ne.value=!1)},{default:u(()=>[...a[16]||(a[16]=[V("CLOSE",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),Ct=ya(it,[["__scopeId","data-v-8f865026"]]);export{Ct as default};

import{u as ye}from"./characters-23c2a1a6.js";import{as as ie,y as Y}from"./index-dccdd962.js";const Pe=ie("searchSettings",{state:()=>({minEHP:3e4,minHP:3e4,minHPBuddy:0,minEvasion:0,minDuo:0,minBuff:0,minDebuff:0,minCosmic:0,minFire:0,minWater:0,minFlora:0,minReferenceDamage:0,minReferenceAdvantageDamage:0,minReferenceVsHiDamage:0,minReferenceVsMizuDamage:0,minReferenceVsKiDamage:0,maxResult:10,attackNum:10,sortOptions:[{prop:"HP",order:"降順"}],allowSameCharacter:!0}),actions:{updateSearchSettings(t){Object.assign(this,t)}}}),Re=ie("searchResult",{state:()=>({totalResults:0,nowResults:0,results:[],isSearching:!1,errorMessage:""})}),be=Pe(),{minEHP:he,minHP:Ae,minDebuff:we,minBuff:Be,minHPBuddy:Se,minEvasion:Me,minDuo:Ke,minCosmic:Te,minFire:Ue,minWater:Ce,minFlora:Ve,minReferenceDamage:Fe,minReferenceAdvantageDamage:Le,minReferenceVsHiDamage:qe,minReferenceVsKiDamage:ze,minReferenceVsMizuDamage:Ee,maxResult:ae,sortOptions:Oe,allowSameCharacter:We,attackNum:z}=Y(be),_e=ye(),{characters:ne}=Y(_e),je=Re(),{totalResults:W,nowResults:re,results:k,isSearching:se,errorMessage:I}=Y(je);function Ye(t){(t.key==="e"||t.key==="+")&&t.preventDefault()}function Ne(t){return[t("comments.HP"),t("comments.effectiveHP"),t("comments.HPBuddy"),t("comments.noHPBuddy"),t("comments.buddy"),t("comments.evasion"),t("comments.duo"),t("comments.buff"),t("comments.debuff"),t("comments.maxCosmic"),t("comments.maxFire"),t("comments.maxWater"),t("comments.maxFlora"),t("comments.neutralDamage"),t("comments.advantageDamage"),t("comments.damageAgainstFire"),t("comments.damageAgainstWater"),t("comments.damageAgainstFlora")]}const $e=["hp","ehp","hpBuudy","noHpBuddy","buddy","evasion","duo","buff","debuff","maxCosmic","maxFire","maxWater","maxFlora","referenceDamage","referenceAdvantageDamage","referenceVsHiDamage","referenceVsMizuDamage","referenceVsKiDamage"],j={"HPUP(小)":{hp:.2,atk:0,heal:0,conHeal:0},"HP&ATKUP(小)":{hp:.2,atk:.2,heal:0,conHeal:0},"HPUP(中)":{hp:.3,atk:0,heal:0,conHeal:0},"HP&ATKUP(中)":{hp:.3,atk:.35,heal:0,conHeal:0},"ATKUP(小)":{hp:0,atk:.2,heal:0,conHeal:0},"ATKUP(中)":{hp:0,atk:.35,heal:0,conHeal:0},"回復(小)":{hp:0,atk:0,heal:1.1,conHeal:0},"回復&継続回復(小)":{hp:0,atk:0,heal:1.1,conHeal:.15*3},"回復(中)":{hp:0,atk:0,heal:1.7,conHeal:0},"回復&継続回復(中)":{hp:0,atk:0,heal:1.7,conHeal:.25*3},"継続回復(小)":{hp:0,atk:0,heal:0,conHeal:.15*3},"継続回復(中)":{hp:0,atk:0,heal:0,conHeal:.25*3}};function x(t){var r;return((r=j[t])==null?void 0:r.hp)||0}function Z(t){var r;return((r=j[t])==null?void 0:r.atk)||0}function G(t){var r;return((r=j[t])==null?void 0:r.heal)||0}function J(t){var r;return((r=j[t])==null?void 0:r.conHeal)||0}const Ie={"ATKUP(極小)":1.1,"ATKUP(小)":1.2,"ATKUP(中)":1.35,"ATKUP(大)":1.5,"ATKUP(極大)":1.8},xe={"ダメUP(極小)":.025,"ダメUP(小)":.05,"ダメUP(中)":.0875,"ダメUP(大)":.125,"ダメUP(極大)":.1875,"属性ダメUP(極小)":.03,"属性ダメUP(小)":.06,"属性ダメUP(中)":.1005,"属性ダメUP(大)":.15,"属性ダメUP(極大)":.27},Q={};function Ze(t,r,u,c){const s=`${t},${r},${u},${c}`;if(s in Q)return Q[s];let d=r.includes("弱")?.75:1;d*=u==="無"?1.1:1,d+=xe[t]||0;let f=1;r.includes("連撃")?f=1.8:r.includes("デュオ")&&(f=2.4);const M=c*d*f;return Q[s]=M,M}function X(t,r,u,c,s){return c=(Ie[t]||1)*c+c*s,Ze(t,r,u=="無"?"無":"無以外",c)}function E(t,r,u){const c=[t,r,u];return c.sort((s,d)=>d-s),[c[0],c[1]]}function Ge(t){const r=new Set;for(const e of t)r.add(e.chara);let u=0,c=0,s=0,d=0,f=0,M=0,P=0,B=0,b=0,l=0,F=0,a=0,i=0;const m=[],v=[],p=[],D=[],H=[];let o=0,h=0,S=0,L=0,q=0;const R={},N={},y={},ee=[];let te="";t.sort((e,n)=>n.calcBaseATK-e.calcBaseATK),t.forEach((e,n)=>{R[n]=!1,N[n]=!1,y[n]=!1});function O(e,n){let A=0;return e.magic1atr==n&&(A+=1),e.magic2atr==n&&(A+=1),e.magic3atr==n&&e.hasM3&&(A+=1),Math.min(A,2)}if(t.forEach((e,n)=>{ee.push(e.imgUrl),te+="&name"+(n+1)+"="+e.name,u+=e.calcBaseHP,P+=e.buff_count,B+=e.debuff_count,l+=O(e,"無"),F+=O(e,"火"),a+=O(e,"水"),i+=O(e,"木");let A=!1,K=0;if(r.has(e.buddy1c)){f+=1;const g=x(e.buddy1s);K+=Z(e.buddy1s),g!=0&&(d+=1,A=!0,u+=e.calcBaseHP*g)}if(r.has(e.buddy2c)){f+=1;const g=x(e.buddy2s);K+=Z(e.buddy2s),g!=0&&(d+=1,A=!0,u+=e.calcBaseHP*g)}if(r.has(e.buddy3c)){f+=1;const g=x(e.buddy3s);K+=Z(e.buddy3s),g!=0&&(d+=1,A=!0,u+=e.calcBaseHP*g)}c+=(G(e.magic1heal)+G(e.magic2heal)+(e.hasM3?G(e.magic3heal):0))*e.calcBaseATK,c+=(J(e.magic1heal)+J(e.magic2heal)+(e.hasM3?J(e.magic3heal):0))*e.calcBaseHP,s+=e.evasion,A||(M+=1);let $=e.magic2pow;if(y[n])$="デュオ",b+=1;else{if(!y[n]){for(const[g,V]of t.entries())if(V.duo==e.chara&&e.duo==V.chara&&!y[n]&&!y[g]){y[n]=!0,y[g]=!0,R[n]=!0,R[g]=!0;break}if(!R[n]){for(const[g,V]of t.entries())if(e.duo==V.chara&&!y[n]&&!R[n]&&!N[g]){y[n]=!0,R[n]=!0,N[g]=!0;break}}if(!R[n]){for(const[g,V]of t.entries())if(e.duo==V.chara&&!y[n]&&!R[n]&&!R[g]){y[n]=!0,R[n]=!0,R[g]=!0;break}}}y[n]&&($="デュオ",b+=1)}const T=X(e.magic1buf,e.magic1pow,e.magic1atr,e.calcBaseATK,K),U=X(e.magic2buf,$,e.magic2atr,e.calcBaseATK,K),C=e.hasM3?X(e.magic3buf,e.magic3pow,e.magic3atr,e.calcBaseATK,K):0,ce=e.magic1atr=="無"?T:T*1.5,ue=e.magic2atr=="無"?U:U*1.5,le=e.magic3atr=="無"?C:C*1.5,me=w(e.magic1atr,"火",T),fe=w(e.magic2atr,"火",U),ge=w(e.magic3atr,"火",C),de=w(e.magic1atr,"水",T),ve=w(e.magic2atr,"水",U),pe=w(e.magic3atr,"水",C),De=w(e.magic1atr,"木",T),ke=w(e.magic2atr,"木",U),He=w(e.magic3atr,"木",C);m.push(...E(T,U,C)),v.push(...E(ce,ue,le)),p.push(...E(me,fe,ge)),D.push(...E(de,ve,pe)),H.push(...E(De,ke,He))}),o=m.sort((e,n)=>n-e).slice(0,z.value).reduce((e,n)=>e+n,0),h=v.sort((e,n)=>n-e).slice(0,z.value).reduce((e,n)=>e+n,0),S=p.sort((e,n)=>n-e).slice(0,z.value).reduce((e,n)=>e+n,0),L=D.sort((e,n)=>n-e).slice(0,z.value).reduce((e,n)=>e+n,0),q=H.sort((e,n)=>n-e).slice(0,z.value).reduce((e,n)=>e+n,0),!(u<Ae.value)&&!(u+c<he.value)&&!(d<Se.value)&&!(s<Me.value)&&!(b<Ke.value)&&!(P<Be.value)&&!(B<we.value)&&!(l<Te.value)&&!(F<Ue.value)&&!(a<Ce.value)&&!(i<Ve.value)&&!(o<Fe.value)&&!(h<Le.value)&&!(S<qe.value)&&!(L<Ee.value)&&!(q<ze.value))return o=Math.floor(o),h=Math.floor(h),S=Math.floor(S),L=Math.floor(L),q=Math.floor(q),[u,u+c,s,d,f,M,b,P,B,l,F,a,i,o,h,S,L,q,...ee,te]}const Je={水:{火:1.5,木:.5},木:{水:1.5,火:.5},火:{木:1.5,水:.5}};function w(t,r,u){var s;const c=(s=Je[t])==null?void 0:s[r];return c?u*c:u}function oe(t){return function(r,u){for(let c=0;c<t.length;c++){const{key:s,order:d}=t[c];if(!Object.prototype.hasOwnProperty.call(r,s)||!Object.prototype.hasOwnProperty.call(u,s))continue;let f=0;if(r[s]<u[s]?f=-1:r[s]>u[s]&&(f=1),f!==0)return d==="降順"?f*-1:f}return 0}}function _(t){return t<=0?1:t*_(t-1)}async function et(t){for(const a of ne.value)if(a.required&&a.level==0){I.value=t("error.requiredCharacter");return}const r=ne.value.filter(a=>a.level>0),u=r.length;if(u<5){I.value=t("error.fewCharacter");return}re.value=0;const c=Ne(t),s=[];for(const a of Oe.value)for(let i=0;i<c.length;i++)if(c[i]==a.prop){let m="降順";switch(a.order){case"ASC":m="昇順";break;case"DESC":m="降順";break;case"昇順":case"降順":m=a.order;break;default:continue}s.push({key:$e[i],order:m})}const d=s[0].order==="昇順";async function f(){k.value.sort(oe(s));const a=k.value.slice(0,ae.value);k.value=[...a],k.value.length>0&&(B=k.value[k.value.length-1][s[0].key]),await new Promise(requestAnimationFrame)}const M=new Set(["referenceDamage","referenceAdvantageDamage","referenceVsHiDamage","referenceVsMizuDamage","referenceVsKiDamage"]);s[0].key in M?r.sort((a,i)=>a.required&&!i.required?-1:!a.required&&i.required?1:i.atk-a.atk):r.sort((a,i)=>a.required&&!i.required?-1:!a.required&&i.required?1:i.hp-a.hp);const P=r.filter(a=>a.required).length;if(P>5){I.value="必須設定されたキャラが多すぎます";return}k.value=[],r.forEach(a=>{let i=110;a.rare=="SR"?i=90:a.rare=="R"&&(i=70);const m=a.level/i;a.calcBaseHP=(a.hp-a.base_hp)*m+a.base_hp,a.calcBaseATK=(a.atk-a.base_atk)*m+a.base_atk});let B=s[0].order==="昇順"?1/0:-1/0;const b=async(a,i,m,v,p)=>new Promise(D=>{const H=[r[a],r[i],r[m],r[v],r[p]],o=Ge(H);if(o){const h={hp:Math.round(o[0]),ehp:Math.round(o[1]),evasion:o[2],hpBuudy:o[3],buddy:o[4],noHpBuddy:o[5],duo:o[6],buff:o[7],debuff:o[8],maxCosmic:o[9],maxFire:o[10],maxWater:o[11],maxFlora:o[12],referenceDamage:o[13],referenceAdvantageDamage:o[14],referenceVsHiDamage:o[15],referenceVsMizuDamage:o[16],referenceVsKiDamage:o[17],chara1:o[18],chara2:o[19],chara3:o[20],chara4:o[21],chara5:o[22],simuURL:o[23]},S=h[s[0].key];(d&&S<B||!d&&S>B)&&k.value.push(h)}re.value+=1,D()}),l=new Array(5).fill(u);for(let a=0;a<P;a++)l[a]=a+1;if(We.value){let a=Date.now();const i=l[0]*(l[1]-1)*(l[2]-2)*(l[3]-3);if(W.value=i*(l[4]-4)/_(5-P)+i*4/_(4-P),P==5){W.value=1,await b(0,1,2,3,4),await new Promise(requestAnimationFrame);return}for(let m=0;m<l[0];m++)for(let v=m+1;v<l[1];v++)for(let p=v+1;p<l[2];p++){if(!se.value)return;for(let D=p+1;D<l[3];D++){for(let H=D+1;H<l[4];H++)await b(m,v,p,D,H),Date.now()-a>2e3&&(a=Date.now(),await f());for(const H of[m,v,p,D])await b(m,v,p,D,H),Date.now()-a>2e3&&(a=Date.now(),await f())}}}else{const a=l[0]*(l[1]-1)*(l[2]-2)*(l[3]-3);if(W.value=a*(l[4]-4)/_(5-P),P==5){W.value=1,await b(0,1,2,3,4),await new Promise(requestAnimationFrame);return}let i=Date.now();for(let m=0;m<l[0];m++)for(let v=m+1;v<l[1];v++)for(let p=v+1;p<l[2];p++){if(!se.value)return;for(let D=p+1;D<l[3];D++)for(let H=D+1;H<l[4];H++)await b(m,v,p,D,H),Date.now()-i>2e3&&(i=Date.now(),await f())}}k.value.sort(oe(s));const F=k.value.slice(0,ae.value);k.value=[...F],k.value.length>0&&(B=k.value[k.value.length-1][s[0].key])}export{Re as a,et as b,Ye as c,Ne as g,Pe as u};

import{b as fe,j as me,l as pe}from"./common-k5-t06hf.js";import{ar as be,r as d,d as ye,i as Se,ah as ee,e as P,I as he,H as ge,a3 as _e,j as i,af as le,a as f,g as b,l as k,w as M,b as C,t as R,u as y,F as S,k as h,o,ax as te,_ as ke}from"./index-CUt03JYE.js";import{c as G}from"./characters_info-Dy-PgYIg.js";import ae from"./default-C4N0O_oT.js";import{V as W}from"./VCheckbox-ej3F6sII.js";const Me=be("filterd",()=>{const g=d([]),E=d([]),u=d(!0),$=d([]),A=d([]),B=d([]);return{tempSelectedCharacters:g,tempSelectedRare:E,isFirst:u,tempSelectedType:$,tempSelectedAttr:A,tempSelectedEffects:B}}),Ce={class:"feature-select-all-container"},Re={class:"feature-items"},we={class:"display-block"},Ve={class:"character-list-wrapper"},We={class:"character-select-all-container"},Ee={class:"character-items"},$e=["onClick"],Ae=["src","alt"],Be={class:"feature-select-all-container"},Fe={class:"feature-items"},Ue={key:0,class:"button-container"},Te={key:1,class:"button-container embedded-buttons"},se=50,ne=10,ze=ye({__name:"FilterModal",props:{embedded:{type:Boolean,default:!1}},emits:["close","filter-applied"],setup(g,{emit:E}){const{t:u}=Se(),$=fe(),{characters:A}=ee($),B=Me(),{tempSelectedCharacters:F,tempSelectedRare:U,tempSelectedType:T,tempSelectedAttr:z,tempSelectedEffects:O,isFirst:j}=ee(B),n=d([]),v=d([]),m=d([]),r=d([]),c=d([]),I=E,L=d(0),H=d({}),K=g,ue=d({"--icon-size":`${se}px`,"--gap-size":`${ne}px`}),q=["SSR","SR","R"],J=P(()=>[{name:u("filterModal.balance"),value:"バランス"},{name:u("filterModal.defence"),value:"ディフェンス"},{name:u("filterModal.attack"),value:"アタック"}]),Q=P(()=>[{name:u("filterModal.fire"),value:"火"},{name:u("filterModal.water"),value:"水"},{name:u("filterModal.flora"),value:"木"},{name:u("filterModal.cosmic"),value:"無"}]),w=P(()=>me.map(e=>({name:u(`filterModal.${e.name}`),value:e.value}))),_=G.reduce((e,t)=>{const l=t.dorm;return e[l]||(e[l]=[]),e[l].push(t),e},{}),X=()=>{const e=document.querySelector(".display-block");e&&(L.value=e.clientWidth)},Y=()=>{X()};he(async()=>{j.value?(n.value=Object.values(_).flat().map(e=>e.name_en),v.value=["SSR","SR","R"],m.value=["バランス","ディフェンス","アタック"],r.value=["火","水","木","無"],c.value=["ATKUP","ダメージUP","クリティカル","属性ダメージUP","被ダメージUP","ATKDOWN","ダメージDOWN","回避","属性ダメージDOWN","被ダメージDOWN","HP回復","HP継続回復","暗闇無効","呪い無効","凍結無効","デバフ解除","呪い"]):(F.value.length>0&&(n.value=[...F.value]),U.value.length>0&&(v.value=[...U.value]),T.value.length>0&&(m.value=[...T.value]),z.value.length>0&&(r.value=[...z.value]),O.value.length>0&&(c.value=[...O.value])),j.value=!1,X(),window.addEventListener("resize",Y),H.value=await pe(G,"name_en","icon/"),K.embedded&&ge([n,v,m,r,c],()=>{Z()},{deep:!0})}),_e(()=>{window.removeEventListener("resize",Y)});function ie(){F.value=[...n.value],U.value=[...v.value],T.value=[...m.value],z.value=[...r.value],O.value=[...c.value],Z(),I("filter-applied"),K.embedded||I("close")}function Z(){A.value.forEach(e=>{if(!v.value.includes(e.rare)){e.visible=!1;return}const t=G.find(l=>l.name_ja===e.chara||l.name_en===e.chara);if(!t||!n.value.includes(t.name_en)){e.visible=!1;return}if(!m.value.includes(e.attr)){e.visible=!1;return}if(!r.value.includes(e.magic1atr)&&!r.value.includes(e.magic2atr)&&!r.value.includes(e.magic3atr)){e.visible=!1;return}if(c.value.length===17)e.visible=!0;else if(c.value.length===0){e.visible=!1;return}else if(c.value.some(a=>e.etc.includes(a)))e.visible=!0;else{e.visible=!1;return}})}function oe(e){const t=e.target;t.src=ae}function x(e){if(e==="statusEffects")w.value.every(l=>c.value.includes(l.value))?c.value=[]:c.value=w.value.map(l=>l.value);else if(e==="cardAttributes"){const t=["SSR","SR","R"].every(s=>v.value.includes(s)),l=["バランス","ディフェンス","アタック"].every(s=>m.value.includes(s)),a=["火","水","木","無"].every(s=>r.value.includes(s));t&&l&&a?(v.value=[],m.value=[],r.value=[]):(v.value=["SSR","SR","R"],m.value=["バランス","ディフェンス","アタック"],r.value=["火","水","木","無"])}else{const t=_[e]||[];t.every(a=>n.value.includes(a.name_en))?n.value=n.value.filter(a=>!t.some(s=>s.name_en===a)):n.value=[...new Set([...n.value,...t.map(a=>a.name_en)])]}}function D(e){return e==="cardAttributes"?q.every(l=>v.value.includes(l))&&J.value.every(l=>m.value.includes(l.value))&&Q.value.every(l=>r.value.includes(l.value)):e==="statusEffects"?w.value.every(l=>c.value.includes(l.value)):_[e].every(l=>n.value.includes(l.name_en))}function de(e){n.value=n.value.includes(e)?n.value.filter(t=>t!==e):[...n.value,e]}const re=e=>64+(se+10+ne)*e.length+10,ce=e=>({width:e===1?"100%":"50%"}),ve=()=>{const e=[];let t=[],l=0;const a=L.value,s=2;return Object.entries(_).forEach(([p,N])=>{const V=re(N);V>=a/s?(t.length>0&&(e.push(t),t=[],l=0),e.push([p])):l+V<=a&&t.length<s?(t.push(p),l+=V):(e.push(t),t=[p],l=V)}),t.length>0&&e.push(t),e};return(e,t)=>(o(),i("div",{class:le(["modal-background",{embedded:g.embedded}]),ref:"modalContainer"},[f("div",Ce,[b(k,{small:"",onClick:t[0]||(t[0]=l=>x("cardAttributes"))},{default:M(()=>[C(R(D("cardAttributes")?y(u)("filterModal.release"):y(u)("filterModal.select")),1)]),_:1}),f("div",Re,[(o(),i(S,null,h(q,(l,a)=>f("div",{class:"feature-item",key:`rare-${a}`},[b(W,{modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=s=>v.value=s),value:l,label:l,"hide-details":""},null,8,["modelValue","value","label"])])),64)),(o(!0),i(S,null,h(J.value,(l,a)=>(o(),i("div",{class:"feature-item",key:`type-${a}`},[b(W,{modelValue:m.value,"onUpdate:modelValue":t[2]||(t[2]=s=>m.value=s),value:l.value,label:l.name,"hide-details":""},null,8,["modelValue","value","label"])]))),128)),(o(!0),i(S,null,h(Q.value,(l,a)=>(o(),i("div",{class:"feature-item",key:`attr-${a}`},[b(W,{modelValue:r.value,"onUpdate:modelValue":t[3]||(t[3]=s=>r.value=s),value:l.value,label:l.name,"hide-details":""},null,8,["modelValue","value","label"])]))),128))])]),t[7]||(t[7]=f("hr",{class:"rare-divider"},null,-1)),f("div",we,[f("div",Ve,[(o(!0),i(S,null,h(ve(),(l,a)=>(o(),i("div",{key:a,class:"row"},[(o(!0),i(S,null,h(l,s=>(o(),i("div",{key:s,style:te(ce(l.length)),class:"character-list"},[f("div",We,[b(k,{small:"",onClick:p=>x(s)},{default:M(()=>[C(R(D(s)?y(u)("filterModal.release"):y(u)("filterModal.select")),1)]),_:2},1032,["onClick"]),f("div",Ee,[(o(!0),i(S,null,h(y(_)[s],p=>(o(),i("div",{key:p.name_en,class:le(["character-item",{selected:n.value.includes(p.name_en)}]),onClick:N=>de(p.name_en),style:te({...ue.value,opacity:n.value.includes(p.name_en)?1:.5})},[f("img",{src:H.value[p.name_en]||y(ae),alt:p.name_en,class:"character-image",onError:oe},null,40,Ae)],14,$e))),128))])])],4))),128))]))),128))])]),t[8]||(t[8]=f("hr",{class:"rare-divider"},null,-1)),f("div",Be,[b(k,{small:"",onClick:t[4]||(t[4]=l=>x("statusEffects"))},{default:M(()=>[C(R(D("statusEffects")?y(u)("filterModal.release"):y(u)("filterModal.select")),1)]),_:1}),f("div",Fe,[(o(!0),i(S,null,h(w.value,l=>(o(),i("div",{key:l.name,class:"feature-item"},[b(W,{modelValue:c.value,"onUpdate:modelValue":t[5]||(t[5]=a=>c.value=a),value:l.value,label:l.name,"hide-details":""},null,8,["modelValue","value","label"])]))),128))])]),g.embedded?(o(),i("div",Te)):(o(),i("div",Ue,[b(k,{class:"button",onClick:t[6]||(t[6]=l=>e.$emit("close"))},{default:M(()=>[C(R(e.$t("filterModal.cancel")),1)]),_:1}),b(k,{class:"button apply-button",disabled:n.value.length===0||v.value.length===0,onClick:ie},{default:M(()=>[C(R(e.$t("filterModal.submit")),1)]),_:1},8,["disabled"])]))],2))}}),je=ke(ze,[["__scopeId","data-v-5bd6b597"]]);export{je as F};

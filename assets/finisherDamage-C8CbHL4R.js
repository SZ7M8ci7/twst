import{b as ia,l as ve,h as ta}from"./common-8aAC14ZD.js";import{u as sa}from"./handCollection-DDaizdnv.js";import{d as na,i as oa,s as la,r as k,e as T,A as De,aL as ca,q as Ue,c as X,w as m,j as g,g as l,a as n,C as ra,U as ge,G as ua,t as y,u as Se,F as U,k as x,b1 as Me,l as $,E as ne,b as R,o as r,b2 as Te,v as B,_ as da}from"./index-B69tNdl3.js";import{C as A}from"./CharacterIconWithType-CTbAPiuO.js";import{r as ma}from"./calculations-GAXqlHSM.js";import{c as Y,V as xe}from"./characters_info-ByaEpiUQ.js";import{V as Le,a as Ee}from"./VCard-wszH3RI4.js";import{V as Pe}from"./VCardText-CgyXDJpq.js";import{V as oe}from"./VSpacer-D3Rla50t.js";import{V as fa}from"./VContainer-CWm1ObX7.js";const va={key:0,class:"loading-container"},ga={class:"character-row"},ka={class:"damage-row"},ha=["onClick"],_a={class:"header-content"},Ca=["src","alt"],ya={class:"sort-icon"},ba={key:0,class:"sort-indicator"},pa={key:1,class:"sort-hint"},wa={class:"character-row all-characters-row"},Da={class:"damage-row"},Ua={class:"damage-item all-characters-item"},Sa=["onClick"],Ma={class:"damage-row"},Ta={class:"damage-item"},xa=["onClick"],La={class:"damage-item-content"},Ea={class:"card-info"},Pa={key:0,class:"buddy-cards"},Ka={key:0,class:"buff-info"},Va={class:"buff-container"},Aa={key:0,class:"buff-source"},Ia={class:"damage-value"},ja={class:"pagination-controls"},Oa={class:"page-info"},za={class:"damage-item-content"},Na={class:"card-info"},Fa={key:0,class:"buddy-cards"},Ha={key:0,class:"buff-info"},$a={class:"buff-container"},Ra={key:0,class:"buff-source"},Ba={class:"damage-value"},Wa={class:"pagination-controls"},qa={class:"page-info"},Ke=50,Ga=10,Qa=na({__name:"finisherDamage",setup(Xa){const{t:ke}=oa(),Ve=ia(),L=sa(),{characters:b}=la(Ve),_=k(!1),u=k(new Map),le=k({"--icon-size":`${Ke}px`,"--gap-size":`${Ga}px`}),Ae={fire:"fire",water:"water",flora:"flora",cosmic:"cosmic"},ce=k(!0),E=T(()=>{const e={};for(const[a,i]of u.value.entries())e[a]=i.iconSrc||i.imgSrc||"";return e});De(async()=>{try{const e=await ve(b.value,"name"),a=await ve(Y,"name_en","icon/"),i={},s=new Map(Y.map(t=>[t.name_ja,t.name_en]));b.value.forEach(t=>{const c=s.get(t.name);c&&a[c]&&(i[t.name]=a[c])});const o=await ve(Object.values(Ae),t=>t,"icon/");u.value=ta(b.value,e,i,o);const d=new Set(u.value.keys());Y.forEach(t=>{const c=a[t.name_en];c&&(t.name_ja&&!d.has(t.name_ja)&&u.value.set(t.name_ja,{type:"",wikiUrl:"",imgSrc:"",iconSrc:c}),t.name_en&&!d.has(t.name_en)&&u.value.set(t.name_en,{type:"",wikiUrl:"",imgSrc:"",iconSrc:c}))})}catch(e){console.error("Error in onMounted finisherDamage.vue:",e)}finally{ce.value=!1}});const I={},Ie=["(極小)","(小)","(中)","(大)","(極大)"],je=["ATKUP","ダメージUP","無属性ダメージUP","火属性ダメージUP","水属性ダメージUP","木属性ダメージUP","被ダメージUP"],Oe={"ATKUP(極小)":.1,"ATKUP(小)":.2,"ATKUP(中)":.35,"ATKUP(大)":.5,"ATKUP(極大)":.8},P={},j={},O={},z={},N={},W={},q={},G={};function he(){Object.keys(I).forEach(e=>{I[e]=[]}),b.value.forEach(e=>{if(_.value&&!L.getHandCard(e.name).isOwned)return;const a=e.etc.split(",");I[e.chara]||(I[e.chara]=[]),a.forEach(i=>{const s=i.trim();!s.includes("味方")&&!(s.includes("被ダメージUP")&&s.includes("相手"))||je.forEach(o=>{s.startsWith(o)&&Ie.forEach(d=>{if(s.includes(d)){let t="";if(s.includes("(M1)")?t="M1":s.includes("(M2)")?t="M2":s.includes("(M3)")&&(t="M3"),t==="M3"){if(e.rare==="R"||e.rare==="SR")return;if(_.value){const c=L.getHandCard(e.name);if(c.isOwned&&!c.isM3)return}}I[e.chara].push({buff:o+d,name:e.name,buffSource:t})}})})})})}he();function _e(){b.value.forEach(e=>{if(e.rare!="SSR")return;let a,i=!0;if(_.value){const h=L.getHandCard(e.name);if(h.isOwned){const v=Number(h.level),D=h.isLimitBreak;a=ma(e,v,D)}else i=!1,a=0}else a=Number(e.originalMaxATK)||Number(e.max_atk)||Number(e.atk)||0;if(!i)return;const s=re(e.buddy1s)+re(e.buddy2s)+re(e.buddy3s),o=ze(e.etc),d=Ne(e.etc);let t=0,c=0,f=0,p=0;function w(h,v,D,se){const we=Oe[v]||0,ea=a+a*s+a*o+a*we;let C=0;const aa=h==="無"?1.1:1;if(v.includes(h+"属性ダメージUP")?(v.includes("(極小)")&&(C=.025),v.includes("(小)")&&(C=.06),v.includes("(中)")&&(C=.105),v.includes("(大)")&&(C=.15),v.includes("(極大)")&&(C=.27)):v.includes("ダメージUP")&&!v.includes("属性ダメージUP")&&(v.includes("(極小)")&&(C=.0225),v.includes("(小)")&&(C=.05),v.includes("(中)")&&(C=.0875),v.includes("(大)")&&(C=.125),v.includes("(極大)")&&(C=.225)),v!=""&&we==0&&C==0)return;const S=Math.floor(ea*(aa+d+C)*2.4);N[e.name]||(N[e.name]=[],W[e.name]=[],q[e.name]=[],G[e.name]=[]);const M={無:{fire:1,water:1,flora:1,cosmic:1},火:{fire:1,water:.5,flora:1.5,cosmic:1},水:{fire:1.5,water:1,flora:.5,cosmic:1},木:{fire:.5,water:1.5,flora:1,cosmic:1}}[h]||{fire:1,water:1,flora:1,cosmic:1};t=Math.max(S*M.fire,t),c=Math.max(S*M.water,c),f=Math.max(S*M.flora,f),p=Math.max(S*M.cosmic,p),N[e.name].push({damage:S*M.fire,name:D,buffSource:se}),W[e.name].push({damage:S*M.water,name:D,buffSource:se}),q[e.name].push({damage:S*M.flora,name:D,buffSource:se}),G[e.name].push({damage:S*M.cosmic,name:D,buffSource:se})}w(e.magic2atr,"",Ge(e.duo),""),I[e.duo].forEach(h=>{if(h.buffSource==="M3"){const v=b.value.find(D=>D.name===h.name);if(v&&(v.rare==="R"||v.rare==="SR"))return;if(_.value){const D=L.getHandCard(h.name);if(D.isOwned&&!D.isM3)return}}w(e.magic2atr,h.buff,h.name,h.buffSource)}),P[e.chara]||(P[e.chara]=0,j[e.chara]=0,O[e.chara]=0,z[e.chara]=0),P[e.chara]=Math.max(P[e.chara],t),j[e.chara]=Math.max(j[e.chara],c),O[e.chara]=Math.max(O[e.chara],f),z[e.chara]=Math.max(z[e.chara],p)})}_e();function re(e){return e.includes("ATK")&&e.includes("小")?.2:e.includes("ATK")&&e.includes("中")?.35:0}function ze(e){return e.includes("ATKUP(極小)(自/3T)")?.1:e.includes("ATKUP(小)(自/3T)")?.2:e.includes("ATKUP(中)(自/3T)")?.35:e.includes("ATKUP(大)(自/3T)")?.5:0}function Ne(e){return e.includes("ダメージUP(極小)(自/3T)")?.02:e.includes("ダメージUP(小)(自/3T)")?.05:e.includes("ダメージUP(中)(自/3T)")?.0875:e.includes("ダメージUP(大)(自/3T)")?.125:e.includes("被ダメージUP(中)(相手全体/2T)")?.0875:0}const Z={};b.value.forEach(e=>{e.rare=="SSR"&&(Z[e.chara]||(Z[e.chara]=[]),Z[e.chara].push(e.name))});const J=k(!1),ue=k([]),Fe=k(""),He=k(""),K=k(1),ee=k(10),$e=T(()=>{const e=(K.value-1)*ee.value,a=e+ee.value;return qe.value.slice(e,a)}),Ce=T(()=>Math.ceil(ue.value.length/ee.value));function Re(e,a){const i=de(a),s=Z[e];if(!s||s.length===0)return;const o=s.flatMap(d=>(i[d]||[]).map(c=>({...c,cardName:d})));ue.value=o,Fe.value=e,He.value=a,K.value=1,J.value=!0}function de(e){return{fire:N,water:W,flora:q,cosmic:G}[e]}const F=k(""),Q=k("desc");function Be(e){F.value===e?Q.value=Q.value==="asc"?"desc":"asc":(F.value=e,Q.value="desc")}const We=T(()=>{let e=[...Y];return F.value?e.sort((a,i)=>{const s=ae(a.name_ja,F.value),o=ae(i.name_ja,F.value),d=typeof s=="number"?s:0,t=typeof o=="number"?o:0;return Q.value==="asc"?d-t:t-d}):e});function ae(e,a){var o;if(e==="全キャラ"){const d=de(a);let t=0;return b.value.filter(c=>c.rare==="SSR").forEach(c=>{if(_.value&&!L.getHandCard(c.name).isOwned)return;const f=d[c.name]||[],p=Math.max(...f.map(w=>w.damage),0);t=Math.max(t,p)}),Math.floor(t)}if(_.value&&!b.value.filter(t=>t.rare==="SSR"&&t.chara===e).some(t=>L.getHandCard(t.name).isOwned))return"-";const s=(o={fire:P,water:j,flora:O,cosmic:z}[a])==null?void 0:o[e];return s?Math.floor(s):"-"}const qe=T(()=>[...ue.value].sort((e,a)=>a.damage-e.damage));function Ge(e){const a=Y.find(i=>i.name_ja===e);return(a==null?void 0:a.name_en)||""}function H(e){if(!e)return;const a=u.value.get(e);a&&a.wikiUrl&&window.open(a.wikiUrl,"_blank")}const ie=k(!1),me=k([]),Qe=k("fire"),V=k(1),te=k(10);function fe(){const i=window.innerHeight*.95-60,o=Math.max(1,Math.floor(i/80));ee.value=o,te.value=o}De(()=>{fe(),window.addEventListener("resize",fe)}),ca(()=>{window.removeEventListener("resize",fe)});const Xe=T(()=>{const e=(V.value-1)*te.value,a=e+te.value;return Ze.value.slice(e,a)}),ye=T(()=>Math.ceil(me.value.length/te.value));function Ye(e){Qe.value=e;const a=de(e);me.value=b.value.filter(i=>i.rare==="SSR").flatMap(i=>(a[i.name]||[]).map(o=>({cardName:i.name,damage:o.damage,buffName:o.name||"",buffSource:o.buffSource||""}))),V.value=1,ie.value=!0}const Ze=T(()=>[...me.value].sort((e,a)=>a.damage-e.damage));function be(e){const a=b.value.find(s=>s.name===e);if(!a)return[];const i=[];return a.buddy1c&&a.buddy1s.includes("ATK")&&u.value.get(a.buddy1c)&&i.push(a.buddy1c),a.buddy2c&&a.buddy2s.includes("ATK")&&u.value.get(a.buddy2c)&&i.push(a.buddy2c),a.buddy3c&&a.buddy3s.includes("ATK")&&u.value.get(a.buddy3c)&&i.push(a.buddy3c),i}function Je(){_.value=!_.value}Ue(()=>_.value,()=>{pe()}),Ue(()=>L.handCollection,()=>{_.value&&pe()},{deep:!0});function pe(){ce.value||(Object.keys(P).forEach(e=>delete P[e]),Object.keys(j).forEach(e=>delete j[e]),Object.keys(O).forEach(e=>delete O[e]),Object.keys(z).forEach(e=>delete z[e]),Object.keys(N).forEach(e=>delete N[e]),Object.keys(W).forEach(e=>delete W[e]),Object.keys(q).forEach(e=>delete q[e]),Object.keys(G).forEach(e=>delete G[e]),he(),_e())}return(e,a)=>(r(),X(fa,{class:"finisher-container"},{default:m(()=>[ce.value?(r(),g("div",va,[l(ra,{indeterminate:"",color:"primary",size:64}),a[8]||(a[8]=n("p",{class:"loading-text"},"Loading...",-1))])):(r(),g(U,{key:1},[n("div",ga,[n("div",{class:"character-item",style:ge({...le.value})},[n("div",{class:ua(["toggle-button",{active:_.value}]),onClick:Je},y(_.value?Se(ke)("finisherDamage.handCollection"):Se(ke)("finisherDamage.allCards")),3)],4),n("div",ka,[(r(),g(U,null,x(["Fire","Water","Flora","Cosmic"],i=>{var s;return n("div",{key:i,class:"damage-col"},[n("div",{class:"damage-item clickable-header",onClick:o=>Be(i.toLowerCase())},[n("div",_a,[a[9]||(a[9]=n("span",{class:"vs-text"},"VS",-1)),n("img",{src:((s=u.value.get(i.toLowerCase()))==null?void 0:s.imgSrc)||"",alt:i,class:"element-icon"},null,8,Ca),n("span",ya,[F.value===i.toLowerCase()?(r(),g("span",ba,y(Q.value==="asc"?"↑":"↓"),1)):(r(),g("span",pa,"↕"))])])],8,ha)])}),64))])]),n("div",wa,[n("div",{class:"character-item",style:ge({...le.value})},a[10]||(a[10]=[n("div",{class:"all-characters-label"},"ALL",-1)]),4),n("div",Da,[(r(),g(U,null,x(["Fire","Water","Flora","Cosmic"],i=>n("div",{key:i,class:"damage-col"},[n("div",Ua,[n("span",{class:"clickable-damage",onClick:s=>Ye(i.toLowerCase())},y(ae("全キャラ",i.toLowerCase())),9,Sa)])])),64))])]),(r(!0),g(U,null,x(We.value,i=>{var s;return r(),g("div",{key:i.name_en,class:"character-row"},[n("div",{class:"character-item",style:ge({...le.value})},[l(A,{iconKey:i.name_ja,iconDictionary:E.value,wikiUrl:((s=u.value.get(i.name_ja))==null?void 0:s.wikiUrl)||"",iconSize:Ke},null,8,["iconKey","iconDictionary","wikiUrl"])],4),n("div",Ma,[(r(),g(U,null,x(["Fire","Water","Flora","Cosmic"],o=>n("div",{key:o,class:"damage-col"},[n("div",Ta,[n("span",{class:"clickable-damage",onClick:d=>Re(i.name_ja,o.toLowerCase())},y(ae(i.name_ja,o.toLowerCase())),9,xa)])])),64))])])}),128))],64)),l(xe,{modelValue:J.value,"onUpdate:modelValue":a[3]||(a[3]=i=>J.value=i),"max-width":"450"},{default:m(()=>[l(Le,null,{default:m(()=>[l(Pe,{class:"modal-content"},{default:m(()=>[l(Me,{class:"damage-list"},{default:m(()=>[(r(!0),g(U,null,x($e.value,(i,s)=>(r(),X(Te,{key:s,class:"damage-list-item"},{default:m(()=>{var o,d,t,c;return[n("div",La,[n("div",Ea,[l(A,{iconKey:i.cardName||"",iconDictionary:E.value,wikiUrl:((o=u.value.get(i.cardName||""))==null?void 0:o.wikiUrl)||"",cardType:((d=u.value.get(i.cardName||""))==null?void 0:d.type)||"",iconSize:46,class:"card-icon clickable-icon",onClick:f=>H(i.cardName)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),i.cardName?(r(),g("div",Pa,[(r(!0),g(U,null,x(be(i.cardName),f=>{var p,w;return r(),X(A,{key:f,iconKey:f,iconDictionary:E.value,wikiUrl:((p=u.value.get(f))==null?void 0:p.wikiUrl)||"",cardType:((w=u.value.get(f))==null?void 0:w.type)||"",iconSize:26,class:"buddy-icon clickable-icon",onClick:h=>H(f)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"])}),128))])):B("",!0)]),i.name?(r(),g("div",Ka,[n("div",Va,[l(A,{iconKey:i.name,iconDictionary:E.value,wikiUrl:((t=u.value.get(i.name))==null?void 0:t.wikiUrl)||"",cardType:((c=u.value.get(i.name))==null?void 0:c.type)||"",iconSize:46,class:"buff-icon clickable-icon",onClick:f=>H(i.name)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),i.buffSource?(r(),g("span",Aa,y(i.buffSource),1)):B("",!0)])])):B("",!0),n("div",Ia,y(Math.floor(i.damage).toLocaleString()),1)])]}),_:2},1024))),128))]),_:1})]),_:1}),l(Ee,null,{default:m(()=>[l(oe),n("div",ja,[l($,{disabled:K.value===1,onClick:a[0]||(a[0]=i=>K.value--),variant:"text",size:"small",icon:""},{default:m(()=>[l(ne,null,{default:m(()=>a[11]||(a[11]=[R("mdi-chevron-left")])),_:1,__:[11]})]),_:1},8,["disabled"]),n("span",Oa,y(K.value)+" / "+y(Ce.value),1),l($,{disabled:K.value===Ce.value,onClick:a[1]||(a[1]=i=>K.value++),variant:"text",size:"small",icon:""},{default:m(()=>[l(ne,null,{default:m(()=>a[12]||(a[12]=[R("mdi-chevron-right")])),_:1,__:[12]})]),_:1},8,["disabled"])]),l(oe),l($,{color:"grey",variant:"outlined",class:"close-btn",onClick:a[2]||(a[2]=i=>J.value=!1)},{default:m(()=>a[13]||(a[13]=[R("CLOSE")])),_:1,__:[13]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(xe,{modelValue:ie.value,"onUpdate:modelValue":a[7]||(a[7]=i=>ie.value=i),"max-width":"450"},{default:m(()=>[l(Le,null,{default:m(()=>[l(Pe,{class:"modal-content"},{default:m(()=>[l(Me,{class:"damage-list"},{default:m(()=>[(r(!0),g(U,null,x(Xe.value,(i,s)=>(r(),X(Te,{key:s,class:"damage-list-item"},{default:m(()=>{var o,d,t,c;return[n("div",za,[n("div",Na,[l(A,{iconKey:i.cardName,iconDictionary:E.value,wikiUrl:((o=u.value.get(i.cardName))==null?void 0:o.wikiUrl)||"",cardType:((d=u.value.get(i.cardName))==null?void 0:d.type)||"",iconSize:46,class:"card-icon clickable-icon",onClick:f=>H(i.cardName)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),i.cardName?(r(),g("div",Fa,[(r(!0),g(U,null,x(be(i.cardName),f=>{var p,w;return r(),X(A,{key:f,iconKey:f,iconDictionary:E.value,wikiUrl:((p=u.value.get(f))==null?void 0:p.wikiUrl)||"",cardType:((w=u.value.get(f))==null?void 0:w.type)||"",iconSize:26,class:"buddy-icon clickable-icon",onClick:h=>H(f)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"])}),128))])):B("",!0)]),i.buffName?(r(),g("div",Ha,[n("div",$a,[l(A,{iconKey:i.buffName,iconDictionary:E.value,wikiUrl:((t=u.value.get(i.buffName))==null?void 0:t.wikiUrl)||"",cardType:((c=u.value.get(i.buffName))==null?void 0:c.type)||"",iconSize:46,class:"buff-icon clickable-icon",onClick:f=>H(i.buffName)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),i.buffSource?(r(),g("span",Ra,y(i.buffSource),1)):B("",!0)])])):B("",!0),n("div",Ba,y(Math.floor(i.damage).toLocaleString()),1)])]}),_:2},1024))),128))]),_:1})]),_:1}),l(Ee,null,{default:m(()=>[l(oe),n("div",Wa,[l($,{disabled:V.value===1,onClick:a[4]||(a[4]=i=>V.value--),variant:"text",size:"small",icon:""},{default:m(()=>[l(ne,null,{default:m(()=>a[14]||(a[14]=[R("mdi-chevron-left")])),_:1,__:[14]})]),_:1},8,["disabled"]),n("span",qa,y(V.value)+" / "+y(ye.value),1),l($,{disabled:V.value===ye.value,onClick:a[5]||(a[5]=i=>V.value++),variant:"text",size:"small",icon:""},{default:m(()=>[l(ne,null,{default:m(()=>a[15]||(a[15]=[R("mdi-chevron-right")])),_:1,__:[15]})]),_:1},8,["disabled"])]),l(oe),l($,{color:"grey",variant:"outlined",class:"close-btn",onClick:a[6]||(a[6]=i=>ie.value=!1)},{default:m(()=>a[16]||(a[16]=[R("CLOSE")])),_:1,__:[16]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),ci=da(Qa,[["__scopeId","data-v-5d5fcc3d"]]);export{ci as default};

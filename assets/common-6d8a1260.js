import{u as T}from"./characters-0daef11c.js";import{aA as D,y as H}from"./index-8bead2a6.js";const L=D("searchSettings",{state:()=>({minEHP:6e4,minHP:5e4,minHPBuddy:0,minEvasion:0,maxResult:10,sortOptions:[{prop:"実質HP",order:"降順"}],allowSameCharacter:!0}),actions:{updateSearchSettings(t){Object.assign(this,t)}}}),A=D("searchResult",{state:()=>({totalResults:0,nowResults:0,results:[],isSearching:!1,errorMessage:""})}),C=L(),{minEHP:O,minHP:j,minHPBuddy:E,minEvasion:M,maxResult:y,sortOptions:U,allowSameCharacter:x}=H(C),_=T(),{characters:q}=H(_),F=A(),{totalResults:R,nowResults:S,results:o,isSearching:b,errorMessage:K}=H(F);function G(t){(t.key==="e"||t.key==="+")&&t.preventDefault()}const B=["実質HP","実HP","HPバディ数","HPバディが存在しないキャラ数","バディ数","回避数"],N=["ehp","hp","hpBuudy","noHpBuddy","buddy","evasion"];function g(t){return t=="HPUP(小)"||t=="HP&ATKUP(小)"?.2:t=="HPUP(中)"||t=="HP&ATKUP(中)"?.3:0}function k(t){return t=="回復(小)"||t=="回復&継続回復(小)"?1.1:t=="回復(中)"||t=="回復&継続回復(中)"?1.7:0}function w(t){return t=="継続回復(小)"||t=="回復&継続回復(小)"?.15*3:t=="継続回復(中)"||t=="回復&継続回復(中)"?.25*3:0}function I(t){const a=new Set;for(const e of t)a.add(e.chara);let r=0,s=0,d=0,v=0,n=0,i=0;const c=[];for(const e of t){c.push(e.imgUrl);let f=110;e.rare=="SR"?f=90:e.rare=="R"&&(f=70);const h=e.level/f,u=(e.hp-e.base_hp)*h+e.base_hp,l=(e.atk-e.base_atk)*h+e.base_atk;r+=u;let m=!1;if(a.has(e.buddy1c)){n+=1;const p=g(e.buddy1s);p!=0&&(v+=1,m=!0,r+=u*p)}if(a.has(e.buddy2c)){n+=1;const p=g(e.buddy2s);p!=0&&(v+=1,m=!0,r+=u*p)}if(a.has(e.buddy3c)){n+=1;const p=g(e.buddy3s);p!=0&&(v+=1,m=!0,r+=u*p)}s+=k(e.magic1heal)*l,s+=k(e.magic2heal)*l,s+=k(e.magic3heal)*l,s+=w(e.magic1heal)*u,s+=w(e.magic2heal)*u,s+=w(e.magic3heal)*u,d+=e.evasion,m||(i+=1)}if(!(r<j.value)&&!(r+s<O.value)&&!(v<E.value)&&!(d<M.value))return c.sort(),[r,r+s,d,v,n,i,...c]}function P(t){return function(a,r){for(let s=0;s<t.length;s++){const{key:d,order:v}=t[s];if(!Object.prototype.hasOwnProperty.call(a,d)||!Object.prototype.hasOwnProperty.call(r,d))continue;let n=0;if(a[d]<r[d]?n=-1:a[d]>r[d]&&(n=1),n!==0)return v==="降順"?n*-1:n}return 0}}async function J(){const t=q.value.filter(n=>n.level>0),a=t.length;if(a<5){K.value="レベル設定されたキャラが少なすぎます";return}S.value=0;const r=[];for(const n of U.value)for(let i=0;i<B.length;i++)B[i]==n.prop&&r.push({key:N[i],order:n.order});t.sort((n,i)=>i.hp-n.hp),o.value=[];let s=r[0].order==="昇順"?1/0:-1/0;const d=async(n,i,c,e,f)=>new Promise(h=>{const u=[t[n],t[i],t[c],t[e],t[f]],l=I(u);if(l){const m={hp:Math.round(l[0]),ehp:Math.round(l[1]),evasion:l[2],hpBuudy:l[3],buddy:l[4],noHpBuddy:l[5],chara1:l[6],chara2:l[7],chara3:l[8],chara4:l[9],chara5:l[10]};(r[0].order==="昇順"&&m[r[0].key]<s||r[0].order==="降順"&&m[r[0].key]>s)&&o.value.push(m)}S.value+=1,h()});if(x.value){const n=a*(a-1)*(a-2)*(a-3);R.value=n*(a-4)/120+n*4/24;let i=Date.now();for(let c=0;c<a;c++)for(let e=c+1;e<a;e++)for(let f=e+1;f<a;f++)for(let h=f+1;h<a;h++){for(let u=h+1;u<a;u++){if(!b.value)return;if(await d(c,e,f,h,u),Date.now()-i>500){i=Date.now(),o.value.sort(P(r));const l=o.value.slice(0,y.value);o.value=[...l],o.value.length>0&&(s=o.value[o.value.length-1][r[0].key]),await new Promise(requestAnimationFrame)}}for(const u of[c,e,f,h])if(await d(c,e,f,h,u),Date.now()-i>500){i=Date.now(),o.value.sort(P(r));const l=o.value.slice(0,y.value);o.value=[...l],o.value.length>0&&(s=o.value[o.value.length-1][r[0].key]),await new Promise(requestAnimationFrame)}}}else{const n=a*(a-1)*(a-2)*(a-3);R.value=n*(a-4)/120;let i=Date.now();for(let c=0;c<a;c++)for(let e=c+1;e<a;e++)for(let f=e+1;f<a;f++)for(let h=f+1;h<a;h++)for(let u=h+1;u<a;u++){if(!b.value)return;if(await d(c,e,f,h,u),Date.now()-i>1e3){i=Date.now(),o.value.sort(P(r));const l=o.value.slice(0,y.value);o.value=[...l],o.value.length>0&&(s=o.value[o.value.length-1][r[0].key]),await new Promise(requestAnimationFrame)}}}o.value.sort(P(r));const v=o.value.slice(0,y.value);o.value=[...v],o.value.length>0&&(s=o.value[o.value.length-1][r[0].key])}export{B as a,A as b,G as c,J as d,L as u};

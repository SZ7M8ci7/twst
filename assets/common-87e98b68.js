import{u as L}from"./characters-084a17de.js";import{aB as A,y as b}from"./index-cab4b842.js";const C=A("searchSettings",{state:()=>({minEHP:6e4,minHP:5e4,minHPBuddy:0,minEvasion:0,maxResult:10,sortOptions:[{prop:"実質HP",order:"降順"}],allowSameCharacter:!0}),actions:{updateSearchSettings(t){Object.assign(this,t)}}}),O=A("searchResult",{state:()=>({totalResults:0,nowResults:0,results:[],isSearching:!1,errorMessage:""})}),j=C(),{minEHP:E,minHP:F,minHPBuddy:M,minEvasion:U,maxResult:P,sortOptions:x,allowSameCharacter:_}=b(j),K=L(),{characters:N}=b(K),I=O(),{totalResults:w,nowResults:B,results:l,isSearching:q,errorMessage:D}=b(I);function Q(t){(t.key==="e"||t.key==="+")&&t.preventDefault()}const T=["実質HP","実HP","HPバディ数","HPバディが存在しないキャラ数","バディ数","回避数"],z=["ehp","hp","hpBuudy","noHpBuddy","buddy","evasion"];function H(t){return t=="HPUP(小)"||t=="HP&ATKUP(小)"?.2:t=="HPUP(中)"||t=="HP&ATKUP(中)"?.3:0}function R(t){return t=="回復(小)"||t=="回復&継続回復(小)"?1.1:t=="回復(中)"||t=="回復&継続回復(中)"?1.7:0}function S(t){return t=="継続回復(小)"||t=="回復&継続回復(小)"?.15*3:t=="継続回復(中)"||t=="回復&継続回復(中)"?.25*3:0}function Z(t){const m=new Set;for(const e of t)m.add(e.chara);let o=0,s=0,u=0,v=0,a=0,p=0;const r=[];for(const e of t){r.push(e.imgUrl);let c=110;e.rare=="SR"?c=90:e.rare=="R"&&(c=70);const h=e.level/c,i=(e.hp-e.base_hp)*h+e.base_hp,f=(e.atk-e.base_atk)*h+e.base_atk;o+=i;let d=!1;if(m.has(e.buddy1c)){a+=1;const n=H(e.buddy1s);n!=0&&(v+=1,d=!0,o+=i*n)}if(m.has(e.buddy2c)){a+=1;const n=H(e.buddy2s);n!=0&&(v+=1,d=!0,o+=i*n)}if(m.has(e.buddy3c)){a+=1;const n=H(e.buddy3s);n!=0&&(v+=1,d=!0,o+=i*n)}s+=R(e.magic1heal)*f,s+=R(e.magic2heal)*f,s+=R(e.magic3heal)*f,s+=S(e.magic1heal)*i,s+=S(e.magic2heal)*i,s+=S(e.magic3heal)*i,u+=e.evasion,d||(p+=1)}if(!(o<F.value)&&!(o+s<E.value)&&!(v<M.value)&&!(u<U.value))return r.sort(),[o,o+s,u,v,a,p,...r]}function g(t){return function(m,o){for(let s=0;s<t.length;s++){const{key:u,order:v}=t[s];if(!Object.prototype.hasOwnProperty.call(m,u)||!Object.prototype.hasOwnProperty.call(o,u))continue;let a=0;if(m[u]<o[u]?a=-1:m[u]>o[u]&&(a=1),a!==0)return v==="降順"?a*-1:a}return 0}}function k(t){return t<=0?1:t*k(t-1)}async function V(){const t=N.value.filter(r=>r.level>0),m=t.length;if(m<5){D.value="レベル設定されたキャラが少なすぎます";return}B.value=0;const o=[];for(const r of x.value)for(let e=0;e<T.length;e++)T[e]==r.prop&&o.push({key:z[e],order:r.order});t.sort((r,e)=>r.required&&!e.required?-1:!r.required&&e.required?1:r.hp-e.hp);const s=t.filter(r=>r.required).length;if(s>5){D.value="必須設定されたキャラが多すぎます";return}l.value=[];let u=o[0].order==="昇順"?1/0:-1/0;const v=async(r,e,c,h,i)=>new Promise(f=>{const d=[t[r],t[e],t[c],t[h],t[i]],n=Z(d);if(n){const y={hp:Math.round(n[0]),ehp:Math.round(n[1]),evasion:n[2],hpBuudy:n[3],buddy:n[4],noHpBuddy:n[5],chara1:n[6],chara2:n[7],chara3:n[8],chara4:n[9],chara5:n[10]};(o[0].order==="昇順"&&y[o[0].key]<u||o[0].order==="降順"&&y[o[0].key]>u)&&l.value.push(y)}B.value+=1,f()}),a=new Array(5).fill(m);for(let r=0;r<s;r++)a[r]=r+1;if(_.value){let r=Date.now();const e=a[0]*(a[1]-1)*(a[2]-2)*(a[3]-3);if(w.value=e*(a[4]-4)/k(5-s)+e*4/k(4-s),s==5){w.value=1,await v(0,1,2,3,4),await new Promise(requestAnimationFrame);return}for(let c=0;c<a[0];c++)for(let h=c+1;h<a[1];h++)for(let i=h+1;i<a[2];i++)for(let f=i+1;f<a[3];f++){for(let d=f+1;d<a[4];d++){if(!q.value)return;if(await v(c,h,i,f,d),Date.now()-r>500){r=Date.now(),l.value.sort(g(o));const n=l.value.slice(0,P.value);l.value=[...n],l.value.length>0&&(u=l.value[l.value.length-1][o[0].key]),await new Promise(requestAnimationFrame)}}for(const d of[c,h,i,f])if(await v(c,h,i,f,d),Date.now()-r>500){r=Date.now(),l.value.sort(g(o));const n=l.value.slice(0,P.value);l.value=[...n],l.value.length>0&&(u=l.value[l.value.length-1][o[0].key]),await new Promise(requestAnimationFrame)}}}else{const r=a[0]*(a[1]-1)*(a[2]-2)*(a[3]-3);if(w.value=r*(a[4]-4)/k(5-s),s==5){w.value=1,await v(0,1,2,3,4),await new Promise(requestAnimationFrame);return}let e=Date.now();for(let c=0;c<a[0];c++)for(let h=c+1;h<a[1];h++)for(let i=h+1;i<a[2];i++)for(let f=i+1;f<a[3];f++)for(let d=f+1;d<a[4];d++){if(!q.value)return;if(await v(c,h,i,f,d),Date.now()-e>1e3){e=Date.now(),l.value.sort(g(o));const n=l.value.slice(0,P.value);l.value=[...n],l.value.length>0&&(u=l.value[l.value.length-1][o[0].key]),await new Promise(requestAnimationFrame)}}}l.value.sort(g(o));const p=l.value.slice(0,P.value);l.value=[...p],l.value.length>0&&(u=l.value[l.value.length-1][o[0].key])}export{T as a,O as b,Q as c,V as d,C as u};

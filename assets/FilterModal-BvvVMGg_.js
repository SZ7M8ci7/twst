import{b as Re,l as Fe,j as We}from"./common-DGOYwjgm.js";import{ad as Ee,r as f,d as Oe,i as Ve,a1 as ve,a7 as Be,a2 as Te,bc as Ue,g as S,j as i,ab as fe,a as h,f as b,l as F,w as W,b as E,t as B,u as w,F as O,k as V,o as c,ao as me,_ as $e}from"./index-Fx1xxxob.js";import{c as Y}from"./characters_info-I5J3qtE4.js";import Pe from"./default-pkSoNB1x.js";import{V as j}from"./VCheckbox-CdsmgZuB.js";let H=null,I=!1,Z=null,ee=!1;function De(){return I&&H?H:null}function ze(s){H=s,I=!0}function xe(){return ee&&Z?Z:null}function Ge(s){Z=s,ee=!0}const je=Ee("filterd",()=>{const s=De(),k=xe(),u=f((s==null?void 0:s.selectedCharacters)||[]),T=f((s==null?void 0:s.selectedRare)||[]),U=f((s==null?void 0:s.selectedType)||[]),y=f((s==null?void 0:s.selectedAttr)||[]),g=f((s==null?void 0:s.selectedEffects)||[]),C=f(!s),_=f((k==null?void 0:k.sortBy)||"default"),M=f((k==null?void 0:k.sortOrder)||"asc");function A(){const o={selectedCharacters:u.value,selectedRare:T.value,selectedType:U.value,selectedAttr:y.value,selectedEffects:g.value};ze(o)}function z(){const o={sortBy:_.value,sortOrder:M.value};Ge(o)}function n(){u.value=[],T.value=[],U.value=[],y.value=[],g.value=[],C.value=!0,H=null,I=!1}function d(){I=!0}function m(){ee=!0}return{tempSelectedCharacters:u,tempSelectedRare:T,isFirst:C,tempSelectedType:U,tempSelectedAttr:y,tempSelectedEffects:g,sortBy:_,sortOrder:M,saveCurrentState:A,saveCurrentSortState:z,resetFilterState:n,markFilterAsModified:d,markSortAsModified:m}}),He={class:"feature-select-all-container"},Ie={class:"feature-items"},Le={class:"display-block"},Ke={class:"character-global-select-container"},Ne={class:"character-list-wrapper"},qe={class:"character-select-all-container"},Je={class:"character-items"},Qe=["onClick"],Xe=["src","alt"],Ye={class:"feature-select-all-container"},Ze={class:"feature-items"},el={key:0,class:"button-container"},ll={key:1,class:"button-container embedded-buttons"},pe=50,he=10,tl=Oe({__name:"FilterModal",props:{embedded:{type:Boolean,default:!1}},emits:["close","filter-applied"],setup(s,{emit:k}){const{t:u}=Ve(),T=Re(),{characters:U}=ve(T),y=je(),{tempSelectedCharacters:g,tempSelectedRare:C,tempSelectedType:_,tempSelectedAttr:M,tempSelectedEffects:A,isFirst:z}=ve(y),n=f([]),d=f([]),m=f([]),o=f([]),v=f([]),le=k,te=f(0),L=f({}),ae=s,se=["SSR","SR","R"],ne=S(()=>[{name:u("filterModal.balance"),value:"バランス"},{name:u("filterModal.defence"),value:"ディフェンス"},{name:u("filterModal.attack"),value:"アタック"}]),ue=S(()=>[{name:u("filterModal.fire"),value:"火"},{name:u("filterModal.water"),value:"水"},{name:u("filterModal.flora"),value:"木"},{name:u("filterModal.cosmic"),value:"無"}]),x=S(()=>We.map(e=>({name:u(`filterModal.${e.name}`),value:e.value}))),Se=Y.reduce((e,l)=>{const t=l.dorm;return e[t]||(e[t]=[]),e[t].push(l),e},{}),$=S(()=>{const e={};return Object.entries(Se).forEach(([l,t])=>{e[l]=t.filter(r=>!!L.value[r.name_en])}),e}),K=new Map;Y.forEach(e=>{K.set(e.name_ja,e),K.set(e.name_en,e)});const re=()=>{const e=document.querySelector(".display-block");e&&(te.value=e.clientWidth)},oe=()=>{re()};Be(async()=>{z.value?(n.value=D.value,d.value=["SSR"],m.value=["バランス","ディフェンス","アタック"],o.value=["火","水","木","無"],v.value=["ATKUP","ダメージUP","クリティカル","属性ダメージUP","被ダメージUP","ATKDOWN","ダメージDOWN","回避","属性ダメージDOWN","被ダメージDOWN","HP回復","HP継続回復","暗闇無効","呪い無効","凍結無効","デバフ解除","呪い"]):(g.value.length>0&&(n.value=[...g.value]),C.value.length>0&&(d.value=[...C.value]),_.value.length>0&&(m.value=[..._.value]),M.value.length>0&&(o.value=[...M.value]),A.value.length>0&&(v.value=[...A.value])),z.value=!1,re(),window.addEventListener("resize",oe),L.value=await Fe(Y,e=>e.name_en,"icon/"),n.value.length===0&&(n.value=D.value),ae.embedded&&Te([n,d,m,o,v],()=>{g.value=[...n.value],C.value=[...d.value],_.value=[...m.value],M.value=[...o.value],A.value=[...v.value],y.markFilterAsModified(),y.saveCurrentState(),J()},{deep:!0})}),Ue(()=>{window.removeEventListener("resize",oe)});function be(){g.value=[...n.value],C.value=[...d.value],_.value=[...m.value],M.value=[...o.value],A.value=[...v.value],y.markFilterAsModified(),y.saveCurrentState(),J(),le("filter-applied"),ae.embedded||le("close")}function ye(){n.value=D.value,d.value=["SSR"],m.value=["バランス","ディフェンス","アタック"],o.value=["火","水","木","無"],v.value=["ATKUP","ダメージUP","クリティカル","属性ダメージUP","被ダメージUP","ATKDOWN","ダメージDOWN","回避","属性ダメージDOWN","被ダメージDOWN","HP回復","HP継続回復","暗闇無効","呪い無効","凍結無効","デバフ解除","呪い"],g.value=[...n.value],C.value=[...d.value],_.value=[...m.value],M.value=[...o.value],A.value=[...v.value],y.resetFilterState(),J()}const R=S(()=>new Set(n.value)),N=S(()=>new Set(d.value)),q=S(()=>new Set(m.value)),P=S(()=>new Set(o.value)),ie=S(()=>new Set(v.value)),D=S(()=>Object.values($.value).flat().map(e=>e.name_en)),ge=e=>{const l=R.value.has(e);return{"--icon-size":`${pe}px`,"--gap-size":`${he}px`,opacity:l?1:.5}};function J(){U.value.forEach(e=>{if(!N.value.has(e.rare)){e.visible=!1;return}const l=K.get(e.chara);if(!l||!R.value.has(l.name_en)){e.visible=!1;return}if(!q.value.has(e.attr)){e.visible=!1;return}if(!P.value.has(e.magic1atr)&&!P.value.has(e.magic2atr)&&!P.value.has(e.magic3atr)){e.visible=!1;return}if(v.value.length===17)e.visible=!0;else if(v.value.length===0){e.visible=!1;return}else if(v.value.some(r=>e.etc.includes(r)))e.visible=!0;else{e.visible=!1;return}})}function ke(e){const l=e.target;l.src=Pe}function Q(e){if(e==="statusEffects")x.value.every(t=>ie.value.has(t.value))?v.value=[]:v.value=x.value.map(t=>t.value);else if(e==="cardAttributes"){const l=["SSR","SR","R"].every(a=>N.value.has(a)),t=["バランス","ディフェンス","アタック"].every(a=>q.value.has(a)),r=["火","水","木","無"].every(a=>P.value.has(a));l&&t&&r?(d.value=[],m.value=[],o.value=[]):(d.value=["SSR","SR","R"],m.value=["バランス","ディフェンス","アタック"],o.value=["火","水","木","無"])}else{const l=$.value[e]||[],t=R.value;l.every(a=>t.has(a.name_en))?n.value=n.value.filter(a=>!l.some(p=>p.name_en===a)):n.value=[...new Set([...n.value,...l.map(a=>a.name_en)])]}}function X(e){return e==="cardAttributes"?se.every(t=>N.value.has(t))&&ne.value.every(t=>q.value.has(t.value))&&ue.value.every(t=>P.value.has(t.value)):e==="statusEffects"?x.value.every(t=>ie.value.has(t.value)):($.value[e]||[]).every(t=>R.value.has(t.name_en))}function Ce(e){const l=R.value;n.value=l.has(e)?n.value.filter(t=>t!==e):[...n.value,e]}const _e=e=>64+(pe+10+he)*e.length+10,Me=e=>({width:e===1?"100%":"50%"}),we=S(()=>{const e=[];let l=[],t=0;const r=te.value,a=2;return Object.entries($.value).forEach(([p,de])=>{const G=_e(de);G>=r/a?(l.length>0&&(e.push(l),l=[],t=0),e.push([p])):t+G<=r&&l.length<a?(l.push(p),t+=G):(e.push(l),l=[p],t=G)}),l.length>0&&e.push(l),e});function Ae(){ce()?n.value=[]:n.value=[...D.value]}function ce(){return D.value.every(e=>R.value.has(e))}return(e,l)=>(c(),i("div",{class:fe(["modal-background",{embedded:s.embedded}]),ref:"modalContainer"},[h("div",He,[b(F,{small:"",onClick:l[0]||(l[0]=t=>Q("cardAttributes"))},{default:W(()=>[E(B(X("cardAttributes")?w(u)("filterModal.release"):w(u)("filterModal.select")),1)]),_:1}),h("div",Ie,[(c(),i(O,null,V(se,(t,r)=>h("div",{class:"feature-item",key:`rare-${r}`},[b(j,{modelValue:d.value,"onUpdate:modelValue":l[1]||(l[1]=a=>d.value=a),value:t,label:t,"hide-details":""},null,8,["modelValue","value","label"])])),64)),(c(!0),i(O,null,V(ne.value,(t,r)=>(c(),i("div",{class:"feature-item",key:`type-${r}`},[b(j,{modelValue:m.value,"onUpdate:modelValue":l[2]||(l[2]=a=>m.value=a),value:t.value,label:t.name,"hide-details":""},null,8,["modelValue","value","label"])]))),128)),(c(!0),i(O,null,V(ue.value,(t,r)=>(c(),i("div",{class:"feature-item",key:`attr-${r}`},[b(j,{modelValue:o.value,"onUpdate:modelValue":l[3]||(l[3]=a=>o.value=a),value:t.value,label:t.name,"hide-details":""},null,8,["modelValue","value","label"])]))),128))])]),l[8]||(l[8]=h("hr",{class:"rare-divider"},null,-1)),h("div",Le,[h("div",Ke,[b(F,{small:"",onClick:Ae},{default:W(()=>[E(B(ce()?w(u)("filterModal.release"):w(u)("filterModal.select")),1)]),_:1})]),h("div",Ne,[(c(!0),i(O,null,V(we.value,(t,r)=>(c(),i("div",{key:r,class:"row"},[(c(!0),i(O,null,V(t,a=>(c(),i("div",{key:a,style:me(Me(t.length)),class:"character-list"},[h("div",qe,[b(F,{small:"",onClick:p=>Q(a)},{default:W(()=>[E(B(X(a)?w(u)("filterModal.release"):w(u)("filterModal.select")),1)]),_:2},1032,["onClick"]),h("div",Je,[(c(!0),i(O,null,V($.value[a],p=>(c(),i("div",{key:p.name_en,class:fe(["character-item",{selected:R.value.has(p.name_en)}]),onClick:de=>Ce(p.name_en),style:me(ge(p.name_en))},[h("img",{src:L.value[p.name_en],alt:p.name_en,class:"character-image",onError:ke},null,40,Xe)],14,Qe))),128))])])],4))),128))]))),128))])]),l[9]||(l[9]=h("hr",{class:"rare-divider"},null,-1)),h("div",Ye,[b(F,{small:"",onClick:l[4]||(l[4]=t=>Q("statusEffects"))},{default:W(()=>[E(B(X("statusEffects")?w(u)("filterModal.release"):w(u)("filterModal.select")),1)]),_:1}),h("div",Ze,[(c(!0),i(O,null,V(x.value,t=>(c(),i("div",{key:t.name,class:"feature-item"},[b(j,{modelValue:v.value,"onUpdate:modelValue":l[5]||(l[5]=r=>v.value=r),value:t.value,label:t.name,"hide-details":""},null,8,["modelValue","value","label"])]))),128))])]),s.embedded?(c(),i("div",ll,[b(F,{class:"button reset-button",onClick:ye,variant:"outlined",size:"small"},{default:W(()=>[...l[7]||(l[7]=[E(" フィルターリセット ",-1)])]),_:1})])):(c(),i("div",el,[b(F,{class:"button",onClick:l[6]||(l[6]=t=>e.$emit("close"))},{default:W(()=>[E(B(e.$t("filterModal.cancel")),1)]),_:1}),b(F,{class:"button apply-button",disabled:n.value.length===0||d.value.length===0,onClick:be},{default:W(()=>[E(B(e.$t("filterModal.submit")),1)]),_:1},8,["disabled"])]))],2))}}),ol=$e(tl,[["__scopeId","data-v-eeafd6d2"]]);export{ol as F,je as u};

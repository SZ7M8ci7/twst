import{b as ra,l as he,h as ua}from"./common-CP3wv7hG.js";import{useHandCollectionStore as da}from"./handCollection-B4ZlWn2b.js";import{d as ma,i as fa,s as va,r as g,e as T,A as xe,aO as ga,q as Le,c as Z,o as u,w as r,j as k,g as o,a as s,C as ka,U as J,G as Ca,t as h,u as Ee,F as U,k as x,b5 as Pe,l as L,E as ce,b as E,b6 as Ke,v as R,_ as ha}from"./index-BYA24x-D.js";import{C as j}from"./CharacterIconWithType-B_wVBRQC.js";import{r as ya}from"./calculations-qvwqQ9hv.js";import{c as ee,V as Ve}from"./characters_info-DpAXA4qI.js";import{V as Ae,a as Ie}from"./VCard-BtWesTfz.js";import{V as je}from"./VCardText-Bu-0rwl3.js";import{V as re}from"./VSpacer-BlGBU9lI.js";import{V as ba}from"./VContainer-B_4WmGWx.js";const _a={key:0,class:"loading-container"},pa={class:"character-row"},wa={class:"damage-row"},Da=["onClick"],Ua={class:"header-content"},Sa=["src","alt"],Ma={class:"sort-icon"},Ta={key:0,class:"sort-indicator"},xa={key:1,class:"sort-hint"},La={class:"character-row all-characters-row"},Ea={class:"damage-row"},Pa={class:"damage-item all-characters-item"},Ka=["onClick"],Va={class:"damage-row"},Aa={class:"damage-item"},Ia=["onClick"],ja={class:"damage-item-content"},Oa={class:"card-info"},za={key:0,class:"buddy-cards"},Na={key:0,class:"buff-info"},$a={class:"buff-container"},Fa={key:0,class:"buff-source"},Ha={class:"damage-value"},Ba={class:"pagination-controls"},Ra={class:"page-info"},Wa={class:"damage-item-content"},qa={class:"card-info"},Ga={key:0,class:"buddy-cards"},Qa={key:0,class:"buff-info"},Xa={class:"buff-container"},Ya={key:0,class:"buff-source"},Za={class:"damage-value"},Ja={class:"pagination-controls"},ei={class:"page-info"},Oe=50,ai=10,ii=ma({__name:"finisherDamage",setup(ti){const{t:ue}=fa(),ze=ra(),P=da(),{characters:_}=va(ze),y=g(!1),d=g(new Map),de=g({"--icon-size":`${Oe}px`,"--gap-size":`${ai}px`}),Ne={fire:"fire",water:"water",flora:"flora",cosmic:"cosmic"},me=g(!0),K=T(()=>{const e={};for(const[a,i]of d.value.entries())e[a]=i.iconSrc||i.imgSrc||"";return e});xe(async()=>{try{const e=await he(_.value,"name"),a=await he(ee,"name_en","icon/"),i={},n=new Map(ee.map(t=>[t.name_ja,t.name_en]));_.value.forEach(t=>{const c=n.get(t.name);c&&a[c]&&(i[t.name]=a[c])});const l=await he(Object.values(Ne),t=>t,"icon/");d.value=ua(_.value,e,i,l);const m=new Set(d.value.keys());ee.forEach(t=>{const c=a[t.name_en];c&&(t.name_ja&&!m.has(t.name_ja)&&d.value.set(t.name_ja,{type:"",wikiUrl:"",imgSrc:"",iconSrc:c}),t.name_en&&!m.has(t.name_en)&&d.value.set(t.name_en,{type:"",wikiUrl:"",imgSrc:"",iconSrc:c}))})}catch(e){console.error("Error in onMounted finisherDamage.vue:",e)}finally{me.value=!1}});const O={},$e=["(極小)","(小)","(中)","(大)","(極大)"],Fe=["ATKUP","ダメージUP","無属性ダメージUP","火属性ダメージUP","水属性ダメージUP","木属性ダメージUP","被ダメージUP"],He={"ATKUP(極小)":.1,"ATKUP(小)":.2,"ATKUP(中)":.35,"ATKUP(大)":.5,"ATKUP(極大)":.8},V={},z={},N={},$={},F={},W={},q={},G={};function ye(){Object.keys(O).forEach(e=>{O[e]=[]}),_.value.forEach(e=>{if(y.value&&!P.getHandCard(e.name).isOwned)return;const a=e.etc.split(",");O[e.chara]||(O[e.chara]=[]),a.forEach(i=>{const n=i.trim();!n.includes("味方")&&!(n.includes("被ダメージUP")&&n.includes("相手"))||Fe.forEach(l=>{n.startsWith(l)&&$e.forEach(m=>{if(n.includes(m)){let t="";if(n.includes("(M1)")?t="M1":n.includes("(M2)")?t="M2":n.includes("(M3)")&&(t="M3"),t==="M3"){if(e.rare==="R"||e.rare==="SR")return;if(y.value){const c=P.getHandCard(e.name);if(c.isOwned&&!c.isM3)return}}O[e.chara].push({buff:l+m,name:e.name,buffSource:t})}})})})})}ye();function be(){_.value.forEach(e=>{if(e.rare!="SSR")return;let a,i=!0;if(y.value){const C=P.getHandCard(e.name);if(C.isOwned){const v=Number(C.level),D=C.isLimitBreak;a=ya(e,v,D)}else i=!1,a=0}else a=Number(e.originalMaxATK)||Number(e.max_atk)||Number(e.atk)||0;if(!i)return;const n=fe(e.buddy1s)+fe(e.buddy2s)+fe(e.buddy3s),l=Be(e.etc),m=Re(e.etc);let t=0,c=0,f=0,p=0;function w(C,v,D,oe){const Te=He[v]||0,oa=a+a*n+a*l+a*Te;let b=0;const ca=C==="無"?1.1:1;if(v.includes(C+"属性ダメージUP")?(v.includes("(極小)")&&(b=.025),v.includes("(小)")&&(b=.06),v.includes("(中)")&&(b=.105),v.includes("(大)")&&(b=.15),v.includes("(極大)")&&(b=.27)):v.includes("ダメージUP")&&!v.includes("属性ダメージUP")&&(v.includes("(極小)")&&(b=.0225),v.includes("(小)")&&(b=.05),v.includes("(中)")&&(b=.0875),v.includes("(大)")&&(b=.125),v.includes("(極大)")&&(b=.225)),v!=""&&Te==0&&b==0)return;const S=Math.floor(oa*(ca+m+b)*2.4);F[e.name]||(F[e.name]=[],W[e.name]=[],q[e.name]=[],G[e.name]=[]);const M={無:{fire:1,water:1,flora:1,cosmic:1},火:{fire:1,water:.5,flora:1.5,cosmic:1},水:{fire:1.5,water:1,flora:.5,cosmic:1},木:{fire:.5,water:1.5,flora:1,cosmic:1}}[C]||{fire:1,water:1,flora:1,cosmic:1};t=Math.max(S*M.fire,t),c=Math.max(S*M.water,c),f=Math.max(S*M.flora,f),p=Math.max(S*M.cosmic,p),F[e.name].push({damage:S*M.fire,name:D,buffSource:oe}),W[e.name].push({damage:S*M.water,name:D,buffSource:oe}),q[e.name].push({damage:S*M.flora,name:D,buffSource:oe}),G[e.name].push({damage:S*M.cosmic,name:D,buffSource:oe})}w(e.magic2atr,"",Je(e.duo),""),O[e.duo].forEach(C=>{if(C.buffSource==="M3"){const v=_.value.find(D=>D.name===C.name);if(v&&(v.rare==="R"||v.rare==="SR"))return;if(y.value){const D=P.getHandCard(C.name);if(D.isOwned&&!D.isM3)return}}w(e.magic2atr,C.buff,C.name,C.buffSource)}),V[e.chara]||(V[e.chara]=0,z[e.chara]=0,N[e.chara]=0,$[e.chara]=0),V[e.chara]=Math.max(V[e.chara],t),z[e.chara]=Math.max(z[e.chara],c),N[e.chara]=Math.max(N[e.chara],f),$[e.chara]=Math.max($[e.chara],p)})}be();function fe(e){return e.includes("ATK")&&e.includes("小")?.2:e.includes("ATK")&&e.includes("中")?.35:0}function Be(e){return e.includes("ATKUP(極小)(自/3T)")?.1:e.includes("ATKUP(小)(自/3T)")?.2:e.includes("ATKUP(中)(自/3T)")?.35:e.includes("ATKUP(大)(自/3T)")?.5:0}function Re(e){return e.includes("ダメージUP(極小)(自/3T)")?.02:e.includes("ダメージUP(小)(自/3T)")?.05:e.includes("ダメージUP(中)(自/3T)")?.0875:e.includes("ダメージUP(大)(自/3T)")?.125:e.includes("被ダメージUP(中)(相手全体/2T)")?.0875:0}const ae={};_.value.forEach(e=>{e.rare=="SSR"&&(ae[e.chara]||(ae[e.chara]=[]),ae[e.chara].push(e.name))});const ie=g(!1),ve=g([]),We=g(""),qe=g(""),A=g(1),te=g(10),Ge=T(()=>{const e=(A.value-1)*te.value,a=e+te.value;return Ze.value.slice(e,a)}),_e=T(()=>Math.ceil(ve.value.length/te.value));function Qe(e,a){const i=ge(a),n=ae[e];if(!n||n.length===0)return;const l=n.flatMap(m=>(i[m]||[]).map(c=>({...c,cardName:m})));ve.value=l,We.value=e,qe.value=a,A.value=1,ie.value=!0}function ge(e){return{fire:F,water:W,flora:q,cosmic:G}[e]}const H=g(""),Q=g("desc");function Xe(e){H.value===e?Q.value=Q.value==="asc"?"desc":"asc":(H.value=e,Q.value="desc")}const Ye=T(()=>{let e=[...ee];return H.value?e.sort((a,i)=>{const n=ne(a.name_ja,H.value),l=ne(i.name_ja,H.value),m=typeof n=="number"?n:0,t=typeof l=="number"?l:0;return Q.value==="asc"?m-t:t-m}):e});function ne(e,a){var l;if(e==="全キャラ"){const m=ge(a);let t=0;return _.value.filter(c=>c.rare==="SSR").forEach(c=>{if(y.value&&!P.getHandCard(c.name).isOwned)return;const f=m[c.name]||[],p=Math.max(...f.map(w=>w.damage),0);t=Math.max(t,p)}),Math.floor(t)}if(y.value&&!_.value.filter(t=>t.rare==="SSR"&&t.chara===e).some(t=>P.getHandCard(t.name).isOwned))return"-";const n=(l={fire:V,water:z,flora:N,cosmic:$}[a])==null?void 0:l[e];return n?Math.floor(n):"-"}const Ze=T(()=>[...ve.value].sort((e,a)=>a.damage-e.damage));function Je(e){const a=ee.find(i=>i.name_ja===e);return(a==null?void 0:a.name_en)||""}function B(e){if(!e)return;const a=d.value.get(e);a&&a.wikiUrl&&window.open(a.wikiUrl,"_blank")}const se=g(!1),ke=g([]),ea=g("fire"),I=g(1),le=g(10),X=g(0),Y=g(0),pe=[1,1.0833,1.1666,1.25];function Ce(){const i=window.innerHeight*.95-60,l=Math.max(1,Math.floor(i/80));te.value=l,le.value=l}xe(()=>{Ce(),window.addEventListener("resize",Ce)}),ga(()=>{window.removeEventListener("resize",Ce)});const aa=T(()=>{const e=(I.value-1)*le.value,a=e+le.value;return ta.value.slice(e,a)}),we=T(()=>Math.ceil(ke.value.length/le.value));function ia(e){ea.value=e;const a=ge(e);ke.value=_.value.filter(i=>i.rare==="SSR").flatMap(i=>(a[i.name]||[]).map(l=>({cardName:i.name,damage:l.damage,buffName:l.name||"",buffSource:l.buffSource||""}))),I.value=1,se.value=!0}const ta=T(()=>[...ke.value].sort((e,a)=>a.damage-e.damage));function De(e){const a=_.value.find(n=>n.name===e);if(!a)return[];const i=[];return a.buddy1c&&a.buddy1s.includes("ATK")&&d.value.get(a.buddy1c)&&i.push(a.buddy1c),a.buddy2c&&a.buddy2s.includes("ATK")&&d.value.get(a.buddy2c)&&i.push(a.buddy2c),a.buddy3c&&a.buddy3s.includes("ATK")&&d.value.get(a.buddy3c)&&i.push(a.buddy3c),i}function na(){y.value=!y.value}Le(()=>y.value,()=>{Me()});function sa(){X.value=(X.value+1)%4}function la(){Y.value=(Y.value+1)%4}function Ue(e){return{"background-color":["rgba(255, 235, 59, 0.1)","rgba(255, 235, 59, 0.3)","rgba(255, 235, 59, 0.6)","rgba(255, 235, 59, 0.9)"][e],color:"#999999","border-color":"#e0e0e0"}}function Se(e){return ue(`finisherDamage.${["normal","critical1","critical2","critical3"][e]}`)}Le(()=>P.handCollection,()=>{y.value&&Me()},{deep:!0});function Me(){me.value||(Object.keys(V).forEach(e=>delete V[e]),Object.keys(z).forEach(e=>delete z[e]),Object.keys(N).forEach(e=>delete N[e]),Object.keys($).forEach(e=>delete $[e]),Object.keys(F).forEach(e=>delete F[e]),Object.keys(W).forEach(e=>delete W[e]),Object.keys(q).forEach(e=>delete q[e]),Object.keys(G).forEach(e=>delete G[e]),ye(),be())}return(e,a)=>(u(),Z(ba,{class:"finisher-container"},{default:r(()=>[me.value?(u(),k("div",_a,[o(ka,{indeterminate:"",color:"primary",size:64}),a[8]||(a[8]=s("p",{class:"loading-text"},"Loading...",-1))])):(u(),k(U,{key:1},[s("div",pa,[s("div",{class:"character-item",style:J({...de.value})},[s("div",{class:Ca(["toggle-button",{active:y.value}]),onClick:na},h(y.value?Ee(ue)("finisherDamage.handCollection"):Ee(ue)("finisherDamage.allCards")),3)],4),s("div",wa,[(u(),k(U,null,x(["Fire","Water","Flora","Cosmic"],i=>{var n;return s("div",{key:i,class:"damage-col"},[s("div",{class:"damage-item clickable-header",onClick:l=>Xe(i.toLowerCase())},[s("div",Ua,[a[9]||(a[9]=s("span",{class:"vs-text"},"VS",-1)),s("img",{src:((n=d.value.get(i.toLowerCase()))==null?void 0:n.imgSrc)||"",alt:i,class:"element-icon"},null,8,Sa),s("span",Ma,[H.value===i.toLowerCase()?(u(),k("span",Ta,h(Q.value==="asc"?"↑":"↓"),1)):(u(),k("span",xa,"↕"))])])],8,Da)])}),64))])]),s("div",La,[s("div",{class:"character-item",style:J({...de.value})},[...a[10]||(a[10]=[s("div",{class:"all-characters-label"},"ALL",-1)])],4),s("div",Ea,[(u(),k(U,null,x(["Fire","Water","Flora","Cosmic"],i=>s("div",{key:i,class:"damage-col"},[s("div",Pa,[s("span",{class:"clickable-damage",onClick:n=>ia(i.toLowerCase())},h(ne("全キャラ",i.toLowerCase())),9,Ka)])])),64))])]),(u(!0),k(U,null,x(Ye.value,i=>{var n;return u(),k("div",{key:i.name_en,class:"character-row"},[s("div",{class:"character-item",style:J({...de.value})},[o(j,{iconKey:i.name_ja,iconDictionary:K.value,wikiUrl:((n=d.value.get(i.name_ja))==null?void 0:n.wikiUrl)||"",iconSize:Oe},null,8,["iconKey","iconDictionary","wikiUrl"])],4),s("div",Va,[(u(),k(U,null,x(["Fire","Water","Flora","Cosmic"],l=>s("div",{key:l,class:"damage-col"},[s("div",Aa,[s("span",{class:"clickable-damage",onClick:m=>Qe(i.name_ja,l.toLowerCase())},h(ne(i.name_ja,l.toLowerCase())),9,Ia)])])),64))])])}),128))],64)),o(Ve,{modelValue:ie.value,"onUpdate:modelValue":a[3]||(a[3]=i=>ie.value=i),"max-width":"450"},{default:r(()=>[o(Ae,null,{default:r(()=>[o(je,{class:"modal-content"},{default:r(()=>[o(Pe,{class:"damage-list"},{default:r(()=>[(u(!0),k(U,null,x(Ge.value,(i,n)=>(u(),Z(Ke,{key:n,class:"damage-list-item"},{default:r(()=>{var l,m,t,c;return[s("div",ja,[s("div",Oa,[o(j,{iconKey:i.cardName||"",iconDictionary:K.value,wikiUrl:((l=d.value.get(i.cardName||""))==null?void 0:l.wikiUrl)||"",cardType:((m=d.value.get(i.cardName||""))==null?void 0:m.type)||"",iconSize:46,class:"card-icon clickable-icon",onClick:f=>B(i.cardName)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),i.cardName?(u(),k("div",za,[(u(!0),k(U,null,x(De(i.cardName),f=>{var p,w;return u(),Z(j,{key:f,iconKey:f,iconDictionary:K.value,wikiUrl:((p=d.value.get(f))==null?void 0:p.wikiUrl)||"",cardType:((w=d.value.get(f))==null?void 0:w.type)||"",iconSize:26,class:"buddy-icon clickable-icon",onClick:C=>B(f)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"])}),128))])):R("",!0)]),i.name?(u(),k("div",Na,[s("div",$a,[o(j,{iconKey:i.name,iconDictionary:K.value,wikiUrl:((t=d.value.get(i.name))==null?void 0:t.wikiUrl)||"",cardType:((c=d.value.get(i.name))==null?void 0:c.type)||"",iconSize:46,class:"buff-icon clickable-icon",onClick:f=>B(i.name)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),i.buffSource?(u(),k("span",Fa,h(i.buffSource),1)):R("",!0)])])):R("",!0),s("div",Ha,h(Math.floor(i.damage*pe[X.value]).toLocaleString()),1)])]}),_:2},1024))),128))]),_:1})]),_:1}),o(Ie,null,{default:r(()=>[o(re),s("div",Ba,[o(L,{disabled:A.value===1,onClick:a[0]||(a[0]=i=>A.value--),variant:"text",size:"small",icon:""},{default:r(()=>[o(ce,null,{default:r(()=>[...a[11]||(a[11]=[E("mdi-chevron-left",-1)])]),_:1})]),_:1},8,["disabled"]),s("span",Ra,h(A.value)+" / "+h(_e.value),1),o(L,{disabled:A.value===_e.value,onClick:a[1]||(a[1]=i=>A.value++),variant:"text",size:"small",icon:""},{default:r(()=>[o(ce,null,{default:r(()=>[...a[12]||(a[12]=[E("mdi-chevron-right",-1)])]),_:1})]),_:1},8,["disabled"])]),o(re),o(L,{variant:"outlined",class:"critical-btn",style:J(Ue(X.value)),onClick:sa},{default:r(()=>[E(h(Se(X.value)),1)]),_:1},8,["style"]),o(L,{color:"grey",variant:"outlined",class:"close-btn",onClick:a[2]||(a[2]=i=>ie.value=!1)},{default:r(()=>[...a[13]||(a[13]=[E("CLOSE",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(Ve,{modelValue:se.value,"onUpdate:modelValue":a[7]||(a[7]=i=>se.value=i),"max-width":"450"},{default:r(()=>[o(Ae,null,{default:r(()=>[o(je,{class:"modal-content"},{default:r(()=>[o(Pe,{class:"damage-list"},{default:r(()=>[(u(!0),k(U,null,x(aa.value,(i,n)=>(u(),Z(Ke,{key:n,class:"damage-list-item"},{default:r(()=>{var l,m,t,c;return[s("div",Wa,[s("div",qa,[o(j,{iconKey:i.cardName,iconDictionary:K.value,wikiUrl:((l=d.value.get(i.cardName))==null?void 0:l.wikiUrl)||"",cardType:((m=d.value.get(i.cardName))==null?void 0:m.type)||"",iconSize:46,class:"card-icon clickable-icon",onClick:f=>B(i.cardName)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),i.cardName?(u(),k("div",Ga,[(u(!0),k(U,null,x(De(i.cardName),f=>{var p,w;return u(),Z(j,{key:f,iconKey:f,iconDictionary:K.value,wikiUrl:((p=d.value.get(f))==null?void 0:p.wikiUrl)||"",cardType:((w=d.value.get(f))==null?void 0:w.type)||"",iconSize:26,class:"buddy-icon clickable-icon",onClick:C=>B(f)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"])}),128))])):R("",!0)]),i.buffName?(u(),k("div",Qa,[s("div",Xa,[o(j,{iconKey:i.buffName,iconDictionary:K.value,wikiUrl:((t=d.value.get(i.buffName))==null?void 0:t.wikiUrl)||"",cardType:((c=d.value.get(i.buffName))==null?void 0:c.type)||"",iconSize:46,class:"buff-icon clickable-icon",onClick:f=>B(i.buffName)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),i.buffSource?(u(),k("span",Ya,h(i.buffSource),1)):R("",!0)])])):R("",!0),s("div",Za,h(Math.floor(i.damage*pe[Y.value]).toLocaleString()),1)])]}),_:2},1024))),128))]),_:1})]),_:1}),o(Ie,null,{default:r(()=>[o(re),s("div",Ja,[o(L,{disabled:I.value===1,onClick:a[4]||(a[4]=i=>I.value--),variant:"text",size:"small",icon:""},{default:r(()=>[o(ce,null,{default:r(()=>[...a[14]||(a[14]=[E("mdi-chevron-left",-1)])]),_:1})]),_:1},8,["disabled"]),s("span",ei,h(I.value)+" / "+h(we.value),1),o(L,{disabled:I.value===we.value,onClick:a[5]||(a[5]=i=>I.value++),variant:"text",size:"small",icon:""},{default:r(()=>[o(ce,null,{default:r(()=>[...a[15]||(a[15]=[E("mdi-chevron-right",-1)])]),_:1})]),_:1},8,["disabled"])]),o(re),o(L,{variant:"outlined",class:"critical-btn",style:J(Ue(Y.value)),onClick:la},{default:r(()=>[E(h(Se(Y.value)),1)]),_:1},8,["style"]),o(L,{color:"grey",variant:"outlined",class:"close-btn",onClick:a[6]||(a[6]=i=>se.value=!1)},{default:r(()=>[...a[16]||(a[16]=[E("CLOSE",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),gi=ha(ii,[["__scopeId","data-v-87806f46"]]);export{gi as default};

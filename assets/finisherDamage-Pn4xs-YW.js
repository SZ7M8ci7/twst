import{b as Oe,l as re,h as Ge}from"./common-BF6wUovf.js";import{d as qe,ah as Qe,r as _,e as U,I as _e,a3 as Xe,c as F,w as f,j as g,g as l,a as t,an as Ye,ax as ue,F as b,k as S,a$ as ke,l as K,ap as Z,b as E,t as p,o as r,b0 as ye,ai as A,_ as Ze}from"./index-CA1IBPti.js";import{C as L}from"./CharacterIconWithType-b0lgoobq.js";import{c as P,V as pe}from"./characters_info-CW1N-CN7.js";import{V as he,a as be}from"./VCard-B_9sI6TL.js";import{V as we}from"./VCardText-cJOLD1-v.js";import{V as J}from"./VSpacer-CXgXjEHR.js";import{V as Je}from"./VContainer-CUY6NaTz.js";const ea={key:0,class:"loading-container"},aa={class:"character-row"},ia={class:"damage-row"},sa=["onClick"],ta={class:"header-content"},na=["src","alt"],oa={class:"sort-icon"},la={key:0,class:"sort-indicator"},ca={key:1,class:"sort-hint"},ra={class:"character-row all-characters-row"},ua={class:"damage-row"},da={class:"damage-item all-characters-item"},ma=["onClick"],fa={class:"damage-row"},va={class:"damage-item"},ga=["onClick"],_a={class:"damage-item-content"},ka={class:"card-info"},ya={key:0,class:"buddy-cards"},pa={key:0,class:"buff-info"},ha={class:"buff-container"},ba={key:0,class:"buff-source"},wa={class:"damage-value"},Ca={class:"pagination-controls"},Da={class:"page-info"},Ua={class:"damage-item-content"},Sa={class:"card-info"},Ta={key:0,class:"buddy-cards"},Ma={key:0,class:"buff-info"},xa={class:"buff-container"},La={key:0,class:"buff-source"},Pa={class:"damage-value"},Va={class:"pagination-controls"},Ia={class:"page-info"},Ce=50,Ka=10,Ea=80,Aa=qe({__name:"finisherDamage",setup(za){const De=Oe(),{characters:h}=Qe(De),u=_(new Map),ee=_({"--icon-size":`${Ce}px`,"--gap-size":`${Ka}px`}),Ue={fire:"fire",water:"water",flora:"flora",cosmic:"cosmic"},de=_(!0),T=U(()=>{const e={};for(const[a,i]of u.value.entries())e[a]=i.iconSrc||i.imgSrc||"";return e});_e(async()=>{try{const e=await re(h.value,"name"),a=await re(P,"name_en","icon/"),i={},s=new Map(P.map(n=>[n.name_ja,n.name_en]));h.value.forEach(n=>{const d=s.get(n.name);d&&a[d]&&(i[n.name]=a[d])});const o=await re(Object.values(Ue),n=>n,"icon/");u.value=Ge(h.value,e,i,o);const c=new Set(u.value.keys());P.forEach(n=>{const d=a[n.name_en];d&&(n.name_ja&&!c.has(n.name_ja)&&u.value.set(n.name_ja,{type:"",wikiUrl:"",imgSrc:"",iconSrc:d}),n.name_en&&!c.has(n.name_en)&&u.value.set(n.name_en,{type:"",wikiUrl:"",imgSrc:"",iconSrc:d}))})}catch(e){console.error("Error in onMounted finisherDamage.vue:",e)}finally{de.value=!1}});const N={},Se=["(極小)","(小)","(中)","(大)","(極大)"],Te=["ATKUP","ダメージUP","無属性ダメージUP","火属性ダメージUP","水属性ダメージUP","木属性ダメージUP","被ダメージUP"],Me={"ATKUP(極小)":.1,"ATKUP(小)":.2,"ATKUP(中)":.35,"ATKUP(大)":.5,"ATKUP(極大)":.8},z={},j={},B={},W={},H={},ae={},ie={},se={};h.value.forEach(e=>{const a=e.etc.split(",");N[e.chara]||(N[e.chara]=[]),a.forEach(i=>{const s=i.trim();!s.includes("味方")&&!(s.includes("被ダメージUP")&&s.includes("相手"))||Te.forEach(o=>{s.startsWith(o)&&Se.forEach(c=>{if(s.includes(c)){let n="";s.includes("(M1)")?n="M1":s.includes("(M2)")?n="M2":s.includes("(M3)")&&(n="M3"),N[e.chara].push({buff:o+c,name:e.name,buffSource:n})}})})})}),h.value.forEach(e=>{if(e.rare!="SSR")return;const a=te(e.buddy1s)+te(e.buddy2s)+te(e.buddy3s),i=xe(e.etc),s=Le(e.etc);let o=0,c=0,n=0,d=0;function v(k,m,w,Y){const ge=Me[m]||0,He=e.atk+e.atk*a+e.atk*i+e.atk*ge;let y=0;const Re=k==="無"?1.1:1;if(m.includes(k+"属性ダメージUP")?(m.includes("(極小)")&&(y=.025),m.includes("(小)")&&(y=.06),m.includes("(中)")&&(y=.105),m.includes("(大)")&&(y=.15),m.includes("(極大)")&&(y=.27)):m.includes("ダメージUP")&&!m.includes("属性ダメージUP")&&(m.includes("(極小)")&&(y=.0225),m.includes("(小)")&&(y=.05),m.includes("(中)")&&(y=.0875),m.includes("(大)")&&(y=.125),m.includes("(極大)")&&(y=.225)),m!=""&&ge==0&&y==0)return;const C=Math.floor(He*(Re+s+y)*2.4);H[e.name]||(H[e.name]=[],ae[e.name]=[],ie[e.name]=[],se[e.name]=[]);const D={無:{fire:1,water:1,flora:1,cosmic:1},火:{fire:1,water:.5,flora:1.5,cosmic:1},水:{fire:1.5,water:1,flora:.5,cosmic:1},木:{fire:.5,water:1.5,flora:1,cosmic:1}}[k]||{fire:1,water:1,flora:1,cosmic:1};o=Math.max(C*D.fire,o),c=Math.max(C*D.water,c),n=Math.max(C*D.flora,n),d=Math.max(C*D.cosmic,d),H[e.name].push({damage:C*D.fire,name:w,buffSource:Y}),ae[e.name].push({damage:C*D.water,name:w,buffSource:Y}),ie[e.name].push({damage:C*D.flora,name:w,buffSource:Y}),se[e.name].push({damage:C*D.cosmic,name:w,buffSource:Y})}v(e.magic2atr,"",Fe(e.duo),""),N[e.duo].forEach(k=>{v(e.magic2atr,k.buff,k.name,k.buffSource)}),z[e.chara]||(z[e.chara]=0,j[e.chara]=0,B[e.chara]=0,W[e.chara]=0),z[e.chara]=Math.max(z[e.chara],o),j[e.chara]=Math.max(j[e.chara],c),B[e.chara]=Math.max(B[e.chara],n),W[e.chara]=Math.max(W[e.chara],d)});function te(e){return e.includes("ATK")&&e.includes("小")?.2:e.includes("ATK")&&e.includes("中")?.35:0}function xe(e){return e.includes("ATKUP(極小)(自/3T)")?.1:e.includes("ATKUP(小)(自/3T)")?.2:e.includes("ATKUP(中)(自/3T)")?.35:e.includes("ATKUP(大)(自/3T)")?.5:0}function Le(e){return e.includes("ダメージUP(極小)(自/3T)")?.02:e.includes("ダメージUP(小)(自/3T)")?.05:e.includes("ダメージUP(中)(自/3T)")?.0875:e.includes("ダメージUP(大)(自/3T)")?.125:e.includes("被ダメージUP(中)(相手全体/2T)")?.0875:0}const R={};h.value.forEach(e=>{e.rare=="SSR"&&(R[e.chara]||(R[e.chara]=[]),R[e.chara].push(e.name))});const Pe=_({});P.forEach(e=>{Pe.value[e.name_en]={fire:[],water:[],flora:[],cosmic:[]}});const O=_(!1),ne=_([]),Ve=_(""),Ie=_(""),M=_(1),G=_(10),Ke=U(()=>{const e=(M.value-1)*G.value,a=e+G.value;return $e.value.slice(e,a)}),me=U(()=>Math.ceil(ne.value.length/G.value));function Ee(e,a){const i=oe(a),s=R[e];if(!s||s.length===0)return;const o=s.flatMap(c=>(i[c]||[]).map(d=>({...d,cardName:c})));ne.value=o,Ve.value=e,Ie.value=a,M.value=1,O.value=!0}function oe(e){return{fire:H,water:ae,flora:ie,cosmic:se}[e]}const V=_(""),$=_("desc");function Ae(e){V.value===e?$.value=$.value==="asc"?"desc":"asc":(V.value=e,$.value="desc")}const ze=U(()=>V.value?[...P].sort((e,a)=>{const i=q(e.name_ja,V.value),s=q(a.name_ja,V.value),o=typeof i=="number"?i:0,c=typeof s=="number"?s:0;return $.value==="asc"?o-c:c-o}):P);function q(e,a){var o;if(e==="全キャラ"){const c=oe(a),n=h.value.filter(d=>d.rare==="SSR").reduce((d,v)=>{const k=c[v.name]||[],m=Math.max(...k.map(w=>w.damage),0);return Math.max(d,m)},0);return Math.floor(n)}const s=(o={fire:z,water:j,flora:B,cosmic:W}[a])==null?void 0:o[e];return s?Math.floor(s):"-"}const $e=U(()=>[...ne.value].sort((e,a)=>a.damage-e.damage));function Fe(e){const a=P.find(i=>i.name_ja===e);return(a==null?void 0:a.name_en)||""}function I(e){if(!e)return;const a=u.value.get(e);a&&a.wikiUrl&&window.open(a.wikiUrl,"_blank")}const Q=_(!1),le=_([]),Ne=_("fire"),x=_(1),X=_(10);function ce(){const i=window.innerHeight*.95-60,s=Math.max(1,Math.floor(i/Ea));G.value=s,X.value=s}_e(()=>{ce(),window.addEventListener("resize",ce)}),Xe(()=>{window.removeEventListener("resize",ce)});const je=U(()=>{const e=(x.value-1)*X.value,a=e+X.value;return We.value.slice(e,a)}),fe=U(()=>Math.ceil(le.value.length/X.value));function Be(e){Ne.value=e;const a=oe(e);le.value=h.value.filter(i=>i.rare==="SSR").flatMap(i=>(a[i.name]||[]).map(o=>({cardName:i.name,damage:o.damage,buffName:o.name||"",buffSource:o.buffSource||""}))),x.value=1,Q.value=!0}const We=U(()=>[...le.value].sort((e,a)=>a.damage-e.damage));function ve(e){const a=h.value.find(s=>s.name===e);if(!a)return[];const i=[];return a.buddy1c&&a.buddy1s.includes("ATK")&&u.value.get(a.buddy1c)&&i.push(a.buddy1c),a.buddy2c&&a.buddy2s.includes("ATK")&&u.value.get(a.buddy2c)&&i.push(a.buddy2c),a.buddy3c&&a.buddy3s.includes("ATK")&&u.value.get(a.buddy3c)&&i.push(a.buddy3c),i}return(e,a)=>(r(),F(Je,{class:"finisher-container"},{default:f(()=>[de.value?(r(),g("div",ea,[l(Ye,{indeterminate:"",color:"primary",size:64}),a[8]||(a[8]=t("p",{class:"loading-text"},"Loading...",-1))])):(r(),g(b,{key:1},[t("div",aa,[t("div",{class:"character-item",style:ue({...ee.value})},null,4),t("div",ia,[(r(),g(b,null,S(["Fire","Water","Flora","Cosmic"],i=>{var s;return t("div",{key:i,class:"damage-col"},[t("div",{class:"damage-item clickable-header",onClick:o=>Ae(i.toLowerCase())},[t("div",ta,[a[9]||(a[9]=t("span",{class:"vs-text"},"VS",-1)),t("img",{src:((s=u.value.get(i.toLowerCase()))==null?void 0:s.imgSrc)||"",alt:i,class:"element-icon"},null,8,na),t("span",oa,[V.value===i.toLowerCase()?(r(),g("span",la,p($.value==="asc"?"↑":"↓"),1)):(r(),g("span",ca,"↕"))])])],8,sa)])}),64))])]),t("div",ra,[t("div",{class:"character-item",style:ue({...ee.value})},a[10]||(a[10]=[t("div",{class:"all-characters-label"},"ALL",-1)]),4),t("div",ua,[(r(),g(b,null,S(["Fire","Water","Flora","Cosmic"],i=>t("div",{key:i,class:"damage-col"},[t("div",da,[t("span",{class:"clickable-damage",onClick:s=>Be(i.toLowerCase())},p(q("全キャラ",i.toLowerCase())),9,ma)])])),64))])]),(r(!0),g(b,null,S(ze.value,i=>{var s;return r(),g("div",{key:i.name_en,class:"character-row"},[t("div",{class:"character-item",style:ue({...ee.value})},[l(L,{iconKey:i.name_ja,iconDictionary:T.value,wikiUrl:((s=u.value.get(i.name_ja))==null?void 0:s.wikiUrl)||"",iconSize:Ce},null,8,["iconKey","iconDictionary","wikiUrl"])],4),t("div",fa,[(r(),g(b,null,S(["Fire","Water","Flora","Cosmic"],o=>t("div",{key:o,class:"damage-col"},[t("div",va,[t("span",{class:"clickable-damage",onClick:c=>Ee(i.name_ja,o.toLowerCase())},p(q(i.name_ja,o.toLowerCase())),9,ga)])])),64))])])}),128))],64)),l(pe,{modelValue:O.value,"onUpdate:modelValue":a[3]||(a[3]=i=>O.value=i),"max-width":"450"},{default:f(()=>[l(he,null,{default:f(()=>[l(we,{class:"modal-content"},{default:f(()=>[l(ke,{class:"damage-list"},{default:f(()=>[(r(!0),g(b,null,S(Ke.value,(i,s)=>(r(),F(ye,{key:s,class:"damage-list-item"},{default:f(()=>{var o,c,n,d;return[t("div",_a,[t("div",ka,[l(L,{iconKey:i.cardName||"",iconDictionary:T.value,wikiUrl:((o=u.value.get(i.cardName||""))==null?void 0:o.wikiUrl)||"",cardType:((c=u.value.get(i.cardName||""))==null?void 0:c.type)||"",iconSize:46,class:"card-icon clickable-icon",onClick:v=>I(i.cardName)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),i.cardName?(r(),g("div",ya,[(r(!0),g(b,null,S(ve(i.cardName),v=>{var k,m;return r(),F(L,{key:v,iconKey:v,iconDictionary:T.value,wikiUrl:((k=u.value.get(v))==null?void 0:k.wikiUrl)||"",cardType:((m=u.value.get(v))==null?void 0:m.type)||"",iconSize:26,class:"buddy-icon clickable-icon",onClick:w=>I(v)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"])}),128))])):A("",!0)]),i.name?(r(),g("div",pa,[t("div",ha,[l(L,{iconKey:i.name,iconDictionary:T.value,wikiUrl:((n=u.value.get(i.name))==null?void 0:n.wikiUrl)||"",cardType:((d=u.value.get(i.name))==null?void 0:d.type)||"",iconSize:46,class:"buff-icon clickable-icon",onClick:v=>I(i.name)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),i.buffSource?(r(),g("span",ba,p(i.buffSource),1)):A("",!0)])])):A("",!0),t("div",wa,p(Math.floor(i.damage).toLocaleString()),1)])]}),_:2},1024))),128))]),_:1})]),_:1}),l(be,null,{default:f(()=>[l(J),t("div",Ca,[l(K,{disabled:M.value===1,onClick:a[0]||(a[0]=i=>M.value--),variant:"text",size:"small",icon:""},{default:f(()=>[l(Z,null,{default:f(()=>a[11]||(a[11]=[E("mdi-chevron-left")])),_:1,__:[11]})]),_:1},8,["disabled"]),t("span",Da,p(M.value)+" / "+p(me.value),1),l(K,{disabled:M.value===me.value,onClick:a[1]||(a[1]=i=>M.value++),variant:"text",size:"small",icon:""},{default:f(()=>[l(Z,null,{default:f(()=>a[12]||(a[12]=[E("mdi-chevron-right")])),_:1,__:[12]})]),_:1},8,["disabled"])]),l(J),l(K,{color:"grey",variant:"outlined",class:"close-btn",onClick:a[2]||(a[2]=i=>O.value=!1)},{default:f(()=>a[13]||(a[13]=[E("CLOSE")])),_:1,__:[13]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(pe,{modelValue:Q.value,"onUpdate:modelValue":a[7]||(a[7]=i=>Q.value=i),"max-width":"450"},{default:f(()=>[l(he,null,{default:f(()=>[l(we,{class:"modal-content"},{default:f(()=>[l(ke,{class:"damage-list"},{default:f(()=>[(r(!0),g(b,null,S(je.value,(i,s)=>(r(),F(ye,{key:s,class:"damage-list-item"},{default:f(()=>{var o,c,n,d;return[t("div",Ua,[t("div",Sa,[l(L,{iconKey:i.cardName,iconDictionary:T.value,wikiUrl:((o=u.value.get(i.cardName))==null?void 0:o.wikiUrl)||"",cardType:((c=u.value.get(i.cardName))==null?void 0:c.type)||"",iconSize:46,class:"card-icon clickable-icon",onClick:v=>I(i.cardName)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),i.cardName?(r(),g("div",Ta,[(r(!0),g(b,null,S(ve(i.cardName),v=>{var k,m;return r(),F(L,{key:v,iconKey:v,iconDictionary:T.value,wikiUrl:((k=u.value.get(v))==null?void 0:k.wikiUrl)||"",cardType:((m=u.value.get(v))==null?void 0:m.type)||"",iconSize:26,class:"buddy-icon clickable-icon",onClick:w=>I(v)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"])}),128))])):A("",!0)]),i.buffName?(r(),g("div",Ma,[t("div",xa,[l(L,{iconKey:i.buffName,iconDictionary:T.value,wikiUrl:((n=u.value.get(i.buffName))==null?void 0:n.wikiUrl)||"",cardType:((d=u.value.get(i.buffName))==null?void 0:d.type)||"",iconSize:46,class:"buff-icon clickable-icon",onClick:v=>I(i.buffName)},null,8,["iconKey","iconDictionary","wikiUrl","cardType","onClick"]),i.buffSource?(r(),g("span",La,p(i.buffSource),1)):A("",!0)])])):A("",!0),t("div",Pa,p(Math.floor(i.damage).toLocaleString()),1)])]}),_:2},1024))),128))]),_:1})]),_:1}),l(be,null,{default:f(()=>[l(J),t("div",Va,[l(K,{disabled:x.value===1,onClick:a[4]||(a[4]=i=>x.value--),variant:"text",size:"small",icon:""},{default:f(()=>[l(Z,null,{default:f(()=>a[14]||(a[14]=[E("mdi-chevron-left")])),_:1,__:[14]})]),_:1},8,["disabled"]),t("span",Ia,p(x.value)+" / "+p(fe.value),1),l(K,{disabled:x.value===fe.value,onClick:a[5]||(a[5]=i=>x.value++),variant:"text",size:"small",icon:""},{default:f(()=>[l(Z,null,{default:f(()=>a[15]||(a[15]=[E("mdi-chevron-right")])),_:1,__:[15]})]),_:1},8,["disabled"])]),l(J),l(K,{color:"grey",variant:"outlined",class:"close-btn",onClick:a[6]||(a[6]=i=>Q.value=!1)},{default:f(()=>a[16]||(a[16]=[E("CLOSE")])),_:1,__:[16]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),Ga=Ze(Aa,[["__scopeId","data-v-97ff20e1"]]);export{Ga as default};

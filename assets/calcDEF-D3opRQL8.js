import{C as J,r as L,u as Q,V as Y,D as Z}from"./simulatorStore-BA7RF3ST.js";import{d as ee,i as ae,r as f,e as d,X as le,H as te,c as se,w as s,g as a,a as o,t as c,m as oe,V as g,b as R,b7 as ne,o as ue,_ as de}from"./index-ZRFNbwzj.js";import{V as n,a as m}from"./VRow-C3ypmnxY.js";import{V as ce}from"./VContainer-BNIkODTQ.js";const ie={class:"field-label"},re={class:"field-label"},fe={class:"field-label"},me={class:"field-label"},ve={class:"field-label"},pe={class:"field-label"},ge={class:"mdi mdi-help-circle-outline"},be={class:"field-label"},De={class:"table-wrapper"},Ve={class:"pa-0"},_e={class:"pa-0"},he={class:"text-nowrap wide-cell pa-0"},Ce={class:"pa-0"},ye={class:"pa-0"},Fe=ee({__name:"calcDEF",props:{selectedAttribute:{}},setup(B){J.register(...L);const{t:b}=ae(),v=Q(),H=B,k=f(!1),i=f(5),p=[.8,.85,.9,.95,1],h=f(0),A=f(0),C=f(0),y=f(0),F=f(0),r=f(1.5),I=[{text:"Easy",value:.8},{text:"Normal",value:1},{text:"Hard",value:1.2},{text:"Extra",value:1.5}],_=f({advantageDamaged:0,disadvantageDamaged:0}),N=d(()=>A.value*.1275),T=d(()=>Number(h.value)*.0625),M=d(()=>Number(C.value*.05)),w=d(()=>_.value.advantageDamaged*2*.05208),x=d(()=>-_.value.disadvantageDamaged/1.5*.05208),P=d(()=>y.value*600),O=d(()=>F.value*300),z=d(()=>N.value+T.value+M.value+w.value+x.value+P.value+O.value),G=d(()=>(z.value*r.value*p[i.value-1]).toFixed()),D=["#FAD9C8","#FAF2C8","#E9FAC8","#D0FAC8","#C8FAD9","#C8FAF2","#C8E9FA","#C8D0FA","#D9C8FA","#F2C8FA"],S=d(()=>[{label:b("deffence.remainHP"),value:Math.floor(N.value*r.value*p[i.value-1]),color:D[0]},{label:b("deffence.totalHP"),value:Math.floor(T.value*r.value*p[i.value-1]),color:D[1]},{label:b("deffence.damage"),value:Math.floor(M.value*r.value*p[i.value-1]),color:D[2]},{label:b("deffence.advantageDamageTaken"),value:Math.floor(w.value*r.value*p[i.value-1]),color:D[3]},{label:b("deffence.disadvantageDamageTaken"),value:Math.floor(x.value*r.value*p[i.value-1]),color:D[4]},{label:b("deffence.evasion"),value:Math.floor(P.value*r.value*p[i.value-1]),color:D[5]},{label:b("deffence.debuff"),value:Math.floor(O.value*r.value*p[i.value-1]),color:D[6]}].sort((t,e)=>e.value-t.value)),K=d(()=>({labels:S.value.map(t=>t.label),datasets:[{data:S.value.map(t=>t.value),backgroundColor:S.value.map(t=>t.color)}]}));le(async()=>{await v.waitForDeckStats(),k.value=!0,te(()=>[v.deckCharacters,H.selectedAttribute,v.isDeckStatsReady],()=>{k.value&&v.isDeckStatsReady&&X()},{deep:!0,immediate:!0})});async function X(){if(k.value)try{const t=H.selectedAttribute||"対全",e=await v.waitForDeckStats(),l=((e==null?void 0:e.totalHP)||0)+((e==null?void 0:e.totalBuddyHP)||0)+((e==null?void 0:e.totalHeal)||0);h.value=Math.round(l);const V=await v.getSafeDeckDamage(t);C.value=Math.floor(V);const E=j();y.value=E;const $=q();F.value=$}catch{h.value=0,C.value=0,y.value=0,F.value=0}}function j(){let t=0;return(v.deckCharacters||[]).forEach(e=>{if(!(!e||!e.name||e.name===""||e.name==="なし"))for(let l=1;l<=3;l++)e[`isM${l}Selected`]&&(e.etc||"").split("<br>").map(u=>u.trim()).filter(u=>u.includes(`(M${l})`)).some(u=>u.includes("回避"))&&t++}),t}function q(){let t=0;const e=["ATKDOWN","火属性ダメージDOWN","水属性ダメージDOWN","木属性ダメージDOWN","無属性ダメージDOWN","ダメージDOWN","被ダメージDOWN"];return(v.deckCharacters||[]).forEach(l=>{if(!(!l||!l.name||l.name===""||l.name==="なし")){for(let V=1;V<=3;V++)if(l[`isM${V}Selected`]){const U=(l.etc||"").split(",").map(u=>u.trim()).filter(u=>u.includes(`(M${V})`));for(const u of U)for(const W of e)if(u.includes(W)){if(W==="被ダメージDOWN"){if(u.includes("自")||u.includes("味方")){t++;break}}else if(u.includes("相手")){t++;break}}}}}),t}return(t,e)=>(ue(),se(ce,{class:"pa-2"},{default:s(()=>[a(m,{class:"ma-0"},{default:s(()=>[a(n,{cols:"12",class:"pa-0"},{default:s(()=>[a(m,{align:"center",class:"ma-0"},{default:s(()=>[a(n,{cols:"4",sm:"3",class:"pa-0 pr-1 text-right"},{default:s(()=>[o("span",ie,c(t.$t("deffence.difficulty")),1)]),_:1}),a(n,{cols:"8",sm:"9",class:"pa-0"},{default:s(()=>[a(oe,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=l=>r.value=l),items:I,"item-title":"text","item-value":"value","hide-details":"",dense:"",solo:""},null,8,["modelValue"])]),_:1})]),_:1}),a(m,{align:"center",class:"ma-0"},{default:s(()=>[a(n,{cols:"4",sm:"3",class:"pa-0 pr-1 text-right"},{default:s(()=>[o("span",re,c(t.$t("deffence.finishTurn")),1)]),_:1}),a(n,{cols:"8",sm:"9",class:"pa-0"},{default:s(()=>[a(g,{type:"number",modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=l=>i.value=l),class:"mt-0 pt-0","hide-details":"auto",dense:"",solo:"",min:1,max:5},null,8,["modelValue"])]),_:1})]),_:1}),a(m,{align:"center",class:"ma-0"},{default:s(()=>[a(n,{cols:"4",sm:"3",class:"pa-0 pr-1 text-right"},{default:s(()=>[o("span",fe,c(t.$t("deffence.totalAllyHP")),1)]),_:1}),a(n,{cols:"8",sm:"9",class:"pa-0"},{default:s(()=>[a(g,{type:"number",modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=l=>h.value=l),class:"mt-0 pt-0","hide-details":"auto",dense:"",solo:"",min:0},null,8,["modelValue"])]),_:1})]),_:1}),a(m,{align:"center",class:"ma-0"},{default:s(()=>[a(n,{cols:"4",sm:"3",class:"pa-0 pr-1 text-right"},{default:s(()=>[o("span",me,c(t.$t("deffence.remainAllyHP")),1)]),_:1}),a(n,{cols:"8",sm:"9",class:"pa-0"},{default:s(()=>[a(g,{type:"number",modelValue:A.value,"onUpdate:modelValue":e[3]||(e[3]=l=>A.value=l),class:"mt-0 pt-0","hide-details":"auto",dense:"",solo:"",min:0},null,8,["modelValue"])]),_:1})]),_:1}),a(m,{align:"center",class:"ma-0"},{default:s(()=>[a(n,{cols:"4",sm:"3",class:"pa-0 pr-1 text-right"},{default:s(()=>[o("span",ve,c(t.$t("deffence.totalDamageDealt")),1)]),_:1}),a(n,{cols:"8",sm:"9",class:"pa-0"},{default:s(()=>[a(g,{type:"number",modelValue:C.value,"onUpdate:modelValue":e[4]||(e[4]=l=>C.value=l),class:"mt-0 pt-0","hide-details":"auto",dense:"",solo:"",min:0},null,8,["modelValue"])]),_:1})]),_:1}),a(m,{align:"center",class:"ma-0"},{default:s(()=>[a(n,{cols:"4",sm:"3",class:"pa-0 pr-1 text-right"},{default:s(()=>[o("span",pe,[R(c(t.$t("deffence.numberOfEvasion"))+" ",1),o("span",ge,[a(Y,{activator:"parent","open-on-click":""},{default:s(()=>[R(c(t.$t("deffence.countIf")),1)]),_:1})])])]),_:1}),a(n,{cols:"8",sm:"9",class:"pa-0"},{default:s(()=>[a(g,{type:"number",modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=l=>y.value=l),class:"mt-0 pt-0","hide-details":"auto",dense:"",solo:"",min:0},null,8,["modelValue"])]),_:1})]),_:1}),a(m,{align:"center",class:"ma-0"},{default:s(()=>[a(n,{cols:"4",sm:"3",class:"pa-0 pr-1 text-right"},{default:s(()=>[o("span",be,c(t.$t("deffence.numberOfDebuff")),1)]),_:1}),a(n,{cols:"8",sm:"9",class:"pa-0"},{default:s(()=>[a(g,{type:"number",modelValue:F.value,"onUpdate:modelValue":e[6]||(e[6]=l=>F.value=l),class:"mt-0 pt-0","hide-details":"auto",dense:"",solo:"",min:0},null,8,["modelValue"])]),_:1})]),_:1}),a(m,{class:"ma-0"},{default:s(()=>[a(n,{class:"pa-0"},{default:s(()=>[o("div",De,[a(ne,null,{default:s(()=>[o("thead",null,[o("tr",null,[e[9]||(e[9]=o("th",null,null,-1)),o("th",Ve,c(t.$t("deffence.advantageDamageTaken")),1),o("th",_e,c(t.$t("deffence.disadvantageDamageTaken")),1)])]),o("tbody",null,[o("tr",null,[o("th",he,c(t.$t("deffence.damageTaken")),1),o("td",Ce,[a(g,{type:"number",modelValue:_.value.advantageDamaged,"onUpdate:modelValue":e[7]||(e[7]=l=>_.value.advantageDamaged=l),"hide-details":"",dense:"",solo:""},null,8,["modelValue"])]),o("td",ye,[a(g,{type:"number",modelValue:_.value.disadvantageDamaged,"onUpdate:modelValue":e[8]||(e[8]=l=>_.value.disadvantageDamaged=l),"hide-details":"",dense:"",solo:""},null,8,["modelValue"])])])])]),_:1})])]),_:1})]),_:1}),a(Z,{data:K.value,scores:S.value,score:G.value},null,8,["data","scores","score"])]),_:1})]),_:1})]),_:1}))}}),$e=de(Fe,[["__scopeId","data-v-dcb572db"]]);export{$e as default};

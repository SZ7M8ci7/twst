import{u as Me}from"./characters-438cd539.js";import{as as pe,y as ee}from"./index-01f26719.js";const Ke=pe("searchSettings",{state:()=>({minEHP:3e4,minHP:3e4,minHPBuddy:0,minEvasion:0,minDuo:0,minBuff:0,minDebuff:0,minCosmic:0,minFire:0,minWater:0,minFlora:0,minReferenceDamage:0,minReferenceAdvantageDamage:0,minReferenceVsHiDamage:0,minReferenceVsMizuDamage:0,minReferenceVsKiDamage:0,maxResult:10,attackNum:10,sortOptions:[{prop:"HP",order:"降順"}],allowSameCharacter:!0}),actions:{updateSearchSettings(t){Object.assign(this,t)}}}),Te=pe("searchResult",{state:()=>({totalResults:0,nowResults:0,results:[],isSearching:!1,errorMessage:""})}),Ue=Ke(),{minEHP:Le,minHP:Ce,minDebuff:Ve,minBuff:Fe,minHPBuddy:qe,minEvasion:ze,minDuo:Ee,minCosmic:Oe,minFire:We,minWater:_e,minFlora:je,minReferenceDamage:Ne,minReferenceAdvantageDamage:$e,minReferenceVsHiDamage:Ie,minReferenceVsKiDamage:xe,minReferenceVsMizuDamage:Ze,maxResult:me,sortOptions:Ge,allowSameCharacter:Je,attackNum:E}=ee(Ue),Qe=Me(),{characters:fe}=ee(Qe),Xe=Te(),{totalResults:_,nowResults:ge,results:h,isSearching:de,errorMessage:x}=ee(Xe);function ct(t){(t.key==="e"||t.key==="+")&&t.preventDefault()}function Ye(t){return[t("comments.HP"),t("comments.effectiveHP"),t("comments.HPBuddy"),t("comments.noHPBuddy"),t("comments.buddy"),t("comments.evasion"),t("comments.duo"),t("comments.buff"),t("comments.debuff"),t("comments.maxCosmic"),t("comments.maxFire"),t("comments.maxWater"),t("comments.maxFlora"),t("comments.neutralDamage"),t("comments.advantageDamage"),t("comments.damageAgainstFire"),t("comments.damageAgainstWater"),t("comments.damageAgainstFlora")]}const et=["hp","ehp","hpBuudy","noHpBuddy","buddy","evasion","duo","buff","debuff","maxCosmic","maxFire","maxWater","maxFlora","referenceDamage","referenceAdvantageDamage","referenceVsHiDamage","referenceVsMizuDamage","referenceVsKiDamage"],N={"HPUP(小)":{hp:.2,atk:0,heal:0,conHeal:0},"HP&ATKUP(小)":{hp:.2,atk:.2,heal:0,conHeal:0},"HPUP(中)":{hp:.3,atk:0,heal:0,conHeal:0},"HP&ATKUP(中)":{hp:.3,atk:.35,heal:0,conHeal:0},"ATKUP(小)":{hp:0,atk:.2,heal:0,conHeal:0},"ATKUP(中)":{hp:0,atk:.35,heal:0,conHeal:0},"回復(小)":{hp:0,atk:0,heal:1.1,conHeal:0},"回復&継続回復(小)":{hp:0,atk:0,heal:1.1,conHeal:.15*3},"回復(中)":{hp:0,atk:0,heal:1.7,conHeal:0},"回復&継続回復(中)":{hp:0,atk:0,heal:1.7,conHeal:.25*3},"継続回復(小)":{hp:0,atk:0,heal:0,conHeal:.15*3},"継続回復(中)":{hp:0,atk:0,heal:0,conHeal:.25*3}};function Z(t){var s;return((s=N[t])==null?void 0:s.hp)||0}function G(t){var s;return((s=N[t])==null?void 0:s.atk)||0}function J(t){var s;return((s=N[t])==null?void 0:s.heal)||0}function Q(t){var s;return((s=N[t])==null?void 0:s.conHeal)||0}const tt={"ATKUP(極小)":1.1,"ATKUP(小)":1.2,"ATKUP(中)":1.35,"ATKUP(大)":1.5,"ATKUP(極大)":1.8},at={"ダメUP(極小)":.025,"ダメUP(小)":.05,"ダメUP(中)":.0875,"ダメUP(大)":.125,"ダメUP(極大)":.1875,"属性ダメUP(極小)":.03,"属性ダメUP(小)":.06,"属性ダメUP(中)":.1005,"属性ダメUP(大)":.15,"属性ダメUP(極大)":.27},X={};function nt(t,s,u,l){const o=`${t},${s},${u},${l}`;if(o in X)return X[o];let D=s.includes("弱")?.75:1;D*=u==="無"?1.1:1,D+=at[t]||0;let f=1;s.includes("連撃")?f=1.8:s.includes("デュオ")&&(f=2.4);const M=l*D*f;return X[o]=M,M}function Y(t,s,u,l,o){return l=(tt[t]||1)*l+l*o,nt(t,s,u=="無"?"無":"無以外",l)}function O(t,s,u){const l=[t,s,u];return l.sort((o,D)=>D-o),[l[0],l[1]]}function st(t){const s=new Set;for(const e of t)s.add(e.chara);let u=0,l=0,o=0,D=0,f=0,M=0,y=0,B=0,R=0,m=0,F=0,a=0,i=0;const c=[],g=[],d=[],v=[],k=[];let r=0,b=0,S=0,q=0,z=0;const P={},$={},H={},te=[];let ae="";const K=[],ne=[],se=[],re=[],oe=[],ie=[],ce=[];t.sort((e,n)=>n.calcBaseATK-e.calcBaseATK),t.forEach((e,n)=>{P[n]=!1,$[n]=!1,H[n]=!1});function W(e,n){let A=0;return e.magic1atr==n&&(A+=1),e.magic2atr==n&&(A+=1),e.magic3atr==n&&e.hasM3&&(A+=1),Math.min(A,2)}if(t.forEach((e,n)=>{te.push(e.imgUrl),ae+="&name"+(n+1)+"="+e.name,u+=e.calcBaseHP,y+=e.buff_count,B+=e.debuff_count,m+=W(e,"無"),F+=W(e,"火"),a+=W(e,"水"),i+=W(e,"木");let A=!1,T=0;if(s.has(e.buddy1c)){f+=1;const p=Z(e.buddy1s);T+=G(e.buddy1s),p!=0&&(D+=1,A=!0,u+=e.calcBaseHP*p)}if(s.has(e.buddy2c)){f+=1;const p=Z(e.buddy2s);T+=G(e.buddy2s),p!=0&&(D+=1,A=!0,u+=e.calcBaseHP*p)}if(s.has(e.buddy3c)){f+=1;const p=Z(e.buddy3s);T+=G(e.buddy3s),p!=0&&(D+=1,A=!0,u+=e.calcBaseHP*p)}const ue=(J(e.magic1heal)+J(e.magic2heal)+(e.hasM3?J(e.magic3heal):0))*e.calcBaseATK,le=(Q(e.magic1heal)+Q(e.magic2heal)+(e.hasM3?Q(e.magic3heal):0))*e.calcBaseHP;l+=ue+le,ne.push(ue+le),o+=e.evasion,A||(M+=1);let I=e.magic2pow;if(H[n])I="デュオ",R+=1;else{if(!H[n]){for(const[p,V]of t.entries())if(V.duo==e.chara&&e.duo==V.chara&&!H[n]&&!H[p]){H[n]=!0,H[p]=!0,P[n]=!0,P[p]=!0;break}if(!P[n]){for(const[p,V]of t.entries())if(e.duo==V.chara&&!H[n]&&!P[n]&&!$[p]){H[n]=!0,P[n]=!0,$[p]=!0;break}}if(!P[n]){for(const[p,V]of t.entries())if(e.duo==V.chara&&!H[n]&&!P[n]&&!P[p]){H[n]=!0,P[n]=!0,P[p]=!0;break}}}H[n]&&(I="デュオ",R+=1)}const U=Y(e.magic1buf,e.magic1pow,e.magic1atr,e.calcBaseATK,T),L=Y(e.magic2buf,I,e.magic2atr,e.calcBaseATK,T),C=e.hasM3?Y(e.magic3buf,e.magic3pow,e.magic3atr,e.calcBaseATK,T):0,De=e.magic1atr=="無"?U:U*1.5,ke=e.magic2atr=="無"?L:L*1.5,he=e.magic3atr=="無"?C:C*1.5,He=w(e.magic1atr,"火",U),ye=w(e.magic2atr,"火",L),Pe=w(e.magic3atr,"火",C),Re=w(e.magic1atr,"水",U),be=w(e.magic2atr,"水",L),Ae=w(e.magic3atr,"水",C),we=w(e.magic1atr,"木",U),Be=w(e.magic2atr,"木",L),Se=w(e.magic3atr,"木",C);c.push(...O(U,L,C)),g.push(...O(De,ke,he)),d.push(...O(He,ye,Pe)),v.push(...O(Re,be,Ae)),k.push(...O(we,Be,Se)),se.push(c.at(-1)+c.at(-2)),re.push(g.at(-1)+g.at(-2)),oe.push(d.at(-1)+d.at(-2)),ie.push(v.at(-1)+v.at(-2)),ce.push(k.at(-1)+k.at(-2))}),r=c.sort((e,n)=>n-e).slice(0,E.value).reduce((e,n)=>e+n,0),b=g.sort((e,n)=>n-e).slice(0,E.value).reduce((e,n)=>e+n,0),S=d.sort((e,n)=>n-e).slice(0,E.value).reduce((e,n)=>e+n,0),q=v.sort((e,n)=>n-e).slice(0,E.value).reduce((e,n)=>e+n,0),z=k.sort((e,n)=>n-e).slice(0,E.value).reduce((e,n)=>e+n,0),!(u<Ce.value)&&!(u+l<Le.value)&&!(D<qe.value)&&!(o<ze.value)&&!(R<Ee.value)&&!(y<Fe.value)&&!(B<Ve.value)&&!(m<Oe.value)&&!(F<We.value)&&!(a<_e.value)&&!(i<je.value)&&!(r<Ne.value)&&!(b<$e.value)&&!(S<Ie.value)&&!(q<Ze.value)&&!(z<xe.value))return r=Math.floor(r),b=Math.floor(b),S=Math.floor(S),q=Math.floor(q),z=Math.floor(z),K.push(ne),K.push(se),K.push(re),K.push(oe),K.push(ie),K.push(ce),[u,u+l,o,D,f,M,R,y,B,m,F,a,i,r,b,S,q,z,...te,ae,K]}const rt={水:{火:1.5,木:.5},木:{水:1.5,火:.5},火:{木:1.5,水:.5}};function w(t,s,u){var o;const l=(o=rt[t])==null?void 0:o[s];return l?u*l:u}function ve(t){return function(s,u){for(let l=0;l<t.length;l++){const{key:o,order:D}=t[l];if(!Object.prototype.hasOwnProperty.call(s,o)||!Object.prototype.hasOwnProperty.call(u,o))continue;let f=0;if(s[o]<u[o]?f=-1:s[o]>u[o]&&(f=1),f!==0)return D==="降順"?f*-1:f}return 0}}function j(t){return t<=0?1:t*j(t-1)}async function ut(t){for(const a of fe.value)if(a.required&&a.level==0){x.value=t("error.requiredCharacter");return}const s=fe.value.filter(a=>a.level>0),u=s.length;if(u<5){x.value=t("error.fewCharacter");return}ge.value=0;const l=Ye(t),o=[];for(const a of Ge.value)for(let i=0;i<l.length;i++)if(l[i]==a.prop){let c="降順";switch(a.order){case"ASC":c="昇順";break;case"DESC":c="降順";break;case"昇順":case"降順":c=a.order;break;default:continue}o.push({key:et[i],order:c})}const D=o[0].order==="昇順";async function f(){h.value.sort(ve(o));const a=h.value.slice(0,me.value);h.value=[...a],h.value.length>0&&(B=h.value[h.value.length-1][o[0].key]),await new Promise(requestAnimationFrame)}const M=new Set(["referenceDamage","referenceAdvantageDamage","referenceVsHiDamage","referenceVsMizuDamage","referenceVsKiDamage"]);o[0].key in M?s.sort((a,i)=>a.required&&!i.required?-1:!a.required&&i.required?1:i.atk-a.atk):s.sort((a,i)=>a.required&&!i.required?-1:!a.required&&i.required?1:i.hp-a.hp);const y=s.filter(a=>a.required).length;if(y>5){x.value="必須設定されたキャラが多すぎます";return}h.value=[],s.forEach(a=>{let i=110;a.rare=="SR"?i=90:a.rare=="R"&&(i=70);const c=a.level/i;a.calcBaseHP=(a.hp-a.base_hp)*c+a.base_hp,a.calcBaseATK=(a.atk-a.base_atk)*c+a.base_atk});let B=o[0].order==="昇順"?1/0:-1/0;const R=async(a,i,c,g,d)=>new Promise(v=>{const k=[s[a],s[i],s[c],s[g],s[d]],r=st(k);if(r){const b={hp:Math.round(r[0]),ehp:Math.round(r[1]),evasion:r[2],hpBuudy:r[3],buddy:r[4],noHpBuddy:r[5],duo:r[6],buff:r[7],debuff:r[8],maxCosmic:r[9],maxFire:r[10],maxWater:r[11],maxFlora:r[12],referenceDamage:r[13],referenceAdvantageDamage:r[14],referenceVsHiDamage:r[15],referenceVsMizuDamage:r[16],referenceVsKiDamage:r[17],chara1:r[18],chara2:r[19],chara3:r[20],chara4:r[21],chara5:r[22],simuURL:r[23],detailList:r[24]},S=b[o[0].key];(D&&S<B||!D&&S>B)&&h.value.push(b)}ge.value+=1,v()}),m=new Array(5).fill(u);for(let a=0;a<y;a++)m[a]=a+1;if(Je.value){let a=Date.now();const i=m[0]*(m[1]-1)*(m[2]-2)*(m[3]-3);if(_.value=i*(m[4]-4)/j(5-y)+i*4/j(4-y),y==5){_.value=1,await R(0,1,2,3,4),await new Promise(requestAnimationFrame);return}for(let c=0;c<m[0];c++)for(let g=c+1;g<m[1];g++)for(let d=g+1;d<m[2];d++){if(!de.value)return;for(let v=d+1;v<m[3];v++){for(let k=v+1;k<m[4];k++)await R(c,g,d,v,k),Date.now()-a>2e3&&(a=Date.now(),await f());for(const k of[c,g,d,v])await R(c,g,d,v,k),Date.now()-a>2e3&&(a=Date.now(),await f())}}}else{const a=m[0]*(m[1]-1)*(m[2]-2)*(m[3]-3);if(_.value=a*(m[4]-4)/j(5-y),y==5){_.value=1,await R(0,1,2,3,4),await new Promise(requestAnimationFrame);return}let i=Date.now();for(let c=0;c<m[0];c++)for(let g=c+1;g<m[1];g++)for(let d=g+1;d<m[2];d++){if(!de.value)return;for(let v=d+1;v<m[3];v++)for(let k=v+1;k<m[4];k++)await R(c,g,d,v,k),Date.now()-i>2e3&&(i=Date.now(),await f())}}h.value.sort(ve(o));const F=h.value.slice(0,me.value);h.value=[...F],h.value.length>0&&(B=h.value[h.value.length-1][o[0].key])}export{Te as a,ut as b,ct as c,Ye as g,Ke as u};

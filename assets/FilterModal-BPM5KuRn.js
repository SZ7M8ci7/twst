import{b as pe,j as Se,l as be}from"./common-DCrjgGx4.js";import{ar as ye,r as m,d as he,i as ge,ah as le,e as x,I as _e,H as ke,a3 as Ce,j as d,af as te,a as p,g as b,l as W,w as E,b as A,t as U,u as _,F,k as w,o as c,ax as ae,_ as Re}from"./index-D34CnzHL.js";import{c as G}from"./characters_info-dN3oKtEx.js";import se from"./default-C4N0O_oT.js";import{V as P}from"./VCheckbox-BBvPWhsr.js";const j="twstSimulatorFilterState";function Fe(){try{const a=localStorage.getItem(j);if(a)return JSON.parse(a)}catch(a){console.warn("Failed to load filter state from localStorage:",a)}return null}function we(a){try{localStorage.setItem(j,JSON.stringify(a))}catch(k){console.warn("Failed to save filter state to localStorage:",k)}}const Me=ye("filterd",()=>{const a=Fe(),k=m((a==null?void 0:a.selectedCharacters)||[]),i=m((a==null?void 0:a.selectedRare)||[]),O=m((a==null?void 0:a.selectedType)||[]),V=m((a==null?void 0:a.selectedAttr)||[]),h=m((a==null?void 0:a.selectedEffects)||[]),g=m(!a);function C(){const y={selectedCharacters:k.value,selectedRare:i.value,selectedType:O.value,selectedAttr:V.value,selectedEffects:h.value};we(y)}function R(){k.value=[],i.value=[],O.value=[],V.value=[],h.value=[],g.value=!0;try{localStorage.removeItem(j)}catch(y){console.warn("Failed to remove filter state from localStorage:",y)}}return{tempSelectedCharacters:k,tempSelectedRare:i,isFirst:g,tempSelectedType:O,tempSelectedAttr:V,tempSelectedEffects:h,saveCurrentState:C,resetFilterState:R}}),We={class:"feature-select-all-container"},Ee={class:"feature-items"},Ae={class:"display-block"},Oe={class:"character-list-wrapper"},Ve={class:"character-select-all-container"},Te={class:"character-items"},Ue=["onClick"],$e=["src","alt"],Be={class:"feature-select-all-container"},Pe={class:"feature-items"},De={key:0,class:"button-container"},ze={key:1,class:"button-container embedded-buttons"},ne=50,ue=10,Ie=he({__name:"FilterModal",props:{embedded:{type:Boolean,default:!1}},emits:["close","filter-applied"],setup(a,{emit:k}){const{t:i}=ge(),O=pe(),{characters:V}=le(O),h=Me(),{tempSelectedCharacters:g,tempSelectedRare:C,tempSelectedType:R,tempSelectedAttr:y,tempSelectedEffects:T,isFirst:L}=le(h),u=m([]),v=m([]),f=m([]),o=m([]),r=m([]),H=k,K=m(0),N=m({}),J=a,ie=m({"--icon-size":`${ne}px`,"--gap-size":`${ue}px`}),q=["SSR","SR","R"],Y=x(()=>[{name:i("filterModal.balance"),value:"バランス"},{name:i("filterModal.defence"),value:"ディフェンス"},{name:i("filterModal.attack"),value:"アタック"}]),Q=x(()=>[{name:i("filterModal.fire"),value:"火"},{name:i("filterModal.water"),value:"水"},{name:i("filterModal.flora"),value:"木"},{name:i("filterModal.cosmic"),value:"無"}]),$=x(()=>Se.map(e=>({name:i(`filterModal.${e.name}`),value:e.value}))),M=G.reduce((e,l)=>{const t=l.dorm;return e[t]||(e[t]=[]),e[t].push(l),e},{}),X=()=>{const e=document.querySelector(".display-block");e&&(K.value=e.clientWidth)},Z=()=>{X()};_e(async()=>{L.value?(u.value=Object.values(M).flat().map(e=>e.name_en),v.value=["SSR"],f.value=["バランス","ディフェンス","アタック"],o.value=["火","水","木","無"],r.value=["ATKUP","ダメージUP","クリティカル","属性ダメージUP","被ダメージUP","ATKDOWN","ダメージDOWN","回避","属性ダメージDOWN","被ダメージDOWN","HP回復","HP継続回復","暗闇無効","呪い無効","凍結無効","デバフ解除","呪い"]):(g.value.length>0&&(u.value=[...g.value]),C.value.length>0&&(v.value=[...C.value]),R.value.length>0&&(f.value=[...R.value]),y.value.length>0&&(o.value=[...y.value]),T.value.length>0&&(r.value=[...T.value])),L.value=!1,X(),window.addEventListener("resize",Z),N.value=await be(G,e=>e.name_en,"icon/"),J.embedded&&ke([u,v,f,o,r],()=>{g.value=[...u.value],C.value=[...v.value],R.value=[...f.value],y.value=[...o.value],T.value=[...r.value],h.saveCurrentState(),D()},{deep:!0})}),Ce(()=>{window.removeEventListener("resize",Z)});function oe(){g.value=[...u.value],C.value=[...v.value],R.value=[...f.value],y.value=[...o.value],T.value=[...r.value],h.saveCurrentState(),D(),H("filter-applied"),J.embedded||H("close")}function re(){u.value=Object.values(M).flat().map(e=>e.name_en),v.value=["SSR"],f.value=["バランス","ディフェンス","アタック"],o.value=["火","水","木","無"],r.value=["ATKUP","ダメージUP","クリティカル","属性ダメージUP","被ダメージUP","ATKDOWN","ダメージDOWN","回避","属性ダメージDOWN","被ダメージDOWN","HP回復","HP継続回復","暗闇無効","呪い無効","凍結無効","デバフ解除","呪い"],g.value=[...u.value],C.value=[...v.value],R.value=[...f.value],y.value=[...o.value],T.value=[...r.value],h.resetFilterState(),D()}function D(){V.value.forEach(e=>{if(!v.value.includes(e.rare)){e.visible=!1;return}const l=G.find(t=>t.name_ja===e.chara||t.name_en===e.chara);if(!l||!u.value.includes(l.name_en)){e.visible=!1;return}if(!f.value.includes(e.attr)){e.visible=!1;return}if(!o.value.includes(e.magic1atr)&&!o.value.includes(e.magic2atr)&&!o.value.includes(e.magic3atr)){e.visible=!1;return}if(r.value.length===17)e.visible=!0;else if(r.value.length===0){e.visible=!1;return}else if(r.value.some(s=>e.etc.includes(s)))e.visible=!0;else{e.visible=!1;return}})}function de(e){const l=e.target;l.src=se}function z(e){if(e==="statusEffects")$.value.every(t=>r.value.includes(t.value))?r.value=[]:r.value=$.value.map(t=>t.value);else if(e==="cardAttributes"){const l=["SSR","SR","R"].every(n=>v.value.includes(n)),t=["バランス","ディフェンス","アタック"].every(n=>f.value.includes(n)),s=["火","水","木","無"].every(n=>o.value.includes(n));l&&t&&s?(v.value=[],f.value=[],o.value=[]):(v.value=["SSR","SR","R"],f.value=["バランス","ディフェンス","アタック"],o.value=["火","水","木","無"])}else{const l=M[e]||[];l.every(s=>u.value.includes(s.name_en))?u.value=u.value.filter(s=>!l.some(n=>n.name_en===s)):u.value=[...new Set([...u.value,...l.map(s=>s.name_en)])]}}function I(e){return e==="cardAttributes"?q.every(t=>v.value.includes(t))&&Y.value.every(t=>f.value.includes(t.value))&&Q.value.every(t=>o.value.includes(t.value)):e==="statusEffects"?$.value.every(t=>r.value.includes(t.value)):M[e].every(t=>u.value.includes(t.name_en))}function ce(e){u.value=u.value.includes(e)?u.value.filter(l=>l!==e):[...u.value,e]}const ve=e=>64+(ne+10+ue)*e.length+10,fe=e=>({width:e===1?"100%":"50%"}),me=()=>{const e=[];let l=[],t=0;const s=K.value,n=2;return Object.entries(M).forEach(([S,ee])=>{const B=ve(ee);B>=s/n?(l.length>0&&(e.push(l),l=[],t=0),e.push([S])):t+B<=s&&l.length<n?(l.push(S),t+=B):(e.push(l),l=[S],t=B)}),l.length>0&&e.push(l),e};return(e,l)=>(c(),d("div",{class:te(["modal-background",{embedded:a.embedded}]),ref:"modalContainer"},[p("div",We,[b(W,{small:"",onClick:l[0]||(l[0]=t=>z("cardAttributes"))},{default:E(()=>[A(U(I("cardAttributes")?_(i)("filterModal.release"):_(i)("filterModal.select")),1)]),_:1}),p("div",Ee,[(c(),d(F,null,w(q,(t,s)=>p("div",{class:"feature-item",key:`rare-${s}`},[b(P,{modelValue:v.value,"onUpdate:modelValue":l[1]||(l[1]=n=>v.value=n),value:t,label:t,"hide-details":""},null,8,["modelValue","value","label"])])),64)),(c(!0),d(F,null,w(Y.value,(t,s)=>(c(),d("div",{class:"feature-item",key:`type-${s}`},[b(P,{modelValue:f.value,"onUpdate:modelValue":l[2]||(l[2]=n=>f.value=n),value:t.value,label:t.name,"hide-details":""},null,8,["modelValue","value","label"])]))),128)),(c(!0),d(F,null,w(Q.value,(t,s)=>(c(),d("div",{class:"feature-item",key:`attr-${s}`},[b(P,{modelValue:o.value,"onUpdate:modelValue":l[3]||(l[3]=n=>o.value=n),value:t.value,label:t.name,"hide-details":""},null,8,["modelValue","value","label"])]))),128))])]),l[8]||(l[8]=p("hr",{class:"rare-divider"},null,-1)),p("div",Ae,[p("div",Oe,[(c(!0),d(F,null,w(me(),(t,s)=>(c(),d("div",{key:s,class:"row"},[(c(!0),d(F,null,w(t,n=>(c(),d("div",{key:n,style:ae(fe(t.length)),class:"character-list"},[p("div",Ve,[b(W,{small:"",onClick:S=>z(n)},{default:E(()=>[A(U(I(n)?_(i)("filterModal.release"):_(i)("filterModal.select")),1)]),_:2},1032,["onClick"]),p("div",Te,[(c(!0),d(F,null,w(_(M)[n],S=>(c(),d("div",{key:S.name_en,class:te(["character-item",{selected:u.value.includes(S.name_en)}]),onClick:ee=>ce(S.name_en),style:ae({...ie.value,opacity:u.value.includes(S.name_en)?1:.5})},[p("img",{src:N.value[S.name_en]||_(se),alt:S.name_en,class:"character-image",onError:de},null,40,$e)],14,Ue))),128))])])],4))),128))]))),128))])]),l[9]||(l[9]=p("hr",{class:"rare-divider"},null,-1)),p("div",Be,[b(W,{small:"",onClick:l[4]||(l[4]=t=>z("statusEffects"))},{default:E(()=>[A(U(I("statusEffects")?_(i)("filterModal.release"):_(i)("filterModal.select")),1)]),_:1}),p("div",Pe,[(c(!0),d(F,null,w($.value,t=>(c(),d("div",{key:t.name,class:"feature-item"},[b(P,{modelValue:r.value,"onUpdate:modelValue":l[5]||(l[5]=s=>r.value=s),value:t.value,label:t.name,"hide-details":""},null,8,["modelValue","value","label"])]))),128))])]),a.embedded?(c(),d("div",ze,[b(W,{class:"button reset-button",onClick:re,variant:"outlined",size:"small"},{default:E(()=>l[7]||(l[7]=[A(" フィルターリセット ")])),_:1,__:[7]})])):(c(),d("div",De,[b(W,{class:"button",onClick:l[6]||(l[6]=t=>e.$emit("close"))},{default:E(()=>[A(U(e.$t("filterModal.cancel")),1)]),_:1}),b(W,{class:"button apply-button",disabled:u.value.length===0||v.value.length===0,onClick:oe},{default:E(()=>[A(U(e.$t("filterModal.submit")),1)]),_:1},8,["disabled"])]))],2))}}),Ke=Re(Ie,[["__scopeId","data-v-6d88ba79"]]);export{Ke as F,Me as u};
